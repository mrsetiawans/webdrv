<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flash Quota Premium - Official Digital Data Reseller</title>
    <meta name="theme-color" content="#0F172A">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3616/3616899.png">
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.1/qrcode.min.js"></script>
    
    <!-- Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                    },
                    colors: {
                        primary: '#3B82F6',
                        dark: '#0F172A',
                        darker: '#020617',
                    },
                    animation: {
                        'blob': 'blob 7s infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'marquee': 'marquee 40s linear infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        },
                        marquee: {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(-50%)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { -webkit-tap-highlight-color: transparent; }
        
        /* Glassmorphism Utilities */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .dark .glass {
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(226, 232, 240, 0.6);
        }
        .dark .glass-panel {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(51, 65, 85, 0.5);
        }

        /* Animated Background */
        .bg-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            z-index: 0;
            opacity: 0.6;
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 4px; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; }

        /* Receipt Pattern */
        .receipt-jagged { position: relative; }
        .receipt-jagged::after {
            content: "";
            position: absolute;
            bottom: -6px;
            left: 0;
            width: 100%;
            height: 12px;
            background: linear-gradient(45deg, transparent 33.333%, inherit 33.333%, inherit 66.667%, transparent 66.667%), linear-gradient(-45deg, transparent 33.333%, inherit 33.333%, inherit 66.667%, transparent 66.667%);
            background-size: 16px 32px;
            background-position: 0 0; 
            transform: rotate(180deg);
            background-color: inherit; /* Matches parent bg */
        }

        /* Utilities */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Toast Animation */
        .toast {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .toast-enter { transform: translateY(-100%); opacity: 0; }
        .toast-active { transform: translateY(0); opacity: 1; }
        .toast-exit { transform: translateY(-100%); opacity: 0; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-darker text-slate-800 dark:text-slate-200 antialiased transition-colors duration-300 overflow-hidden fixed inset-0">

    <!-- Background Animation -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="bg-orb bg-blue-400/30 w-96 h-96 top-0 left-[-100px] animate-blob"></div>
        <div class="bg-orb bg-purple-400/30 w-96 h-96 bottom-0 right-[-100px] animate-blob animation-delay-2000"></div>
        <div class="bg-orb bg-teal-400/30 w-80 h-80 top-[40%] left-[20%] animate-blob animation-delay-4000"></div>
    </div>

    <!-- Notification Toast -->
    <div id="toast-container" class="fixed top-4 left-0 right-0 z-[100] pointer-events-none flex flex-col items-center gap-2 px-4"></div>

    <!-- MAIN APP CONTAINER -->
    <div class="relative w-full h-full max-w-[500px] mx-auto bg-white/50 dark:bg-slate-900/50 backdrop-blur-sm shadow-2xl sm:rounded-[30px] sm:my-4 sm:h-[calc(100vh-2rem)] border border-white/20 dark:border-white/5 overflow-hidden flex flex-col transition-all duration-300">
        
        <!-- Top Bar -->
        <div class="bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200/60 dark:border-slate-700/60 px-5 py-3 flex justify-between items-center z-50">
            <div class="flex items-center gap-2.5">
                <div class="w-9 h-9 rounded-xl bg-gradient-to-tr from-blue-600 to-indigo-600 flex items-center justify-center text-white shadow-lg shadow-blue-500/20">
                    <i class="fas fa-bolt text-sm"></i>
                </div>
                <div>
                    <h1 class="font-bold text-sm leading-none text-slate-900 dark:text-white mb-0.5">Flash Quota</h1>
                    <div class="flex items-center gap-1.5">
                        <span class="relative flex h-1.5 w-1.5">
                          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                          <span class="relative inline-flex rounded-full h-1.5 w-1.5 bg-green-500"></span>
                        </span>
                        <p class="text-[10px] font-medium text-slate-500 dark:text-slate-400">Server Online <span id="ping-val" class="font-mono text-[9px] opacity-70 ml-1">24ms</span></p>
                    </div>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="toggleDarkMode()" class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-600 dark:text-slate-400 transition hover:scale-105 active:scale-95">
                    <i class="fas fa-moon dark:hidden text-xs"></i>
                    <i class="fas fa-sun hidden dark:block text-xs text-yellow-400"></i>
                </button>
            </div>
        </div>

        <!-- SCROLLABLE CONTENT AREA -->
        <div id="main-content" class="flex-1 overflow-y-auto custom-scrollbar relative scroll-smooth pb-24">
            
            <!-- View: HOME -->
            <div id="view-home" class="p-5 space-y-6">
                
                <!-- Greeting -->
                <div class="flex justify-between items-end animate-fade-in">
                    <div>
                        <p class="text-xs text-slate-500 dark:text-slate-400 mb-1" id="greeting-time">Selamat Datang,</p>
                        <h2 class="text-xl font-bold text-slate-900 dark:text-white">Mau internetan <br><span class="text-blue-600 dark:text-blue-400">tanpa batas?</span> ðŸš€</h2>
                    </div>
                    <div class="text-right">
                        <div class="bg-red-500 text-white text-[10px] font-bold px-2 py-1 rounded-lg animate-pulse inline-flex items-center gap-1 shadow-red-500/30 shadow-lg">
                            <i class="fas fa-stopwatch"></i> <span id="flash-timer">05:00:00</span>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-3 gap-3 animate-fade-in" style="animation-delay: 100ms">
                    <div class="bg-white dark:bg-slate-800 p-3 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm text-center">
                        <p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider mb-1">TERJUAL</p>
                        <p class="font-bold text-slate-800 dark:text-slate-200">15.2k+</p>
                    </div>
                    <div class="bg-white dark:bg-slate-800 p-3 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm text-center">
                        <p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider mb-1">RATING</p>
                        <div class="flex justify-center items-center gap-1 text-yellow-400 text-xs">
                            <i class="fas fa-star"></i> <span class="font-bold text-slate-800 dark:text-slate-200 text-sm">4.9</span>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-slate-800 p-3 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm text-center">
                        <p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider mb-1">GARANSI</p>
                        <p class="font-bold text-green-500 text-xs"><i class="fas fa-check-circle"></i> 100%</p>
                    </div>
                </div>

                <!-- Order Form -->
                <form id="orderForm" class="space-y-5 animate-fade-in" style="animation-delay: 200ms">
                    
                    <!-- Section: Penerima -->
                    <div class="space-y-3">
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest ml-1">Informasi Penerima</h3>
                        
                        <div class="bg-white dark:bg-slate-800 p-1 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm focus-within:ring-2 focus-within:ring-blue-500/50 transition-all">
                            <div class="relative flex items-center px-4 py-3 border-b border-slate-100 dark:border-slate-700/50">
                                <div class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-slate-400 mr-3 shrink-0">
                                    <i class="fas fa-user text-xs"></i>
                                </div>
                                <div class="flex-1">
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase">Nama Lengkap</label>
                                    <input type="text" id="nama" name="nama" class="w-full bg-transparent text-sm font-semibold text-slate-800 dark:text-white outline-none placeholder:text-slate-300 dark:placeholder:text-slate-600" placeholder="Contoh: Budi Santoso" onkeyup="saveDraft()">
                                </div>
                                <i class="fas fa-check-circle text-green-500 opacity-0 transition-opacity" id="check-nama"></i>
                            </div>

                            <div class="relative flex items-center px-4 py-3 border-b border-slate-100 dark:border-slate-700/50">
                                <div class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-slate-400 mr-3 shrink-0">
                                    <i class="fas fa-phone text-xs"></i>
                                </div>
                                <div class="flex-1">
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase">Nomor WhatsApp / HP</label>
                                    <input type="tel" id="whatsapp" name="whatsapp" inputmode="numeric" class="w-full bg-transparent text-sm font-semibold text-slate-800 dark:text-white outline-none placeholder:text-slate-300 dark:placeholder:text-slate-600" placeholder="08xx-xxxx-xxxx" oninput="formatPhone(this); checkOperator(this); saveDraft()">
                                </div>
                                <!-- Operator Logo Placeholder -->
                                <img id="operator-logo" src="" class="hidden h-5 object-contain ml-2" alt="Operator">
                            </div>

                            <div class="relative flex items-center px-4 py-3">
                                <div class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-slate-400 mr-3 shrink-0">
                                    <i class="fas fa-envelope text-xs"></i>
                                </div>
                                <div class="flex-1">
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase">Email Invoice</label>
                                    <input type="email" id="email" name="email" class="w-full bg-transparent text-sm font-semibold text-slate-800 dark:text-white outline-none placeholder:text-slate-300 dark:placeholder:text-slate-600" placeholder="email@contoh.com" onkeyup="saveDraft()">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section: Paket -->
                    <div class="space-y-3">
                        <div class="flex justify-between items-center px-1">
                            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest">Pilih Paket</h3>
                            <button type="button" onclick="openModal('featuresModal')" class="text-[10px] font-bold text-blue-500 hover:underline">Lihat Detail</button>
                        </div>
                        <div class="grid gap-3" id="pkg-list">
                            <!-- JS Injection -->
                        </div>
                        <input type="hidden" id="selectedPkg" name="package" value="pkg6">
                    </div>

                    <!-- Section: Voucher -->
                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-1 flex items-center pr-2 border border-blue-100 dark:border-blue-800/50">
                        <div class="p-3 text-blue-500"><i class="fas fa-ticket-alt"></i></div>
                        <input type="text" id="voucher" class="flex-1 bg-transparent text-sm font-semibold text-slate-800 dark:text-white outline-none placeholder:text-blue-300 dark:placeholder:text-blue-700 uppercase" placeholder="KODE PROMO">
                        <button type="button" onclick="applyVoucher()" class="bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold px-4 py-2 rounded-lg transition shadow-lg shadow-blue-500/20">Gunakan</button>
                    </div>
                    <div class="mt-2 flex items-center gap-2 text-[10px] bg-blue-50 dark:bg-slate-800/50 p-2.5 rounded-xl border border-dashed border-blue-200 dark:border-slate-700/60">
                        <i class="fas fa-ticket-alt text-blue-500 animate-pulse"></i> 
                        <span class="text-slate-600 dark:text-slate-300">Gunakan kode <b class="text-blue-600 dark:text-blue-400 font-extrabold tracking-wide">NEWYEAR</b> hemat Rp15.000!</span>
                    </div>
                    <p id="voucher-msg" class="text-[10px] px-2 hidden"></p>

                    <!-- Section: Pembayaran -->
                    <div class="space-y-3">
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest ml-1">Metode Pembayaran</h3>
                        <div class="grid grid-cols-3 gap-2" id="pay-list">
                            <!-- JS Injection -->
                        </div>
                        <input type="hidden" id="selectedPay" name="payment-method" value="qris">
                    </div>
                    
                    <input type="hidden" name="sheetName" value="inject">

                    <!-- Testimonials Marquee -->
                    <div class="pt-4">
                        <div class="flex items-center gap-2 mb-3 px-1">
                            <i class="fas fa-heart text-red-500 animate-pulse"></i>
                            <span class="text-xs font-bold text-slate-500 dark:text-slate-400">Kata Mereka</span>
                        </div>
                        <div class="relative w-full overflow-hidden mask-linear">
                            <div class="flex animate-marquee gap-3" id="testimonial-track"></div>
                        </div>
                    </div>

                </form>
            </div>

            <!-- View: HISTORY (Hidden by default) -->
            <div id="view-history" class="hidden p-5 space-y-6 min-h-[60vh] animate-fade-in">
                <h2 class="text-xl font-bold text-slate-900 dark:text-white">Riwayat Transaksi</h2>
                <div id="history-list" class="space-y-3">
                    <!-- Populated by JS -->
                    <div class="text-center py-10 opacity-50">
                        <i class="fas fa-box-open text-4xl mb-2 text-slate-300"></i>
                        <p class="text-sm">Belum ada riwayat pesanan.</p>
                    </div>
                </div>
            </div>

            <!-- View: HELP (Hidden by default) -->
            <div id="view-help" class="hidden p-5 space-y-6 animate-fade-in">
                <h2 class="text-xl font-bold text-slate-900 dark:text-white">Pusat Bantuan</h2>
                <div class="space-y-3" id="faq-container"></div>
                
                <div class="mt-8 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-6 text-white text-center shadow-xl shadow-blue-500/30">
                    <p class="text-sm font-medium opacity-90 mb-1">Masih bingung?</p>
                    <h3 class="text-lg font-bold mb-4">Hubungi CS Kami</h3>
                    <a href="https://wa.me/6285602152097" target="_blank" class="inline-flex items-center gap-2 bg-white text-blue-600 px-6 py-2.5 rounded-xl font-bold text-sm hover:bg-slate-50 transition transform hover:scale-105">
                        <i class="fab fa-whatsapp text-lg"></i> Chat WhatsApp
                    </a>
                </div>
            </div>

        </div>

        <!-- View: PAYMENT (Overlay) -->
        <div id="view-payment" class="absolute inset-0 bg-slate-50 dark:bg-darker z-[60] flex flex-col transform translate-x-full transition-transform duration-300">
            <!-- Payment Header -->
            <div class="bg-white/90 dark:bg-slate-900/90 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 px-4 py-3 flex items-center gap-3">
                <button onclick="closePayment()" class="w-8 h-8 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center text-slate-600 dark:text-slate-400">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div>
                    <h2 class="font-bold text-slate-800 dark:text-white text-sm">Menunggu Pembayaran</h2>
                    <p class="text-[10px] text-slate-500">Order ID: <span id="pay-oid" class="font-mono">...</span></p>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-6 pb-32">
                <!-- Countdown -->
                <div class="text-center mb-6">
                    <p class="text-xs text-slate-500 dark:text-slate-400 mb-1">Sisa Waktu Bayar</p>
                    <div id="pay-timer" class="text-3xl font-mono font-bold text-slate-800 dark:text-white tracking-wider">23:59:59</div>
                </div>

                <!-- Receipt -->
                <div class="bg-white p-6 rounded-t-2xl shadow-sm receipt-jagged text-slate-800 mb-6">
                    <div class="flex justify-between items-start border-b border-dashed border-slate-200 pb-4 mb-4">
                        <div>
                            <p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">TOTAL TAGIHAN</p>
                            <div class="flex items-center gap-2">
                                <h1 class="text-2xl font-bold text-slate-900" id="pay-total">Rp 0</h1>
                                <button onclick="copyToClip('pay-total')" class="text-blue-500 bg-blue-50 p-1.5 rounded-lg text-xs hover:bg-blue-100 transition"><i class="far fa-copy"></i></button>
                            </div>
                            <p class="text-[9px] text-red-500 mt-1">*Transfer tepat sampai 3 digit terakhir</p>
                        </div>
                        <img id="pay-logo" src="" class="h-8 object-contain">
                    </div>

                    <div id="pay-content" class="space-y-4">
                        <!-- Dynamic Content -->
                    </div>
                </div>
                
                <!-- Instructions -->
                <div class="bg-white dark:bg-slate-800 rounded-xl p-6 border border-slate-200 dark:border-slate-700 shadow-sm mb-6">
                    <h3 class="font-bold text-slate-900 dark:text-white mb-4 text-sm">Langkah Pembayaran</h3>
                    <div id="instruction-steps" class="space-y-3">
                        <!-- Filled by JS -->
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="space-y-3">
                    <button onclick="checkPaymentStatus()" id="btn-check-status" class="w-full bg-slate-200 dark:bg-slate-800 text-slate-700 dark:text-slate-300 font-bold py-3.5 rounded-xl flex items-center justify-center gap-2 hover:bg-slate-300 dark:hover:bg-slate-700 transition">
                        <i class="fas fa-sync-alt"></i> Cek Status Pembayaran
                    </button>
                    
                    <a id="btn-confirm-wa" href="#" target="_blank" class="block w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3.5 rounded-xl text-center shadow-lg shadow-green-500/20 transition-all active:scale-95 flex items-center justify-center gap-2">
                        <i class="fab fa-whatsapp text-lg"></i> Konfirmasi Manual
                    </a>
                </div>
            </div>
        </div>

        <!-- BOTTOM NAVIGATION (App-like) -->
        <div class="absolute bottom-0 left-0 right-0 bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl border-t border-slate-200 dark:border-slate-800 z-40 pb-safe">
            
            <!-- Checkout Bar (Visible only on Home) -->
            <div id="checkout-bar" class="px-5 py-3 border-b border-slate-100 dark:border-slate-800/50 flex items-center justify-between transition-transform duration-300">
                <div>
                    <p class="text-[10px] text-slate-400 font-bold uppercase">Total Bayar</p>
                    <div class="flex items-center gap-2">
                        <p class="text-lg font-bold text-slate-900 dark:text-white leading-none" id="summary-total">Rp 0</p>
                        <span id="summary-discount" class="hidden text-[10px] bg-red-100 text-red-600 px-1.5 rounded font-bold">-Rp 0</span>
                    </div>
                </div>
                <button onclick="processCheckout()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-xl font-bold shadow-lg shadow-blue-600/30 active:scale-95 transition text-sm flex items-center gap-2">
                    Beli <i class="fas fa-arrow-right"></i>
                </button>
            </div>

            <!-- Tab Bar -->
            <div class="flex justify-around items-center h-16">
                <button onclick="switchTab('home')" class="nav-item active flex-1 flex flex-col items-center justify-center gap-1 text-slate-400 hover:text-blue-500 transition">
                    <i class="fas fa-home text-xl mb-0.5"></i>
                    <span class="text-[10px] font-bold">Home</span>
                </button>
                <button onclick="switchTab('history')" class="nav-item flex-1 flex flex-col items-center justify-center gap-1 text-slate-400 hover:text-blue-500 transition">
                    <i class="fas fa-history text-xl mb-0.5"></i>
                    <span class="text-[10px] font-bold">Riwayat</span>
                </button>
                <button onclick="switchTab('help')" class="nav-item flex-1 flex flex-col items-center justify-center gap-1 text-slate-400 hover:text-blue-500 transition">
                    <i class="fas fa-question-circle text-xl mb-0.5"></i>
                    <span class="text-[10px] font-bold">Bantuan</span>
                </button>
            </div>
        </div>

        <!-- Chat Widget Button -->
        <div class="absolute bottom-36 right-4 z-30">
            <button onclick="toggleChat()" class="w-12 h-12 bg-white dark:bg-slate-800 rounded-full shadow-xl flex items-center justify-center text-blue-600 dark:text-blue-400 hover:scale-110 transition border border-slate-100 dark:border-slate-700 relative">
                <i class="fas fa-comment-dots text-xl"></i>
                <span class="absolute top-0 right-0 w-3 h-3 bg-green-500 border-2 border-white dark:border-slate-800 rounded-full"></span>
            </button>
        </div>

        <!-- Chat Widget Box -->
        <div id="chat-box" class="absolute bottom-20 right-4 w-72 bg-white dark:bg-slate-800 rounded-2xl shadow-2xl border border-slate-200 dark:border-slate-700 transform translate-y-10 opacity-0 pointer-events-none transition-all duration-300 z-50 flex flex-col overflow-hidden origin-bottom-right">
            <div class="bg-blue-600 p-4 text-white flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center"><i class="fas fa-robot"></i></div>
                    <div>
                        <p class="text-xs font-bold">CS Flash Quota</p>
                        <p class="text-[10px] opacity-80">Online</p>
                    </div>
                </div>
                <button onclick="toggleChat()" class="text-white/80 hover:text-white"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-4 h-64 overflow-y-auto bg-slate-50 dark:bg-slate-900/50 space-y-3" id="chat-messages">
                <div class="flex gap-2">
                    <div class="w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 text-xs shrink-0 mt-1"><i class="fas fa-robot"></i></div>
                    <div class="bg-white dark:bg-slate-800 p-2 rounded-tr-xl rounded-b-xl text-xs text-slate-600 dark:text-slate-300 shadow-sm border border-slate-100 dark:border-slate-700">
                        Halo Kak! Ada yang bisa dibantu?
                    </div>
                </div>
            </div>
            <div class="p-2 bg-white dark:bg-slate-800 border-t border-slate-100 dark:border-slate-700 flex gap-2">
                <input type="text" id="chat-input" class="flex-1 bg-slate-100 dark:bg-slate-700 rounded-full px-3 py-1.5 text-xs outline-none dark:text-white" placeholder="Ketik pesan...">
                <button onclick="sendChat()" class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-xs hover:bg-blue-700"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>

    </div>

    <!-- Modals -->
    <!-- Loading Overlay (Server Connecting) -->
    <div id="connecting-overlay" class="fixed inset-0 bg-white/95 dark:bg-slate-900/95 backdrop-blur-md z-[100] hidden flex-col items-center justify-center text-center transition-opacity duration-300">
        <div class="relative w-32 h-32 mb-8">
            <!-- Ripple Effect -->
            <div class="absolute inset-0 bg-blue-100 dark:bg-blue-900 rounded-full animate-ping opacity-75"></div>
            <div class="absolute inset-4 bg-blue-50 dark:bg-blue-800 rounded-full animate-pulse"></div>
            
            <!-- Icon -->
            <div class="absolute inset-0 flex items-center justify-center z-10">
                <div class="relative">
                    <i class="fas fa-broadcast-tower text-4xl text-blue-600 dark:text-blue-400"></i>
                    <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white dark:border-slate-900 animate-bounce"></div>
                </div>
            </div>
            
            <!-- Orbiting Dot -->
            <div class="absolute inset-0 animate-spin" style="animation-duration: 3s;">
                <div class="w-full h-full rounded-full border-2 border-transparent border-t-blue-500 border-r-blue-500 opacity-50"></div>
            </div>
        </div>

        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2" id="connecting-title">Menghubungkan...</h3>
        <p class="text-sm text-gray-500 dark:text-gray-400 mb-8 max-w-[280px]" id="connecting-text">Sedang mencari server operator terbaik...</p>

        <!-- Progress Steps -->
        <div class="w-72 bg-gray-50 dark:bg-slate-800 rounded-2xl p-4 border border-gray-100 dark:border-slate-700 shadow-sm space-y-3">
            <div class="flex items-center gap-3 transition-all duration-300" id="step-1">
                <div class="step-icon w-6 h-6 rounded-full bg-gray-200 dark:bg-slate-700 flex items-center justify-center text-[10px] text-gray-400">
                    <i class="fas fa-circle"></i>
                </div>
                <div class="text-left">
                    <p class="text-xs font-bold text-gray-400 step-label">Verifikasi Nomor</p>
                    <p class="text-[10px] text-gray-400 step-desc">Mengecek validitas nomor</p>
                </div>
                <i class="fas fa-check text-green-500 ml-auto opacity-0 transform scale-50 transition-all duration-300 step-check"></i>
            </div>
            
            <div class="flex items-center gap-3 transition-all duration-300" id="step-2">
                <div class="step-icon w-6 h-6 rounded-full bg-gray-200 dark:bg-slate-700 flex items-center justify-center text-[10px] text-gray-400">
                    <i class="fas fa-circle"></i>
                </div>
                <div class="text-left">
                    <p class="text-xs font-bold text-gray-400 step-label">Cek Database</p>
                    <p class="text-[10px] text-gray-400 step-desc">Sinkronisasi paket unlimited</p>
                </div>
                 <i class="fas fa-check text-green-500 ml-auto opacity-0 transform scale-50 transition-all duration-300 step-check"></i>
            </div>
            
            <div class="flex items-center gap-3 transition-all duration-300" id="step-3">
                <div class="step-icon w-6 h-6 rounded-full bg-gray-200 dark:bg-slate-700 flex items-center justify-center text-[10px] text-gray-400">
                    <i class="fas fa-circle"></i>
                </div>
                <div class="text-left">
                    <p class="text-xs font-bold text-gray-400 step-label">Request Injeksi</p>
                    <p class="text-[10px] text-gray-400 step-desc">Membuat invoice tagihan</p>
                </div>
                 <i class="fas fa-check text-green-500 ml-auto opacity-0 transform scale-50 transition-all duration-300 step-check"></i>
            </div>
        </div>
    </div>

    <!-- Features Modal -->
    <div id="featuresModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[120] hidden flex items-end sm:items-center justify-center p-0 sm:p-4 transition-all opacity-0" onclick="closeModal('featuresModal')">
        <div class="bg-white dark:bg-slate-800 w-full sm:max-w-sm rounded-t-[30px] sm:rounded-2xl p-6 transform translate-y-full sm:translate-y-0 transition-transform duration-300 shadow-2xl" onclick="event.stopPropagation()">
            <div class="w-12 h-1 bg-slate-300 dark:bg-slate-600 rounded-full mx-auto mb-6 sm:hidden"></div>
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg text-slate-900 dark:text-white">Detail Paket</h3>
                <button onclick="closeModal('featuresModal')" class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center"><i class="fas fa-times"></i></button>
            </div>
            <ul class="space-y-3 text-sm text-slate-600 dark:text-slate-300 max-h-[60vh] overflow-y-auto" id="feature-list-ul">
                <!-- Filled by JS -->
            </ul>
        </div>
    </div>

    <!-- LOGIC SCRIPT -->
    <script>
        // --- CONFIG DATA ---
        const packages = [
            { id: 'pkg3', name: 'Paket 3 Bulan', price: 99000, normal: 150000, label: 'HEMAT' },
            { id: 'pkg6', name: 'Paket 6 Bulan', price: 179000, normal: 300000, label: 'BEST SELLER', best: true },
            { id: 'pkg12', name: 'Paket 12 Bulan', price: 299000, normal: 600000, label: 'PALING CUAN' }
        ];

        // COMPLETE PAYMENT METHODS
        const payments = [
            { id: 'qris', name: 'QRIS', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Logo_QRIS.svg/1200px-Logo_QRIS.svg.png', type: 'qr', acc: '00020101021126610016ID.CO.SHOPEE.WWW01189360091800223157700208223157700303UMI51440014ID.CO.QRIS.WWW0215ID10254270621910303UMI5204481453033605802ID5904Epay6013JAKARTA PUSAT61051061062070703A0163042F15' },
            { id: 'bca', name: 'BCA', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Bank_Central_Asia.svg/1200px-Bank_Central_Asia.svg.png', type: 'bank', acc: '39358089510639366', holder: 'Epayment' },
            { id: 'gopay', name: 'GoPay', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/86/Gopay_logo.svg/1200px-Gopay_logo.svg.png', type: 'ewallet', acc: '089510639366', holder: 'Gopay' },
            { id: 'dana', name: 'DANA', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Logo_dana_blue.svg/330px-Logo_dana_blue.svg.png', type: 'ewallet', acc: '089510639366', holder: 'DNID' },
            { id: 'ovo', name: 'OVO', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/eb/Logo_ovo_purple.svg/330px-Logo_ovo_purple.svg.png', type: 'ewallet', acc: '089510639366', holder: 'OVO' },
            { id: 'cimb', name: 'CIMB', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/CIMB_Niaga_logo.svg/330px-CIMB_Niaga_logo.svg.png', type: 'bank', acc: '6289510639366', holder: 'Octo Pay' }
        ];

        // FULL FEATURE LIST
        const fullFeatures = [
            "Internet Unlimited Tanpa Kuota (True Unlimited)",
            "Full Speed 24 Jam (Up to 100 Mbps)",
            "Support Semua Operator (Telkomsel, Indosat, XL, Axis, Tri, Smartfren)",
            "Bisa digunakan di Modem / Mifi / Orbit",
            "Bebas Tethering / Hotspot ke banyak device",
            "Akses Youtube, Netflix, Sosmed Lancar Tanpa Buffering",
            "Anti FUP (Fair Usage Policy) - Speed tidak akan turun",
            "Legal & Aman (Metode Inject Resmi)",
            "Garansi Full Selama Paket Aktif",
            "Support Game Online (Ping Stabil)",
            "Bisa diperpanjang di nomor yang sama",
            "Proses Aktivasi 5-15 Menit"
        ];

        // OPERATOR ASSETS (Enhanced Detection)
        const operatorLogos = {
            'Telkomsel': 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/bc/Telkomsel_2021_icon.svg/1200px-Telkomsel_2021_icon.svg.png',
            'Indosat': 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/08/Indosat_Ooredoo_logo_%282019%29.svg/330px-Indosat_Ooredoo_logo_%282019%29.svg.png',
            'XL': 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/XL_Axiata_2009.png/330px-XL_Axiata_2009.png',
            'Axis': 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Axis_logo_2015.svg/60px-Axis_logo_2015.svg.png',
            'Tri': 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/40/Three_logo.svg/250px-Three_logo.svg.png',
            'Smartfren': 'https://siplah.blibli.com/data/images/SACE-0031-00032/d48d6f57-7273-416a-9aab-49625e21f03f.png',
            'by.U': 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5a/Byu-logo-blue.svg/330px-Byu-logo-blue.svg.png'
        };

        const operatorPrefixes = {
            'Telkomsel': ['0811', '0812', '0813', '0821', '0822', '0823', '0851', '0852', '0853'],
            'by.U': ['0851'],
            'Indosat': ['0814', '0815', '0816', '0855', '0856', '0857', '0858'],
            'Tri': ['0895', '0896', '0897', '0898', '0899'],
            'XL': ['0817', '0818', '0819', '0859', '0877', '0878', '0879'],
            'Axis': ['0831', '0832', '0833', '0838'],
            'Smartfren': ['0881', '0882', '0883', '0884', '0885', '0886', '0887', '0888', '0889']
        };

        // FULL FAQs
        const faqs = [
            { q: "Apakah ini benar-benar unlimited?", a: "Ya, paket ini adalah paket inject unlimited tanpa FUP. Kecepatan tidak akan diturunkan meskipun pemakaian sudah besar." },
            { q: "Operator apa saja yang didukung?", a: "Kami mendukung semua operator GSM di Indonesia: Telkomsel, Indosat Ooredoo, XL Axiata, Axis, Tri (3), dan Smartfren." },
            { q: "Bagaimana cara perpanjangan paket?", a: "Untuk memperpanjang paket, Anda cukup melakukan pemesanan ulang di website ini dengan memasukkan nomor HP yang sama sebelum masa aktif berakhir." },
            { q: "Bagaimana jika tidak ingin perpanjang?", a: "Tidak masalah. Paket ini sistemnya beli putus. Jika masa aktif habis, paket otomatis berhenti." },
            { q: "Apakah ada batas pemakaian wajar (FUP)?", a: "Paket ini benar-benar Unlimited tanpa FUP. Anda bisa download bergiga-giga tanpa takut kecepatan turun." },
            { q: "Apakah paket ini legal?", a: "Legal 100%. Kami menggunakan jalur distribusi reseller resmi operator, bukan trik ilegal." },
            { q: "Apakah aman untuk nomor utama?", a: "Sangat aman. Metode yang kami gunakan adalah inject paket resmi promo khusus reseller." },
            { q: "Berapa lama proses masuknya?", a: "Setelah pembayaran terkonfirmasi, proses injeksi paket biasanya memakan waktu 5 hingga 15 menit." },
            { q: "Jika paket tidak masuk, apakah ada garansi?", a: "Tentu saja. Jika dalam 1x24 jam paket tidak berhasil diaktifkan, uang Anda akan kami kembalikan 100%." },
            { q: "Apakah bisa untuk modem/orbit?", a: "Bisa banget! Paket ini support untuk digunakan di Smartphone, Modem, Mifi, maupun Router Orbit." }
        ];

        // FAKE SALES NOTIFICATIONS
        const FIRST_NAMES = [ "Budi", "Ayu", "Rahmat", "Citra", "Bayu", "Lina", "Wulan", "Adi", "Farhan", "Hendra", "Nana", "Joko", "Mega", "Gilang", "Sari", "Dedi", "Eka", "Teguh", "Putri", "Andi", "Bagus", "Ilham", "Rizal", "Mira", "Puspita", "Hari", "Tri", "Cahya", "Surya", "Wahyu", "Agus", "Indra", "Linda", "Fajar", "Yusuf", "Pramono", "Sinta", "Bima", "Dian", "Hasan", "Nurul", "Arif", "Feri", "Lukman", "Rangga", "Rini", "Tono", "Hadi", "Elisa", "Anisa", "Gunawan", "Melati", "Septi", "Cindy", "Windi", "Galih", "Evi", "Putra", "Slamet", "Latif", "Gita", "Darmawan", "Maya", "Erik", "Jani", "Jefri", "Bella", "Maulana", "Novi", "Fajar", "Taufik", "Prasetyo", "Samsul", "Agung", "Endang", "Indah", "Hana", "Mirna", "Yulia", "Panca", "Niken", "Rio", "Ganda", "Wahida", "Robby", "Halim", "Firman", "Berlian", "Ari" ];
        
        // 15 UNIQUE TEXT TESTIMONIALS
        const testimonials = [
            { name: "Rudi Hartono", text: "Awalnya ragu, tapi ternyata beneran work! Hemat banget.", stars: 5 },
            { name: "Siti Aminah", text: "Admin fast respon, 5 menit kuota langsung masuk.", stars: 5 },
            { name: "Budi Santoso", text: "Speed kenceng, buat streaming Netflix lancar jaya.", stars: 4 },
            { name: "Dewi Lestari", text: "Recommended seller! Bakal langganan terus.", stars: 5 },
            { name: "Eko Prasetyo", text: "Mantap gan, no tipu-tipu. Sesuai deskripsi.", stars: 5 },
            { name: "Andi Wijaya", text: "Harga paling murah dibanding lapak lain. Top!", stars: 5 },
            { name: "Rina Yulianti", text: "Proses cepat, pelayanan ramah. Terima kasih Flash Quota.", stars: 5 },
            { name: "Dimas Anggara", text: "Sinyal stabil, gak ada FUP beneran. Puas banget.", stars: 5 },
            { name: "Maya Sari", text: "Udah order ke-3 kalinya, selalu aman dan cepat.", stars: 5 },
            { name: "Hendra Gunawan", text: "Solusi hemat kuota sekeluarga. Makasih min!", stars: 5 },
            { name: "Rizky Pratama", text: "Gokil, injectnya cepet banget. Langsung connect.", stars: 5 },
            { name: "Fajar Sidik", text: "Buat main game ping stabil, jarang lag.", stars: 4 },
            { name: "Sari Indah", text: "Customer service sangat membantu pas ada kendala.", stars: 5 },
            { name: "Bayu Nugroho", text: "Tampilannya pro banget, transaksinya juga mudah.", stars: 5 },
            { name: "Citra Kirana", text: "Worth it banget parah. Jangan ragu beli disini.", stars: 5 }
        ];

        // --- STATE ---
        let state = {
            pkg: 'pkg6',
            pay: 'qris',
            unique: Math.floor(Math.random() * (500 - 100) + 100),
            discount: 0,
            dark: false
        };

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            initUI();
            loadDraft();
            loadHistory();
            startLoops();
            initNotifications();
        });

        // --- UI RENDERERS ---
        function initUI() {
            // Packages
            document.getElementById('pkg-list').innerHTML = packages.map(p => {
                const disc = Math.round(((p.normal - p.price) / p.normal) * 100);
                const isSel = state.pkg === p.id;
                return `
                <div onclick="selectPkg('${p.id}')" class="pkg-card group relative overflow-hidden bg-white dark:bg-slate-800 border-2 ${isSel ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20' : 'border-slate-100 dark:border-slate-700'} rounded-2xl p-4 transition-all cursor-pointer hover:border-blue-300">
                    ${p.best ? '<div class="absolute top-0 right-0 bg-gradient-to-bl from-blue-600 to-blue-400 text-white text-[9px] font-bold px-2 py-1 rounded-bl-xl">BEST SELLER</div>' : ''}
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="w-5 h-5 rounded-full border-2 ${isSel ? 'border-blue-500 bg-blue-500' : 'border-slate-300 dark:border-slate-600'} flex items-center justify-center transition-colors">
                                <i class="fas fa-check text-white text-[10px] ${isSel ? 'scale-100' : 'scale-0'} transition-transform"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-slate-800 dark:text-white text-sm">${p.name}</h4>
                                <div class="flex items-center gap-2 mt-0.5">
                                    <span class="text-[9px] bg-red-100 text-red-600 px-1.5 rounded font-bold">HEMAT ${disc}%</span>
                                    <span class="text-xs text-slate-400 line-through">Rp${p.normal.toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                        <p class="font-bold text-lg text-blue-600 dark:text-blue-400">Rp${p.price.toLocaleString()}</p>
                    </div>
                </div>`;
            }).join('');

            // Payments
            document.getElementById('pay-list').innerHTML = payments.map(p => `
                <div onclick="selectPay('${p.id}')" class="pay-card border-2 ${state.pay === p.id ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20' : 'border-slate-100 dark:border-slate-700 bg-white dark:bg-slate-800'} rounded-xl p-3 flex flex-col items-center justify-center gap-2 h-20 cursor-pointer hover:border-blue-300 transition-all">
                    <img src="${p.logo}" class="h-5 object-contain filter dark:brightness-200 dark:grayscale">
                    <span class="text-[10px] font-bold text-slate-600 dark:text-slate-300 text-center leading-tight">${p.name}</span>
                </div>
            `).join('');

            // Testimonials
            const tHtml = testimonials.map(t => `
                <div class="inline-block bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 p-4 rounded-xl w-64 shrink-0 mx-2 shadow-sm relative overflow-hidden group">
                    <div class="absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity">
                        <i class="fas fa-quote-right text-4xl"></i>
                    </div>
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 text-white flex items-center justify-center font-bold text-xs shadow-md">
                            ${t.name.charAt(0)}
                        </div>
                        <div>
                            <p class="text-xs font-bold text-slate-800 dark:text-white leading-tight">${t.name}</p>
                            <div class="flex text-yellow-400 text-[9px] mt-0.5">
                                ${'<i class="fas fa-star"></i>'.repeat(t.stars)}
                            </div>
                        </div>
                    </div>
                    <p class="text-xs text-slate-500 dark:text-slate-400 italic leading-relaxed relative z-10">"${t.text}"</p>
                </div>
            `).join('');
            document.getElementById('testimonial-track').innerHTML = tHtml + tHtml;

            // FAQs
            document.getElementById('faq-container').innerHTML = faqs.map(f => `
                <details class="group bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl overflow-hidden">
                    <summary class="flex justify-between items-center p-4 font-bold text-sm text-slate-700 dark:text-slate-200 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition">
                        ${f.q}
                        <i class="fas fa-chevron-down text-slate-400 transition-transform group-open:rotate-180"></i>
                    </summary>
                    <div class="px-4 pb-4 text-xs text-slate-500 dark:text-slate-400 leading-relaxed border-t border-slate-100 dark:border-slate-700/50 pt-2">
                        ${f.a}
                    </div>
                </details>
            `).join('');

            // Full Features List in Modal
            document.getElementById('feature-list-ul').innerHTML = fullFeatures.map(feat => `
                <li class="flex gap-3 items-start"><i class="fas fa-check-circle text-green-500 mt-1"></i> ${feat}</li>
            `).join('');

            updateSummary();
        }

        // --- ACTIONS ---
        function selectPkg(id) {
            state.pkg = id;
            document.getElementById('selectedPkg').value = id;
            initUI(); 
        }

        function selectPay(id) {
            state.pay = id;
            document.getElementById('selectedPay').value = id;
            initUI();
        }

        function updateSummary() {
            const p = packages.find(x => x.id === state.pkg);
            let total = p.price + state.unique - state.discount;
            if (total < 0) total = 0;

            document.getElementById('summary-total').innerText = `Rp${total.toLocaleString()}`;
            if (state.discount > 0) {
                const el = document.getElementById('summary-discount');
                el.classList.remove('hidden');
                el.innerText = `-Rp${state.discount.toLocaleString()}`;
            }
        }

        function switchTab(tab) {
            ['home', 'history', 'help'].forEach(t => {
                document.getElementById(`view-${t}`).classList.add('hidden');
            });
            document.getElementById(`view-${tab}`).classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('text-blue-600', 'dark:text-blue-400');
                el.classList.add('text-slate-400');
                el.querySelector('i').classList.remove('animate-bounce');
            });
            const activeBtn = document.querySelector(`.nav-item[onclick="switchTab('${tab}')"]`);
            activeBtn.classList.remove('text-slate-400');
            activeBtn.classList.add('text-blue-600', 'dark:text-blue-400');
            
            const chk = document.getElementById('checkout-bar');
            if(tab === 'home') {
                chk.classList.remove('translate-y-full', 'absolute', 'opacity-0');
            } else {
                chk.classList.add('translate-y-full', 'absolute', 'opacity-0');
            }
        }

        function formatPhone(input) {
            let num = input.value.replace(/\D/g, '');
            if (num.length > 4) num = num.substring(0,4) + '-' + num.substring(4);
            if (num.length > 9) num = num.substring(0,9) + '-' + num.substring(9);
            input.value = num.substring(0, 15);
        }

        function checkOperator(input) {
            const rawNum = input.value.replace(/-/g, '');
            const logoImg = document.getElementById('operator-logo');
            
            if(rawNum.length >= 4) {
                const prefix = rawNum.substring(0, 4);
                let op = null;
                
                for (const operator in operatorPrefixes) {
                    if (operatorPrefixes[operator].includes(prefix)) {
                        op = operator;
                        break;
                    }
                }

                if(op && operatorLogos[op]) {
                    logoImg.src = operatorLogos[op];
                    logoImg.classList.remove('hidden');
                } else {
                    logoImg.classList.add('hidden');
                }
            } else {
                logoImg.classList.add('hidden');
            }
        }

        // --- CHECKOUT PROCESS ---
        async function processCheckout() {
            const nama = document.getElementById('nama').value;
            const wa = document.getElementById('whatsapp').value;
            const email = document.getElementById('email').value;
            
            if(!nama || wa.length < 10 || !email) {
                showToast('Mohon lengkapi semua data', 'error');
                return;
            }
            
            if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showToast('Email tidak valid', 'error');
                return;
            }

            await runConnectionAnimation();

            const p = packages.find(x => x.id === state.pkg);
            const pay = payments.find(x => x.id === state.pay);
            const total = p.price + state.unique - state.discount;
            
            const now = new Date();
            const rL = () => "ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(Math.random() * 26));
            const rD = () => Math.floor(Math.random() * 10);
            const orderId = `INV-INJECT-${String(now.getFullYear()).slice(-2)}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}-${rL()}${rD()}${rL()}${rD()}`;

            // Save comprehensive order details
            const order = {
                id: orderId,
                date: new Date().toLocaleDateString('id-ID'),
                timestamp: now.getTime(),
                expiry: now.getTime() + (24 * 60 * 60 * 1000), // 24h
                pkgName: p.name,
                price: total,
                payMethodId: pay.id,
                payMethodName: pay.name,
                payAcc: pay.acc,
                payHolder: pay.holder,
                payType: pay.type,
                payLogo: pay.logo,
                status: 'pending',
                customer: { nama, wa, email }
            };

            saveHistory(order);

            // Submit to Google Sheet (Async)
            const scriptURL = 'https://script.google.com/macros/s/AKfycbySaAB2WT0D59UlLyZcXliWvNURCnHcRrqz5P8C2LCQbVdk0hn3Qkl1glGiLJSql_Wh/exec';
            const dataToSend = {
                nama: nama,
                whatsapp: wa,
                email: email,
                paket: p.name,
                metodePembayaran: pay.name,
                totalTransfer: `Rp${total.toLocaleString('id-ID')}`,
                idPembayaran: orderId,
                nomorRekening: pay.acc || '-',
                sheetName: 'inject'
            };

            fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dataToSend)
            }).catch(e => console.log('Offline mode'));

            renderPaymentView(order);
            document.getElementById('view-payment').classList.remove('translate-x-full');
        }

        function renderPaymentView(order) {
            document.getElementById('pay-oid').innerText = order.id;
            document.getElementById('pay-total').innerText = `Rp ${order.price.toLocaleString()}`;
            document.getElementById('pay-logo').src = order.payLogo;
            
            // Countdown
            const timerEl = document.getElementById('pay-timer');
            // Clear existing interval if any (simple hack: reliable enough for SPA)
            if(window.payInterval) clearInterval(window.payInterval);
            
            window.payInterval = setInterval(() => {
                const now = new Date().getTime();
                const dist = order.expiry - now;
                
                if (dist < 0) {
                    clearInterval(window.payInterval);
                    timerEl.innerText = "EXPIRED";
                    return;
                }
                
                const h = Math.floor((dist % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((dist % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((dist % (1000 * 60)) / 1000);
                timerEl.innerText = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
            }, 1000);

            const content = document.getElementById('pay-content');
            const instructions = document.getElementById('instruction-steps');

            if(order.payType === 'qr') {
                try {
                    const qrisDynamic = createDynamicQris(order.payAcc, order.price);
                    content.innerHTML = `
                        <div class="flex flex-col items-center">
                            <div class="bg-white p-2 border-2 border-slate-800 rounded-xl mb-2">
                                <div id="qrcode-canvas"></div>
                            </div>
                            <button onclick="downloadQR('${order.id}')" class="text-xs bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 px-3 py-1.5 rounded-lg font-bold flex items-center gap-1 hover:bg-slate-200">
                                <i class="fas fa-download"></i> Simpan QRIS
                            </button>
                        </div>
                    `;
                    setTimeout(() => {
                        const canvasContainer = document.getElementById('qrcode-canvas');
                        if(canvasContainer) {
                            canvasContainer.innerHTML = '';
                            const canvas = document.createElement('canvas');
                            QRCode.toCanvas(canvas, qrisDynamic, { width: 180, margin: 1 }, (err) => {
                                if (!err) canvasContainer.appendChild(canvas);
                            });
                        }
                    }, 100);

                    instructions.innerHTML = `
                        <div class="flex gap-3"><div class="w-6 h-6 rounded-full bg-blue-500 text-white flex items-center justify-center text-xs font-bold shrink-0">1</div><p class="text-xs text-slate-600 dark:text-slate-300">Buka aplikasi E-Wallet/Banking.</p></div>
                        <div class="flex gap-3"><div class="w-6 h-6 rounded-full bg-blue-500 text-white flex items-center justify-center text-xs font-bold shrink-0">2</div><p class="text-xs text-slate-600 dark:text-slate-300">Scan QR Code diatas.</p></div>
                        <div class="flex gap-3"><div class="w-6 h-6 rounded-full bg-blue-500 text-white flex items-center justify-center text-xs font-bold shrink-0">3</div><p class="text-xs text-slate-600 dark:text-slate-300">Pastikan nominal <b>Rp ${order.price.toLocaleString()}</b>.</p></div>
                    `;
                } catch (e) {
                    content.innerHTML = '<p class="text-red-500 text-center text-xs">Gagal memuat QRIS.</p>';
                }
            } else {
                content.innerHTML = `
                    <div class="bg-slate-100 p-4 rounded-xl text-center border border-slate-200">
                        <p class="text-xs text-slate-500 mb-1">Nomor Rekening / VA</p>
                        <p class="text-xl font-mono font-bold text-slate-800 select-all" id="pay-acc-text">${order.payAcc}</p>
                        <p class="text-xs font-bold text-slate-600 mt-1">A.N ${order.payHolder || 'Official'}</p>
                        <button onclick="copyToClip('pay-acc-text')" class="text-[10px] text-blue-600 mt-2 font-bold hover:underline">Salin Nomor</button>
                    </div>
                `;
                 instructions.innerHTML = `
                        <div class="flex gap-3"><div class="w-6 h-6 rounded-full bg-blue-500 text-white flex items-center justify-center text-xs font-bold shrink-0">1</div><p class="text-xs text-slate-600 dark:text-slate-300">Buka aplikasi bank/e-wallet.</p></div>
                        <div class="flex gap-3"><div class="w-6 h-6 rounded-full bg-blue-500 text-white flex items-center justify-center text-xs font-bold shrink-0">2</div><p class="text-xs text-slate-600 dark:text-slate-300">Transfer ke <b>${order.payMethodName}</b>.</p></div>
                        <div class="flex gap-3"><div class="w-6 h-6 rounded-full bg-blue-500 text-white flex items-center justify-center text-xs font-bold shrink-0">3</div><p class="text-xs text-slate-600 dark:text-slate-300">Nominal: <b>Rp ${order.price.toLocaleString()}</b>.</p></div>
                    `;
            }

            // WA Link
            const waMsg = encodeURIComponent(`Halo Admin, saya sudah transfer.\n\nNo Invoice: *${order.id}*\nNomor Target: *${order.customer.wa}*\nPaket: *${order.pkgName}*\nTotal: *Rp${order.price.toLocaleString('id-ID')}*\n\nMohon dicek. Terima kasih.`);
            document.getElementById('btn-confirm-wa').href = `https://wa.me/6285602152097?text=${waMsg}`;
        }

        function restorePayment(orderId) {
            const hist = JSON.parse(localStorage.getItem('fq_history') || '[]');
            const order = hist.find(o => o.id === orderId);
            if(order) {
                renderPaymentView(order);
                document.getElementById('view-payment').classList.remove('translate-x-full');
            }
        }

        function downloadQR(filename) {
            const canvas = document.querySelector('#qrcode-canvas canvas');
            if(canvas) {
                const link = document.createElement('a');
                link.download = `QRIS-${filename || 'Payment'}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            }
        }

        // --- ANIMATIONS & VISUALS ---
        function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

        async function runConnectionAnimation() {
            const overlay = document.getElementById('connecting-overlay');
            const title = document.getElementById('connecting-title');
            const text = document.getElementById('connecting-text');
            
            overlay.classList.remove('hidden');
            overlay.classList.add('flex');
            overlay.classList.remove('opacity-0');
            
            // Reset steps
            ['step-1', 'step-2', 'step-3'].forEach(id => {
               const el = document.getElementById(id);
               const icon = el.querySelector('.step-icon');
               const label = el.querySelector('.step-label');
               const desc = el.querySelector('.step-desc');
               const check = el.querySelector('.step-check');

               icon.className = 'step-icon w-6 h-6 rounded-full bg-gray-200 dark:bg-slate-700 flex items-center justify-center text-[10px] text-gray-400';
               icon.innerHTML = '<i class="fas fa-circle"></i>';
               
               label.classList.remove('text-gray-900', 'dark:text-white');
               label.classList.add('text-gray-400');
               
               desc.classList.remove('text-gray-600', 'dark:text-gray-300');
               desc.classList.add('text-gray-400');
               
               check.classList.add('opacity-0', 'scale-50');
               check.classList.remove('opacity-100', 'scale-100');
            });

            const activateStep = (id) => {
                const el = document.getElementById(id);
                const icon = el.querySelector('.step-icon');
                const label = el.querySelector('.step-label');
                const desc = el.querySelector('.step-desc');
                
                icon.classList.remove('bg-gray-200', 'text-gray-400', 'dark:bg-slate-700');
                icon.classList.add('bg-blue-100', 'text-blue-600');
                icon.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                
                label.classList.remove('text-gray-400');
                label.classList.add('text-gray-900', 'dark:text-white');
                
                desc.classList.remove('text-gray-400');
                desc.classList.add('text-gray-600', 'dark:text-gray-300');
            };
            
            const finishStep = (id) => {
                const el = document.getElementById(id);
                const icon = el.querySelector('.step-icon');
                const check = el.querySelector('.step-check');
                
                icon.innerHTML = '<i class="fas fa-check"></i>';
                icon.classList.remove('bg-blue-100', 'text-blue-600');
                icon.classList.add('bg-green-100', 'text-green-600');
                
                check.classList.remove('opacity-0', 'scale-50');
                check.classList.add('opacity-100', 'scale-100');
            };

            // Sequence
            title.innerText = "Verifikasi Nomor";
            text.innerText = "Mengecek validitas nomor tujuan...";
            activateStep('step-1');
            await sleep(1500);
            finishStep('step-1');

            title.innerText = "Sinkronisasi Server";
            text.innerText = "Menghubungkan ke database operator...";
            activateStep('step-2');
            await sleep(1500);
            finishStep('step-2');

            title.innerText = "Finalisasi";
            text.innerText = "Membuat invoice tagihan...";
            activateStep('step-3');
            await sleep(1500);
            finishStep('step-3');

            title.innerText = "Berhasil!";
            text.innerText = "Mengalihkan ke halaman pembayaran...";
            await sleep(800);

            // Fade out
            overlay.classList.add('opacity-0');
            await sleep(300);
            overlay.classList.remove('flex');
            overlay.classList.add('hidden');
        }

        function closePayment() {
            document.getElementById('view-payment').classList.add('translate-x-full');
        }

        function checkPaymentStatus() {
            const btn = document.getElementById('btn-check-status');
            const originalText = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Mengecek...';
            
            setTimeout(() => {
                // Modified: Now fails by default as requested
                btn.innerHTML = '<i class="fas fa-exclamation-circle"></i> Belum Diterima';
                btn.classList.remove('bg-slate-200', 'text-slate-700', 'dark:bg-slate-800', 'dark:text-slate-300');
                btn.classList.add('bg-red-500', 'text-white');
                
                showToast('Pembayaran belum masuk. Mohon konfirmasi WA.', 'error');
                
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                    btn.classList.remove('bg-red-500', 'text-white');
                    btn.classList.add('bg-slate-200', 'text-slate-700');
                }, 3000);
            }, 2000);
        }

        // --- HISTORY & STORAGE ---
        function saveHistory(order) {
            let hist = JSON.parse(localStorage.getItem('fq_history') || '[]');
            // Only add if not exists (for updates)
            if(!hist.find(o => o.id === order.id)) {
                hist.unshift(order);
                localStorage.setItem('fq_history', JSON.stringify(hist));
            }
            loadHistory();
        }

        function loadHistory() {
            const hist = JSON.parse(localStorage.getItem('fq_history') || '[]');
            const container = document.getElementById('history-list');
            
            if(hist.length === 0) return;

            const now = new Date().getTime();

            container.innerHTML = hist.map(h => {
                const isExpired = h.expiry && now > h.expiry;
                const statusHtml = isExpired 
                    ? `<span class="text-[10px] text-red-600 bg-red-50 px-2 py-0.5 rounded-full font-bold">Expired</span>`
                    : `<span class="text-[10px] text-yellow-600 bg-yellow-50 px-2 py-0.5 rounded-full font-bold">Menunggu</span>`;
                
                const actionBtn = (!isExpired && h.status === 'pending') 
                    ? `<button onclick="restorePayment('${h.id}')" class="mt-2 text-xs bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400 px-3 py-1.5 rounded-lg font-bold w-full hover:bg-blue-200">Bayar Sekarang</button>`
                    : ``;

                return `
                <div class="bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700 shadow-sm">
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-[10px] font-mono bg-slate-100 dark:bg-slate-700 px-1.5 rounded text-slate-500">#${h.id.split('-')[1] || h.id}</span>
                                <span class="text-[10px] text-slate-400">${h.date}</span>
                            </div>
                            <h4 class="font-bold text-sm text-slate-800 dark:text-white">${h.pkgName || h.pkg}</h4>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-blue-600 dark:text-blue-400 text-sm">Rp${h.price.toLocaleString()}</p>
                            ${statusHtml}
                        </div>
                    </div>
                    ${actionBtn}
                </div>
            `}).join('');
        }

        function saveDraft() {
            const data = {
                nama: document.getElementById('nama').value,
                whatsapp: document.getElementById('whatsapp').value,
                email: document.getElementById('email').value
            };
            localStorage.setItem('fq_draft', JSON.stringify(data));
            
            if(data.nama) document.getElementById('check-nama').classList.remove('opacity-0');
            else document.getElementById('check-nama').classList.add('opacity-0');
        }

        function loadDraft() {
            const data = JSON.parse(localStorage.getItem('fq_draft'));
            if(data) {
                if(data.nama) {
                    document.getElementById('nama').value = data.nama;
                    document.getElementById('check-nama').classList.remove('opacity-0');
                }
                if(data.whatsapp) {
                    document.getElementById('whatsapp').value = data.whatsapp;
                    checkOperator(document.getElementById('whatsapp'));
                }
                if(data.email) document.getElementById('email').value = data.email;
            }
        }

        // --- CORE QRIS LOGIC (FIXED FROM TESTA.HTML) ---
        function createDynamicQris(qris, nominal) {
            let qrisModified = qris.slice(0, -4).replace("010211", "010212");
            const nominalStr = String(Math.round(nominal));
            const amountLength = nominalStr.length < 10 ? "0" + nominalStr.length : nominalStr.length.toString();
            const amountPart = "54" + amountLength + nominalStr;
            
            if (qrisModified.includes("5802ID")) {
                let parts = qrisModified.split("5802ID");
                qrisModified = parts[0] + amountPart + "5802ID" + parts[1];
            }
            
            // Recalculate CRC
            const crc = crc16ccitt(qrisModified);
            return qrisModified + crc;
        }

        function crc16ccitt(str) {
            let crc = 0xFFFF;
            for (let c = 0; c < str.length; c++) {
                crc ^= str.charCodeAt(c) << 8;
                for (let i = 0; i < 8; i++) {
                    if (crc & 0x8000) crc = (crc << 1) ^ 0x1021;
                    else crc = crc << 1;
                }
            }
            return (crc & 0xFFFF).toString(16).toUpperCase().padStart(4, "0");
        }

        function applyVoucher() {
            const code = document.getElementById('voucher').value.toUpperCase();
            const msg = document.getElementById('voucher-msg');
            
            if(code === 'NEWYEAR') {
                state.discount = 15000;
                msg.innerHTML = '<i class="fas fa-check"></i> Potongan Rp15.000 digunakan!';
                msg.className = "text-[10px] px-2 text-green-500 font-bold block animate-pulse";
            } else {
                state.discount = 0;
                msg.innerHTML = '<i class="fas fa-times"></i> Kode tidak valid';
                msg.className = "text-[10px] px-2 text-red-500 font-bold block";
            }
            msg.classList.remove('hidden');
            updateSummary();
        }

        function showToast(msg, type='normal') {
            const el = document.createElement('div');
            const colors = type === 'error' ? 'bg-red-500' : (type === 'success' ? 'bg-green-500' : 'bg-slate-800');
            el.className = `toast ${colors} text-white px-4 py-2 rounded-full shadow-lg text-xs font-bold flex items-center gap-2 transform translate-y-[-20px] opacity-0`;
            el.innerHTML = type === 'success' ? `<i class="fas fa-check-circle"></i> ${msg}` : msg;
            
            document.getElementById('toast-container').appendChild(el);
            
            requestAnimationFrame(() => {
                el.classList.remove('translate-y-[-20px]', 'opacity-0');
            });

            setTimeout(() => {
                el.classList.add('opacity-0', 'translate-y-[-20px]');
                setTimeout(() => el.remove(), 500);
            }, 3000);
        }

        function copyToClip(content) {
            const txt = content === 'pay-total' || content === 'pay-acc-text' 
                ? document.getElementById(content).innerText.replace(/[^0-9]/g,'') 
                : content;
            navigator.clipboard.writeText(txt).then(() => showToast('Berhasil disalin!', 'success'));
        }

        // --- CHAT & MODALS ---
        function toggleChat() {
            const box = document.getElementById('chat-box');
            if(box.classList.contains('opacity-0')) {
                box.classList.remove('opacity-0', 'translate-y-10', 'pointer-events-none');
            } else {
                box.classList.add('opacity-0', 'translate-y-10', 'pointer-events-none');
            }
        }

        function sendChat() {
            const input = document.getElementById('chat-input');
            const msg = input.value.trim();
            if(!msg) return;
            
            const area = document.getElementById('chat-messages');
            area.innerHTML += `
                <div class="flex gap-2 justify-end">
                    <div class="bg-blue-600 p-2 rounded-tl-xl rounded-b-xl text-xs text-white shadow-sm max-w-[80%]">${msg}</div>
                </div>
            `;
            input.value = '';
            area.scrollTop = area.scrollHeight;

            // Auto reply
            setTimeout(() => {
                area.innerHTML += `
                    <div class="flex gap-2">
                        <div class="w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 text-xs shrink-0 mt-1"><i class="fas fa-robot"></i></div>
                        <div class="bg-white dark:bg-slate-800 p-2 rounded-tr-xl rounded-b-xl text-xs text-slate-600 dark:text-slate-300 shadow-sm border border-slate-100 dark:border-slate-700 max-w-[80%]">
                            Mohon maaf, saat ini kami sedang melayani banyak pelanggan. Silakan hubungi via WhatsApp untuk respon cepat.
                        </div>
                    </div>
                `;
                area.scrollTop = area.scrollHeight;
            }, 1500);
        }

        function openModal(id) {
            const m = document.getElementById(id);
            m.classList.remove('hidden');
            setTimeout(() => { 
                m.classList.remove('opacity-0'); 
                m.children[0].classList.remove('translate-y-full'); 
            }, 10);
        }

        function closeModal(id) {
            const m = document.getElementById(id);
            m.classList.add('opacity-0');
            m.children[0].classList.add('translate-y-full');
            setTimeout(() => m.classList.add('hidden'), 300);
        }
        
        // --- NOTIFICATIONS & LOOPS ---
        function initNotifications() {
            setInterval(() => {
                const name = FIRST_NAMES[Math.floor(Math.random() * FIRST_NAMES.length)];
                const pkg = Math.random() > 0.5 ? "Paket 6 Bulan" : "Paket 12 Bulan";
                
                const el = document.createElement('div');
                el.className = "bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm border border-slate-200 dark:border-slate-700 p-3 rounded-2xl shadow-xl flex items-center gap-3 w-max max-w-[90%] toast transform translate-y-[-100%] opacity-0";
                el.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600 shrink-0"><i class="fas fa-check"></i></div>
                    <div>
                        <p class="text-[10px] font-bold text-slate-800 dark:text-white">${name}</p>
                        <p class="text-[9px] text-slate-500">Baru saja membeli ${pkg}</p>
                    </div>
                `;
                
                document.getElementById('toast-container').appendChild(el);
                
                // Animation In
                requestAnimationFrame(() => {
                    el.classList.remove('translate-y-[-100%]', 'opacity-0');
                });
                
                // Remove
                setTimeout(() => {
                    el.classList.add('translate-y-[-100%]', 'opacity-0');
                    setTimeout(() => el.remove(), 500);
                }, 4000);
                
            }, 8000 + Math.random() * 5000); // Random interval
        }

        function startLoops() {
            // Theme
            initTheme();
            
            // Time
            setInterval(() => {
                const h = new Date().getHours();
                const greet = h < 11 ? 'Selamat Pagi' : (h < 15 ? 'Selamat Siang' : (h < 18 ? 'Selamat Sore' : 'Selamat Malam'));
                document.getElementById('greeting-time').innerText = greet + ', Kak!';
            }, 60000);
            
            // Ping
            setInterval(() => {
                const ping = Math.floor(Math.random() * (45 - 15) + 15);
                const el = document.getElementById('ping-val');
                el.innerText = ping + 'ms';
                el.className = `font-mono text-[9px] ml-1 opacity-70 ${ping > 40 ? 'text-red-500' : 'text-green-500'}`;
            }, 3000);

            // Flash Sale Timer
            let duration = 5 * 3600;
            setInterval(() => {
                duration--;
                if(duration < 0) duration = 5 * 3600;
                const h = Math.floor(duration/3600).toString().padStart(2,'0');
                const m = Math.floor((duration%3600)/60).toString().padStart(2,'0');
                const s = (duration%60).toString().padStart(2,'0');
                document.getElementById('flash-timer').innerText = `${h}:${m}:${s}`;
            }, 1000);
        }

        function initTheme() {
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }

        function toggleDarkMode() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
        }
    </script>
</body>
</html>
