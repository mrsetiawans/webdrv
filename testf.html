<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Upgrade iCloud+ 2TB - Penawaran Spesial!</title>
    <link rel="icon" type="image/png" href="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1c/ICloud_logo.svg/320px-ICloud_logo.svg.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.1/qrcode.min.js"></script>
    
    <!-- Meta Pixel Code -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '630583642253416');
      fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=630583642253416&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->

    <style>
        :root {
            --primary: #007aff;
            --primary-dark: #005ecb;
            --secondary: #F5F5F7;
            --text-main: #1D1D1F;
            --text-secondary: #86868B;
            --success: #34C759;
            --error: #FF3B30;
            --border: #D2D2D7;
            --bg-page: #FBFBFD;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-page);
            color: var(--text-main);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Modern Card & Layout */
        .main-container {
            max-width: 520px;
            margin: 0 auto;
            min-height: 100vh;
            background: white;
            box-shadow: 0 0 40px rgba(0,0,0,0.05);
        }

        @media (min-width: 640px) {
            .main-container {
                min-height: auto;
                margin: 40px auto;
                border-radius: 24px;
                border: 1px solid rgba(0,0,0,0.05);
            }
            body {
                background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                padding-bottom: 40px;
            }
        }

        /* Glassmorphism Header */
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        /* Inputs */
        .input-group {
            position: relative;
            margin-bottom: 16px;
        }
        
        .modern-input {
            width: 100%;
            padding: 14px 16px;
            font-size: 15px;
            border: 1px solid var(--border);
            border-radius: 12px;
            outline: none;
            transition: all 0.2s ease;
            background: #F5F5F7;
            color: var(--text-main);
        }

        .modern-input:focus {
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .input-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        /* Package Selection Cards */
        .package-card {
            border: 2px solid transparent;
            border-radius: 16px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #fff;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .package-card.selected {
            border-color: var(--primary);
            background: #F0F7FF;
        }

        .package-check {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #C7C7CC;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .package-card.selected .package-check {
            background: var(--primary);
            border-color: var(--primary);
        }

        .package-check::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            color: white;
            font-size: 10px;
            opacity: 0;
            transform: scale(0);
            transition: all 0.2s;
        }

        .package-card.selected .package-check::after {
            opacity: 1;
            transform: scale(1);
        }

        /* Payment Grid */
        .payment-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .payment-option {
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            height: 70px;
            position: relative;
        }

        .payment-option:hover {
            border-color: #b0b0b5;
            background: #fafafa;
        }

        .payment-option.selected {
            border-color: var(--primary);
            background: #F0F7FF;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.1);
        }

        .payment-option img {
            height: 24px;
            width: auto;
            object-fit: contain;
            margin-bottom: 4px;
        }
        
        .payment-option span {
            font-size: 10px;
            color: var(--text-main);
            font-weight: 500;
            text-align: center;
        }

        /* Checkout Button */
        .btn-checkout {
            background: var(--primary);
            color: white;
            border: none;
            width: 100%;
            padding: 16px;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s, background 0.2s;
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.25);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-checkout:active {
            transform: scale(0.98);
        }
        
        .btn-checkout:disabled {
            background: #B0B0B5;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Features List */
        .feature-item {
            display: flex;
            align-items: start;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 14px;
            color: var(--text-main);
            line-height: 1.5;
        }

        .feature-icon {
            color: var(--success);
            margin-top: 3px;
        }

        /* Notification Toast */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: white;
            padding: 12px 20px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 100;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            width: max-content;
            max-width: 90%;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        /* Testimonial Carousel (Marquee) */
        .testimonial-carousel {
            overflow: hidden;
            width: 100%;
            position: relative;
            mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
            -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
        }
        
        .testimonial-track {
            display: flex;
            gap: 12px;
            width: max-content;
            animation: marquee 40s linear infinite;
            padding: 4px 0; /* space for shadow/border */
        }

        .testimonial-track:hover {
            animation-play-state: paused;
        }

        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .testimonial-item {
            flex-shrink: 0;
            width: 140px;
            height: 140px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .testimonial-item:hover {
            transform: scale(1.02);
        }

        .testimonial-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* FAQ Accordion */
        .faq-item {
            border-bottom: 1px solid var(--border);
        }
        .faq-item:last-child {
            border-bottom: none;
        }
        .faq-item summary {
            padding: 16px 0;
            cursor: pointer;
            font-weight: 500;
            list-style: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .faq-item summary::after {
            content: '\f078';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            transition: transform 0.2s;
            font-size: 12px;
            color: var(--text-secondary);
        }
        .faq-item[open] summary::after {
            transform: rotate(180deg);
        }
        .faq-content {
            padding-bottom: 16px;
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.4s ease forwards;
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal-box {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-overlay.active .modal-box {
            transform: scale(1);
        }
        
        /* Details Modal (Bottom Sheet style) */
        #detailsModal {
             align-items: flex-end;
        }
        #detailsModal .modal-box { /* Override default modal-box for bottom sheet */
            width: 100%;
            max-width: 520px; /* Match main container width */
            margin: 0 auto;
            border-radius: 20px 20px 0 0;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #detailsModal.active .modal-box {
            transform: translateY(0);
        }
        
        /* Payment Instruction Styles */
        .instruction-step {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }
        .step-number {
            width: 24px;
            height: 24px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .copy-btn {
            background: rgba(0, 122, 255, 0.1);
            color: var(--primary);
            border: none;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <!-- Notification Toast -->
    <div id="toast" class="toast">
        <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600 flex-shrink-0">
            <i class="fas fa-check"></i>
        </div>
        <div class="text-sm">
            <p class="font-semibold text-gray-900" id="toast-name">Budi Santoso</p>
            <p class="text-gray-500 text-xs">Baru saja upgrade iCloud+ 2TB</p>
        </div>
    </div>

    <div class="main-container relative">
        <!-- Main Form View -->
        <div id="view-form">
            <!-- Header -->
            <div class="sticky-header px-6 py-4 flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1c/ICloud_logo.svg/320px-ICloud_logo.svg.png" alt="iCloud Logo" class="w-8 h-8 object-contain">
                    <div>
                        <h1 class="font-bold text-lg leading-none">iCloud+</h1>
                        <p class="text-xs text-gray-500 font-medium">Upgrade Resmi</p>
                    </div>
                </div>
                <div class="bg-blue-50 text-blue-600 px-3 py-1 rounded-full text-xs font-semibold">
                    <i class="fas fa-check-circle mr-1"></i> Garansi
                </div>
            </div>

            <div class="p-6 pb-24">
                <!-- Hero / Product Info -->
                <div class="text-center mb-8 animate-fade-in">
                    <span class="inline-block bg-red-100 text-red-600 px-3 py-1 rounded-full text-xs font-bold mb-3 animate-pulse">
                        ðŸ”¥ PENAWARAN SPESIAL
                    </span>
                    <h2 class="text-2xl font-bold mb-2">Upgrade iCloud+ 2TB</h2>
                    <p class="text-gray-500 text-sm px-4">Simpan foto, video, dan file dengan aman. Upgrade legal ke Apple ID pribadi.</p>
                </div>

                <!-- Form -->
                <form id="orderForm" class="space-y-6">
                    
                    <!-- Package Selection -->
                    <div class="space-y-3 animate-fade-in" style="animation-delay: 0.1s">
                        <label class="text-sm font-semibold text-gray-700 ml-1">Pilih Paket</label>
                        <div id="package-selection-container" class="space-y-3">
                            <!-- Package cards will be rendered here by JavaScript -->
                        </div>
                        <input type="hidden" id="selectedPackage" name="package" value="yearly">
                    </div>

                    <!-- Features -->
                    <div class="bg-gray-50 rounded-xl p-4 border border-gray-100 animate-fade-in" style="animation-delay: 0.15s">
                        <div class="feature-item"><i class="fas fa-check-circle feature-icon"></i> <span>Kapasitas 2TB untuk Foto & Video</span></div>
                        <div class="feature-item"><i class="fas fa-check-circle feature-icon"></i> <span>Relai Pribadi iCloud (Private Relay)</span></div>
                        <div class="feature-item"><i class="fas fa-check-circle feature-icon"></i> <span>Sembunyikan Email Saya</span></div>
                        <div class="feature-item"><i class="fas fa-check-circle feature-icon"></i> <span>Video Aman HomeKit</span></div>
                        <button type="button" onclick="showFeaturesModal()" class="text-blue-600 text-sm font-semibold mt-2 hover:underline">Lihat Semua Fitur & Detail</button>
                    </div>

                    <!-- Testimonials -->
                    <div class="animate-fade-in" style="animation-delay: 0.18s">
                        <label class="text-sm font-semibold text-gray-700 ml-1 mb-2 block">Bukti Pelanggan</label>
                        <div class="testimonial-carousel" id="testimonial-container">
                            <!-- Filled by JS -->
                        </div>
                    </div>

                    <!-- User Data -->
                    <div class="space-y-4 animate-fade-in" style="animation-delay: 0.2s">
                        <label class="text-sm font-semibold text-gray-700 ml-1">Data Pemesan</label>
                        
                        <div class="input-group">
                            <input type="text" id="nama" name="nama" class="modern-input" placeholder="Nama Lengkap" required>
                            <i class="fas fa-user input-icon"></i>
                        </div>
                        
                        <div class="input-group">
                            <input type="tel" id="whatsapp" name="whatsapp" class="modern-input" placeholder="Nomor WhatsApp (08xx)" required inputmode="numeric">
                            <i class="fab fa-whatsapp input-icon"></i>
                        </div>

                        <div class="input-group">
                            <input type="email" id="email" name="email" class="modern-input" placeholder="Email Apple ID (Gmail/iCloud)" required>
                            <i class="fas fa-envelope input-icon"></i>
                        </div>
                    </div>

                    <div class="bg-red-50 border-l-4 border-red-600 p-3 my-4 rounded-r-lg shadow-sm flex items-center gap-3">
                        <div class="flex-shrink-0">
                            <i class="fas fa-exclamation-circle text-xl text-red-600 animate-pulse"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-red-700 text-sm uppercase">PENTING: Cek Kembali Data Anda!</h3>
                            <p class="text-sm text-gray-700 leading-tight mt-0.5">
                                Pastikan <strong>No. WhatsApp</strong> & <strong>Email Apple ID</strong> yang Anda masukkan sudah <strong>BENAR</strong>.
                            </p>
                        </div>
                    </div>

                    <!-- Hidden Fields -->
                    <input type="text" name="honeypot" style="display: none" tabindex="-1" autocomplete="off">
                    <input type="hidden" name="sheetName" value="upstorage">

                    <!-- Payment Method -->
                    <div class="space-y-3 animate-fade-in" style="animation-delay: 0.25s">
                        <label class="text-sm font-semibold text-gray-700 ml-1">Metode Pembayaran</label>
                        <div class="payment-grid" id="payment-grid">
                            <!-- Generated by JS -->
                        </div>
                        <input type="hidden" id="selectedPayment" name="payment-method" value="qris">
                    </div>

                </form>

                <!-- FAQ Section -->
                <div class="mt-8 animate-fade-in" style="animation-delay: 0.3s">
                    <h3 class="font-bold text-gray-900 mb-4">Pertanyaan Umum (FAQ)</h3>
                    <div id="faq-container">
                        <!-- Filled by JS -->
                    </div>
                </div>

                <!-- Trust Badges -->
                <div class="mt-8 flex justify-center gap-4 opacity-50 grayscale hover:grayscale-0 transition-all duration-300">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Logo_QRIS.svg/1200px-Logo_QRIS.svg.png" class="h-6">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Bank_Central_Asia.svg/1200px-Bank_Central_Asia.svg.png" class="h-6">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/86/Gopay_logo.svg/1200px-Gopay_logo.svg.png" class="h-6">
                </div>
                
                <p class="text-center text-xs text-gray-400 mt-8">Â© 2025 iCloud+ Reseller. All Rights Reserved.</p>
            </div>

            <!-- Sticky Bottom Bar -->
            <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-[0_-4px_20px_rgba(0,0,0,0.05)] z-40 sm:absolute sm:rounded-b-3xl">
                <div class="max-w-[520px] mx-auto flex items-center justify-between gap-4">
                    <div>
                        <p class="text-xs text-gray-500">Total Pembayaran</p>
                        <p class="text-xl font-bold text-blue-600" id="total-price-display">Rp 350.xxx</p>
                    </div>
                    <button type="button" id="submit-btn" class="btn-checkout flex-1" onclick="handleFormSubmit()">
                        Beli Sekarang <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Payment Instruction View (Hidden by default) -->
        <div id="view-payment" class="hidden min-h-screen bg-gray-50 sm:rounded-3xl overflow-hidden">
             <div class="bg-white p-4 sticky top-0 z-10 border-b flex items-center gap-3 shadow-sm">
                <button onclick="backToForm()" class="text-gray-500 hover:text-black">
                    <i class="fas fa-arrow-left text-lg"></i>
                </button>
                <h2 class="font-bold text-lg">Instruksi Pembayaran</h2>
            </div>

            <div class="p-6 pb-24">
                <!-- Timer -->
                <div class="bg-blue-600 text-white rounded-xl p-4 text-center mb-6 shadow-lg shadow-blue-200">
                    <p class="text-xs opacity-80 mb-1">Selesaikan pembayaran dalam</p>
                    <div class="text-2xl font-bold font-mono" id="countdown">23:59:59</div>
                </div>

                <!-- Total Amount Card -->
                <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm mb-6 text-center relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gray-200"></div>
                    <p class="text-gray-500 text-sm mb-1">Total yang harus dibayar</p>
                    <div class="flex items-center justify-center gap-2 mb-2">
                         <h1 class="text-3xl font-bold text-gray-900" id="payment-amount">Rp 350.123</h1>
                         <button class="copy-btn" onclick="copyText('payment-amount-raw')"><i class="far fa-copy"></i></button>
                    </div>
            <p class="text-xs text-red-500 bg-red-50 inline-block px-2 py-1 rounded mb-4">
                        <i class="fas fa-exclamation-circle"></i> Transfer tepat hingga 3 digit terakhir
                    </p>
             <div id="invoice-details-summary" class="border-t border-gray-100 pt-3 text-xs text-gray-500 flex justify-between items-center">
                <!-- Populated by JS -->
             </div>
                </div>

                <!-- Payment Details -->
                <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm mb-6">
                    <div class="flex items-center justify-between mb-4 pb-4 border-b border-gray-100">
                        <span class="text-gray-500 text-sm">Metode</span>
                        <img id="payment-logo-result" src="" class="h-6 object-contain">
                    </div>
                    
                    <!-- Dynamic Content based on Payment Method -->
                    <div id="payment-details-content">
                        <!-- Filled by JS -->
                    </div>
                </div>

                <!-- Instructions -->
                <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                    <h3 class="font-bold text-gray-900 mb-4">Langkah Pembayaran</h3>
                    <div id="instruction-steps">
                        <!-- Filled by JS -->
                    </div>
                </div>
                
                <!-- Confirmation Button -->
                <a id="wa-confirm-btn" href="#" target="_blank" class="block mt-8 w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-xl text-center shadow-lg shadow-green-200 transition-all">
                    <i class="fab fa-whatsapp text-lg mr-2"></i> Konfirmasi Pembayaran
                </a>
            </div>
        </div>
    </div>

    <!-- Details Modal -->
    <div id="detailsModal" class="modal-overlay" onclick="closeModal('detailsModal')">
        <div class="modal-box text-left p-0" id="detailsModalContent" onclick="event.stopPropagation()">
            <!-- Content will be injected by JS -->
        </div>
    </div>

    <!-- Modals -->
    <!-- Info Modal -->
    <div id="infoModal" class="modal-overlay">
        <div class="modal-box">
            <div class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">
                <i class="fas fa-info"></i>
            </div>
            <h3 class="text-xl font-bold mb-2" id="modalTitle">Judul</h3>
            <p class="text-gray-500 mb-6" id="modalMessage">Pesan</p>
            <button onclick="closeModal('infoModal')" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl">Mengerti</button>
        </div>
    </div>

    <!-- Features Modal -->
    <div id="featuresModal" class="modal-overlay">
        <div class="modal-box text-left">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">Detail Fitur</h3>
                <button onclick="closeModal('featuresModal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="space-y-4 max-h-[60vh] overflow-y-auto pr-2" id="features-list-container">
                <!-- Features filled by JS -->
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal-overlay" onclick="closeModal('imageModal')">
        <div class="relative max-w-[90%] max-h-[90vh]">
             <img id="modalImageDisplay" src="" class="rounded-xl shadow-2xl max-h-[80vh] w-auto">
             <button class="absolute top-4 right-4 bg-black/50 text-white rounded-full w-8 h-8 flex items-center justify-center" onclick="closeModal('imageModal')">&times;</button>
        </div>
    </div>

    <script>
        // --- DATA & CONFIG ---
        const uniqueCode = Math.floor(Math.random() * (500 - 100 + 1)) + 100;
        
        // RESTORED DATA
        const FIRST_NAMES = [ "Budi Santoso", "Ayu", "Rahmat", "Citra Dewi Kusuma", "Bayu Pratama", "Lina", "Wulan", "Adi", "Farhan Syahputra", "Hendra Wijaya", "Nana Puspita Dewi", "Joko", "Mega Sari", "Gilang Pramana Putra", "Sari", "Dedi", "Eka Suryani", "Teguh", "Putri Lestari Ayu", "Andi", "Bagus Wijaya", "Ilham Saputra Nugraha", "Rizal", "Mira Astuti", "Puspita", "Hari", "Tri Saputra", "Cahya Pratama", "Surya Darmawan Putra", "Wahyu Ramadhan", "Agus", "Indra Permana", "Linda", "Fajar Mahendra Saputra", "Yusuf", "Pramono Adi Nugroho", "Sinta Dewi", "Bima Pratama", "Dian", "Hasan Basri", "Nurul Aini", "Arif Budiman", "Feri", "Lukman Hakim", "Rangga", "Rini Anggraini Putri", "Tono", "Hadi Prasetyo", "Elisa Purnama", "Anisa Rahma", "Gunawan", "Melati", "Bagus Prasetyo Ramadhan", "Septi Amelia", "Cindy Amelia", "Windi Saputri", "Galih Pratama", "Evi", "Putra", "Slamet Riyadi", "Latif Hidayat", "Gita Puspita", "Darmawan", "Maya", "Erik Saputra Pratama", "Jani", "Jefri Maulana", "Bella Sari", "Maulana", "Novi Andriana Lestari", "Fajar Nugroho", "Taufik Hidayat", "Prasetyo", "Samsul", "Agung", "Endang", "Indah", "Hana Pertiwi", "Mirna", "Yulia", "Panca", "Niken", "Rio", "Adi Putra Ramadhan", "Ganda", "Wahida", "Robby Saputra", "Halim", "Firman Saputra", "Berlian Putra", "Ari", "Joko Setiawan", "Mustika", "Bahar", "Mega", "Erlangga", "Sofyan", "Doni", "Fatimah", "Dian Purnama Sari", "Rama", "Imam Saputra", "Johan", "Gusman", "Lintang", "Nabila", "Beni", "Purnama", "Murni", "Malik", "Nurlan", "Doni Saputra", "Lastri", "Berlinda", "Rasyid", "Tari", "Nia", "Tirta", "Juli Andriani", "Lutfi", "Suci", "Arman", "Yani", "Citra Ayu", "Harto", "Rangga Pratama", "Febrina", "Indra Gunawan Saputra", "Tomi", "Sutrisno", "Risma", "Jihan Ayu Pratiwi", "Lestari", "Dewi Kusuma", "Fahmi", "Rifki", "Wira", "Putra Wijaya", "Beni Setiawan", "Asep", "Gerry", "Prasetia", "Euis", "Latif", "Pajar", "Rahmat Hidayat", "Rudi", "Tika", "Danu", "Hesti", "Syahrul", "Anwar", "Miranti", "Nuraini", "Nurman", "Eman Kurnia", "Nirmala", "Hari Susanto", "Taufan", "Tono Prabowo", "Bayu Saputra Nugroho", "Darma", "Nurlaila", "Hafid", "Mustofa", "Elok", "Gunarto", "Novi", "Lasman", "Jamaludin", "Andi Wijaya Putra", "Herman", "Mila", "Wibowo", "Prayitno", "Adi Saputra", "Jamal", "Irfan", "Iskandar", "Yudha", "Lutris", "Samsul Hidayat", "Heru", "Bagus", "Rudianto", "Nanda Putri", "Laila Rahma", "Frans", "Hilda", "Cahya", "Rudi Pratama", "Setiawan", "Rangga Saputra", "Puspa", "Doni Prasetyo", "Nurul", "Febri", "Mega Sari Lestari", "Suyatno", "Tomiadi", "Fikri", "Lani", "Intan", "Johan Saputra", "Iwan", "Berliano", "Ilham", "Teddy", "Lani Puspita", "Eka Putri Andayani", "Hani", "Adi Wijaya", "Adit", "Dicky", "Gopal", "Pramono", "Gunadi", "Gilang", "Joko Prayitno Adi", "Mira", "Puspita Sari", "Maulana Hakim", "Putri Ayu Lestari", "Malik Prasetyo", "Toriq", "Joni", "Gilang Pratama", "Bagus Wijaya Putra", "Berlian", "Wandi", "Nurman Saputra", "Fajarudin", "Lutfi Pratama", "Citra", "Nanda", "Laras", "Tuti", "Yani Pratiwi", "Gusman Saputra", "Rangga Putra", "Prasetiawan", "Ismail", "Heri", "Adi Nugroho", "Putri", "Prasetyo Adi", "Dona", "Gani", "Jihan", "Puspita Dewi", "Rizal Maulana", "Mahendra", "Ayu Pratiwi", "Rangga Setiawan", "Lina Sari", "Fani", "Adi Wijaya Putra", "Sari Melati", "Andri", "Bima", "Teguh Santoso Adi", "Fajar", "Wulan Dewi", "Rama Pratama", "Nana", "Farhan", "Dion", "Melati Pertiwi", "Adi Putra", "Joko Santoso", "Doni Setiawan", "Lintang Pertiwi", "Septi", "Gopal Pramana", "Tomi Pratama", "Rio Nugraha", "Cindy", "Hafid Saputra", "Hendra", "Niken Lestari", "Rangga Nugroho", "Putri Ayu", "Sofyan Hidayat", "Robby", "Bima Saputra", "Indra", "Adi Kurniawan", "Nanda Saputra", "Gilang Saputra", "Wahyu", "Puspita Ayu", "Rudi Hartono", "Wulan Dewi Pertiwi", "Ayu Pratiwi Lestari", "Tono Adi", "Dedi Kurniawan", "Prasetyo Ramadhan", "Adi Setiawan", "Mira Lestari", "Farhan Syahputra Adi", "Nurul Hidayah", "Sari Anggraini", "Bayu", "Eman", "Putra Adi Nugroho", "Lestari Ayu", "Bambang", "Rangga Hidayat", "Mega Putri", "Adi Nugraha", "Anisa", "Siska", "Wandi Putra", "Fajar Saputra", "Gunawan Pratama", "Heri Setiawan", "Arif", "Ilham Nugroho", "Bagus Pratama", "Erlangga Putra", "Rian", "Pandu", "Tari Ayu", "Hendro", "Risma Ayu", "Adi Pratama", "Septi Ayu", "Bambang Santoso", "Lukman", "Gani Saputra", "Hasan", "Feri Kurniawan", "Tirta", "Bambang Prasetyo", "Pajar Saputra", "Arman Putra", "Murni Ayu", "Hafiz", "Euis Sari", "Bayu Nugroho", "Tomi Saputra", "Gerry Pratama", "Arif Prasetyo", "Johan Putra", "Hafid Nugraha", "Nabila Pertiwi", "Latif Saputra", "Ari Saputra", "Rio Saputra", "Tono Saputra", "Wandi Saputra", "Mahendra Putra", "Ilham Pratama", "Putri Dewi", "Adi Lestari", "Rangga Maulana", "Bayu Hidayat", "Fani Puspita", "Taufik", "Bagus Saputra", "Novi Puspita", "Rahmat Hidayatullah Putra", "Prayitno Saputra", "Adi Ramadhan", "Bayu Wijaya", "Gilang Nugraha", "Rangga Prasetyo", "Putra Purnama", "Wulan Pertiwi", "Adi Wijaya Ramadhan", "Budi", "Rian Pratama", "Samsul Nugroho", "Wahyu Saputra", "Teguh Prasetyo", "Fikri Nugraha", "Rizki Pratama" ];
        
        const testimonialImages = [
            "https://pixvid.org/images/2025/10/24/kEZMJ.jpg",
            "https://pixvid.org/images/2025/10/24/kEZcj.jpg",
            "https://pixvid.org/images/2025/10/24/kEgWD.jpg",
            "https://pixvid.org/images/2025/10/24/kEgFp.jpg",
            "https://pixvid.org/images/2025/10/24/kEgxI.jpg",
            "https://pixvid.org/images/2025/10/24/kEgL0.jpg",
            "https://pixvid.org/images/2025/10/24/kEzzW.jpg",
            "https://pixvid.org/images/2025/10/24/kEzuR.jpg",
            "https://pixvid.org/images/2025/10/24/kEzGt.jpg",
            "https://pixvid.org/images/2025/10/24/kEzfK.jpg",
            "https://pixvid.org/images/2025/10/24/kE7Hy.jpg",
            "https://pixvid.org/images/2025/10/24/kE7KG.jpg",
            "https://pixvid.org/images/2025/10/24/kE7as.jpg",
            "https://pixvid.org/images/2025/10/24/kEHPL.jpg",
            "https://pixvid.org/images/2025/10/24/kEHrU.jpg",
            "https://pixvid.org/images/2025/10/24/kEHoZ.jpg",
            "https://pixvid.org/images/2025/10/24/kEHXr.jpg",
            "https://pixvid.org/images/2025/10/24/kEQUw.jpg",
            "https://pixvid.org/images/2025/10/24/kEQlE.jpg",
            "https://pixvid.org/images/2025/10/24/kEQ69.jpg",
            "https://pixvid.org/images/2025/10/24/kEQsS.jpg",
            "https://pixvid.org/images/2025/10/24/kERm2.jpg",
            "https://pixvid.org/images/2025/10/24/kERhV.jpg",
            "https://pixvid.org/images/2025/10/24/kER9k.jpg",
            "https://pixvid.org/images/2025/10/24/kERNg.jpg",
            "https://pixvid.org/images/2025/10/24/kErCO.jpg",
            "https://pixvid.org/images/2025/10/24/kErwF.jpg",
            "https://pixvid.org/images/2025/10/24/kErdn.jpg",
            "https://pixvid.org/images/2025/10/24/kEr3M.jpg",
            "https://pixvid.org/images/2025/10/24/kEOZa.jpg",
            "https://pixvid.org/images/2025/10/24/kEOYB.jpg",
            "https://pixvid.org/images/2025/10/24/kEOAf.jpg",
            "https://pixvid.org/images/2025/10/24/kEOVm.jpg",
            "https://pixvid.org/images/2025/10/24/kEl7z.jpg",
            "https://pixvid.org/images/2025/10/24/kElJl.jpg"
        ];
        
        const fullFeaturesList = [
            "Kapasitas 2TB: Simpan semua foto, video, file, dan backup perangkat Anda dengan aman.",
            "Relai Pribadi iCloud: Jelajahi web dengan lebih aman dan pribadi di Safari.",
            "Sembunyikan Email Saya: Buat alamat email acak untuk menjaga kerahasiaan email pribadi Anda.",
            "Domain Email Khusus: Personalisasi alamat email iCloud Anda dengan domain sendiri.",
            "Video Aman HomeKit: Simpan rekaman kamera keamanan rumah Anda dengan enkripsi end-to-end.",
            "Gunakan Email Pribadi Anda: Upgrade dilakukan langsung pada akun Apple ID (iCloud) pribadi Anda.",
            "100% Aman & Bergaransi: Proses legal melalui fitur Apple One Premier, privasi terjamin.",
            "Support iPhone, iPad, Mac, Windows",
            "Bisa Family Sharing (sebagai member)"
        ];
        
        const faqList = [
            { q: "Apakah ini benar-benar 2TB?", a: "Ya, Anda akan mendapatkan kapasitas 2TB. Kami menawarkan paket berlangganan selama 1 tahun. Paket ini menggunakan email pribadi Anda." },
            { q: "Bagaimana proses upgrade iCloud+ ini?", a: "Prosesnya sangat mudah. Kami akan mengundang email (Apple ID) Anda untuk bergabung ke dalam langganan Apple One Premier kami. Setelah Anda menerima undangan, kapasitas iCloud Anda akan otomatis menjadi 2TB beserta semua fitur iCloud+." },
            { q: "Apakah ini aman dan legal?", a: "Tentu saja. Metode yang kami gunakan 100% legal melalui fitur Apple Family Sharing. Kami tidak pernah meminta password Apple ID Anda. Privasi data dan file Anda sepenuhnya terjamin karena setiap anggota keluarga memiliki penyimpanan pribadi yang tidak bisa diakses oleh anggota lain." },
            { q: "Apa bedanya dengan langganan iCloud+ langsung ke Apple?", a: "Langganan langsung ke Apple memerlukan pembayaran bulanan atau tahunan yang berulang. Dengan paket kami, Anda bisa mendapatkan harga yang jauh lebih murah." },
            { q: "Apakah file lama saya akan hilang?", a: "Tidak akan. Karena upgrade ini diterapkan pada akun Apple ID pribadi Anda, semua file dan data lama Anda akan tetap aman di tempatnya dan secara otomatis menjadi bagian dari penyimpanan 2TB yang baru." },
            { q: "Berapa lama proses aktivasinya?", a: "Prosesnya sangat cepat. Setelah Anda melakukan konfirmasi pembayaran, undangan akan kami kirimkan dan aktivasi biasanya selesai dalam waktu 5-15 menit." },
            { q: "Apakah ada garansi?", a: "Kami memberikan garansi uang kembali penuh jika proses upgrade gagal karena kesalahan dari pihak kami." }
        ];

        const packages = {
            yearly: {
                id: 'yearly',
                name: "iCloud+ 2TB (1 Tahun)",
                price: 350000,
                normalPrice: 2028000
            }
        };

        const paymentMethods = [
            { id: 'qris', name: 'QRIS', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Logo_QRIS.svg/163px-Logo_QRIS.svg.png', type: 'qr', number: '00020101021126610016ID.CO.SHOPEE.WWW01189360091800223157700208223157700303UMI51440014ID.CO.QRIS.WWW0215ID10254270621910303UMI5204481453033605802ID5904Epay6013JAKARTA PUSAT61051061062070703A0163042F15' },
            { id: 'bca_va', name: 'BCA', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Bank_Central_Asia.svg/330px-Bank_Central_Asia.svg.png', type: 'bank', number: '39358089510639366', holder: 'Epayment' },
            { id: 'gopay', name: 'GoPay', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/86/Gopay_logo.svg/320px-Gopay_logo.svg.png', type: 'ewallet', number: '089510639366', holder: 'Gopay' },
            { id: 'dana', name: 'DANA', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Logo_dana_blue.svg/330px-Logo_dana_blue.svg.png', type: 'ewallet', number: '089510639366', holder: 'DNID' },
            { id: 'ovo', name: 'OVO', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/eb/Logo_ovo_purple.svg/330px-Logo_ovo_purple.svg.png', type: 'ewallet', number: '089510639366', holder: 'OVO' },
            { id: 'cimb', name: 'CIMB', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/CIMB_Niaga_logo.svg/330px-CIMB_Niaga_logo.svg.png', type: 'bank', number: '6289510639366', holder: 'Octo Pay' }
        ];

        const operatorPrefixes = {
            'Telkomsel': ['0811', '0812', '0813', '0821', '0822', '0823', '0851', '0852', '0853'],
            'by.U': ['0851'],
            'Indosat Ooredoo': ['0814', '0815', '0816', '0855', '0856', '0857', '0858'],
            'Tri (3)': ['0895', '0896', '0897', '0898', '0899'],
            'XL Axiata': ['0817', '0818', '0819', '0859', '0877', '0878', '0879'],
            'Live.On': ['0859'],
            'Axis': ['0831', '0832', '0833', '0838'],
            'Smartfren': ['0881', '0882', '0883', '0884', '0885', '0886', '0887', '0888', '0889']
        };
        const blacklistedNumbers = ['081234567890'];
        const allowedEmailDomains = [
            'gmail.com', 'googlemail.com', 'outlook.com', 'hotmail.com',
            'hotmail.co.uk', 'live.com', 'msn.com', 'yahoo.com', 'yahoo.co.id',
            'yahoo.co.uk', 'ymail.com', 'rocketmail.com', 'icloud.com', 'me.com',
            'mac.com', 'aol.com', 'zoho.com', 'proton.me', 'protonmail.com',
            'tutanota.com', 'gmx.com', 'gmx.de', 'mail.com', 'yandex.ru',
            'yandex.com', 'fastmail.com', 'hey.com'
        ];
    
        function isInvalidPattern(nomor) {
            if (blacklistedNumbers.includes(nomor)) return true;
            const numberPart = nomor.substring(2);
            if (/(\d)\1{4,}/.test(numberPart)) return true;
            for (let i = 0; i < numberPart.length - 4; i++) {
                const sub = numberPart.substring(i, i + 5);
                const isAscending = '0123456789'.includes(sub);
                const isDescending = '9876543210'.includes(sub);
                if (isAscending || isDescending) return true;
            }
            const uniqueDigits = new Set(numberPart.split(''));
            if (uniqueDigits.size < 4) return true;
            if (/(..)\1\1/.test(numberPart)) return true;
            return false;
        }
    
        function getOperatorFromNumber(nomor) {
            const prefix = nomor.substring(0, 4);
            for (const operator in operatorPrefixes) {
                if (operatorPrefixes[operator].includes(prefix)) {
                    return operator;
                }
            }
            return null;
        }
    
        function validatePhoneNumber(nomorHp) {
            const genericError = { isValid: false, message: 'Silahkan isi dengan nomor yang benar' };
    
            if (nomorHp.length < 10) {
                return genericError;
            }
    
            const operator = getOperatorFromNumber(nomorHp);
            if (!operator) {
                return genericError;
            }
    
            const maxLength = operator === 'Tri (3)' ? 13 : 12;
            if (nomorHp.length > maxLength) {
                return genericError;
            }
    
            if (isInvalidPattern(nomorHp)) {
                return genericError;
            }
    
            return { isValid: true, message: 'Nomor valid.' };
        }
        let currentPackage = 'yearly';
        let currentPayment = 'qris';
        let expiryTime;
        let countdownInterval;
        let currentOrderDetails = {};

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            renderPackageCards();
            renderPaymentMethods();
            renderTestimonials();
            renderFAQ();
            updateTotalPrice();
            initNotifications();
            
            // Input formatting
            const whatsappInput = document.getElementById('whatsapp');
            whatsappInput.addEventListener('input', (e) => {
                e.target.value = e.target.value.replace(/[^0-9]/g, '');
            });
        });

        // --- RENDER FUNCTIONS ---
        function renderPackageCards() {
            const container = document.getElementById('package-selection-container');
            if (!container) return;

            const formatCurrency = (amount) => `Rp ${amount.toLocaleString('id-ID')}`;

            const yearly = packages.yearly;
            const yearlyDiscount = Math.round(((yearly.normalPrice - yearly.price) / yearly.normalPrice) * 100);

            container.innerHTML = `
                <div class="package-card ${currentPackage === 'yearly' ? 'selected' : ''}" onclick="selectPackage('yearly')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="package-check"></div>
                            <div>
                                <p class="font-bold text-gray-900">1 TAHUN</p>
                                <p class="text-xs text-gray-500">Paling Hemat (Best Seller)</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-xs text-gray-400 line-through">${formatCurrency(yearly.normalPrice)}</p>
                            <p class="text-lg font-bold text-blue-600">${formatCurrency(yearly.price)}</p>
                        </div>
                    </div>
                    <div class="absolute top-0 right-0 bg-blue-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-bl-lg">
                        HEMAT ${yearlyDiscount}%
                    </div>
                </div>
            `;
        }

        function renderTestimonials() {
            const container = document.getElementById('testimonial-container');
            // Duplicate list twice for smoother infinite loop on wide screens
            const images = [...testimonialImages, ...testimonialImages];
            
            container.innerHTML = `
                <div class="testimonial-track">
                    ${images.map(url => `
                        <div class="testimonial-item" onclick="openImageModal('${url}')">
                            <img src="${url}" alt="Testimoni" loading="lazy">
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderFAQ() {
            const container = document.getElementById('faq-container');
            container.innerHTML = faqList.map(item => `
                <details class="faq-item">
                    <summary>${item.q}</summary>
                    <div class="faq-content">${item.a}</div>
                </details>
            `).join('');
        }
        
        function showFeaturesModal() {
            const container = document.getElementById('features-list-container');
            container.innerHTML = `<ul class="space-y-3">
                ${fullFeaturesList.map(feat => `
                    <li class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-green-500 mt-1"></i>
                        <span class="text-sm text-gray-700">${feat}</span>
                    </li>
                `).join('')}
            </ul>`;
            
            document.getElementById('featuresModal').classList.add('active');
        }

        function openImageModal(url) {
            document.getElementById('modalImageDisplay').src = url;
            document.getElementById('imageModal').classList.add('active');
        }

        function selectPackage(pkgId) {
            currentPackage = pkgId;
            document.getElementById('selectedPackage').value = pkgId;
            
            // Re-render the package cards to update the 'selected' state visually
            renderPackageCards();
            
            updateTotalPrice();
        }

        function selectPayment(paymentId) {
            currentPayment = paymentId;
            document.getElementById('selectedPayment').value = paymentId;
            
            // Visual Update
            document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('selected'));
            document.getElementById(`pay-opt-${paymentId}`).classList.add('selected');
        }

        function renderPaymentMethods() {
            const grid = document.getElementById('payment-grid');
            grid.innerHTML = paymentMethods.map((pm, idx) => `
                <div id="pay-opt-${pm.id}" class="payment-option ${idx === 0 ? 'selected' : ''}" onclick="selectPayment('${pm.id}')">
                    <img src="${pm.logo}" alt="${pm.name}">
                    <span>${pm.name}</span>
                </div>
            `).join('');
        }

        function updateTotalPrice() {
            const pkgPrice = packages[currentPackage].price;
            const total = pkgPrice + uniqueCode;
            document.getElementById('total-price-display').innerText = `Rp ${total.toLocaleString('id-ID')}`;
        }

        function validateForm() {
            const name = document.getElementById('nama').value.trim();
            const wa = document.getElementById('whatsapp').value.trim();
            const email = document.getElementById('email').value.trim();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if (!name) return { valid: false, msg: 'Nama wajib diisi' };
            
            const phoneValidationResult = validatePhoneNumber(wa);
            if (!phoneValidationResult.isValid) {
                return { valid: false, msg: phoneValidationResult.message };
            }

            if (!email || !emailRegex.test(email)) {
                return { valid: false, msg: 'Email tidak valid' };
            }

            const domain = email.split('@')[1];
            if (!allowedEmailDomains.includes(domain)) {
                return { valid: false, msg: 'Domain email tidak diizinkan. Harap gunakan email pribadi.' };
            }
            
            return { valid: true };
        }

        async function handleFormSubmit() {
            const validation = validateForm();
            if (!validation.valid) {
                showModal('Data Belum Lengkap', validation.msg);
                return;
            }

            const btn = document.getElementById('submit-btn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Memproses...';

            // Prepare Data
            const formData = new FormData(document.getElementById('orderForm'));
            const pkg = packages[currentPackage];
            const payment = paymentMethods.find(p => p.id === currentPayment);
            const totalPrice = pkg.price + uniqueCode;
            const now = new Date();
            const paymentId = `INV-ICLOUD-${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}${String(totalPrice).slice(-3)}`;
            
            // Prepare Object for Google Script
            const dataToSend = {
                nama: formData.get('nama'),
                whatsapp: formData.get('whatsapp'),
                email: formData.get('email'),
                paket: pkg.name,
                metodePembayaran: payment.name,
                totalTransfer: `Rp${totalPrice.toLocaleString('id-ID')}`,
                idPembayaran: paymentId,
                nomorRekening: payment.number || '-',
                sheetName: formData.get('sheetName')
            };
            
            // Send to Google Script
            const scriptURL = 'https://script.google.com/macros/s/AKfycbySaAB2WT0D59UlLyZcXliWvNURCnHcRrqz5P8C2LCQbVdk0hn3Qkl1glGiLJSql_Wh/exec';

            try {
                await fetch(scriptURL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dataToSend)
                });
                
                // Show Payment Page
                showPaymentPage(dataToSend, payment, totalPrice);
                
            } catch (error) {
                console.error('Error:', error);
                showModal('Error', 'Gagal memproses pesanan. Silakan coba lagi.');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Beli Sekarang <i class="fas fa-arrow-right"></i>';
            }
        }

        function showPaymentPage(data, paymentMethod, amount) {
            // Store details for modal
            const pkgDetails = packages[currentPackage];
            currentOrderDetails = {
                pkg: data.paket,
                totalPrice: amount,
                paymentId: data.idPembayaran,
                nama: data.nama,
                whatsapp: data.whatsapp,
                email: data.email,
                price: pkgDetails.price
            };

            // Hide Form, Show Payment
            document.getElementById('view-form').classList.add('hidden');
            document.getElementById('view-payment').classList.remove('hidden');
            window.scrollTo(0, 0);

            // Set Timer (24 hours)
            expiryTime = new Date().getTime() + (24 * 60 * 60 * 1000);
            startCountdown();

            // Populate Data
            document.getElementById('payment-amount').innerText = `Rp ${amount.toLocaleString('id-ID')}`;
            document.getElementById('payment-logo-result').src = paymentMethod.logo;

            // Populate invoice summary
            document.getElementById('invoice-details-summary').innerHTML = `
                <span>No. Invoice: <strong>${data.idPembayaran}</strong></span>
                <a href="#" onclick="showDetailsModal(event)" class="font-semibold text-blue-600">Lihat detail</a>
            `;

            // Generate WA Link
            const waMsg = `Halo, saya sudah transfer untuk pesanan:\n` +
                          `No Invoice: ${data.idPembayaran}\n` +
                          `Email Apple ID: ${data.email}\n` +
                          `Total: ${data.totalTransfer}\n\n` +
                          `Mohon segera diproses.`;
            document.getElementById('wa-confirm-btn').href = `https://wa.me/6285602152097?text=${encodeURIComponent(waMsg)}`;

            // Render Payment Details
            const detailsContainer = document.getElementById('payment-details-content');
            const instructionsContainer = document.getElementById('instruction-steps');
            
            // Raw amount for copy
            const rawAmountInputCheck = document.getElementById('payment-amount-raw');
            if (rawAmountInputCheck) {
                rawAmountInputCheck.value = amount;
            } else {
                const rawAmountInput = document.createElement('input');
                rawAmountInput.type = 'hidden';
                rawAmountInput.id = 'payment-amount-raw';
                rawAmountInput.value = amount;
                document.body.appendChild(rawAmountInput);
            }

            if (paymentMethod.type === 'qr') {
                // Generate QRIS
                try {
                    const qrisStatic = paymentMethod.number;
                    const qrisDynamic = createDynamicQris(qrisStatic, amount);
                    
                    detailsContainer.innerHTML = `
                        <div class="flex flex-col items-center">
                            <div id="qrcode-canvas" class="p-2 border rounded-lg mb-4 bg-white"></div>
                            <button id="download-qris-btn" class="btn-checkout w-auto px-6 py-2 text-sm" style="box-shadow: none; background: var(--secondary); color: var(--text-main); font-weight: 500;">
                                <i class="fas fa-download mr-2"></i> Unduh QRIS
                            </button>
                            <p class="text-xs text-center text-gray-500 mt-4">Scan QR Code diatas dengan aplikasi pembayaran apa saja.</p>
                        </div>
                    `;
                    
                    setTimeout(() => {
                        const qrContainer = document.getElementById('qrcode-canvas');
                        qrContainer.innerHTML = ''; // Clear previous QR
                        const canvas = document.createElement('canvas');
                        QRCode.toCanvas(canvas, qrisDynamic, { width: 200, margin: 1 }, (err) => {
                            if (err) {
                                console.error(err);
                                return;
                            }
                            qrContainer.appendChild(canvas);

                            // Add download functionality
                            document.getElementById('download-qris-btn').addEventListener('click', () => {
                                const link = document.createElement('a');
                                link.download = `QRIS-Pembayaran-${data.idPembayaran}.png`;
                                link.href = canvas.toDataURL('image/png');
                                link.click();
                            });
                        });
                    }, 100);

                    instructionsContainer.innerHTML = `
                        <div class="instruction-step"><div class="step-number">1</div><p class="text-sm">Buka aplikasi e-wallet (GoPay/OVO/Dana) atau Mobile Banking.</p></div>
                        <div class="instruction-step"><div class="step-number">2</div><p class="text-sm">Pilih menu Scan / Bayar.</p></div>
                        <div class="instruction-step"><div class="step-number">3</div><p class="text-sm">Scan QR Code yang muncul di layar.</p></div>
                        <div class="instruction-step"><div class="step-number">4</div><p class="text-sm">Cek nominal (pastikan sama) dan selesaikan pembayaran.</p></div>
                    `;

                } catch (e) {
                    detailsContainer.innerHTML = '<p class="text-red-500">Gagal memuat QRIS.</p>';
                }

            } else {
                // Bank / E-Wallet Number
                detailsContainer.innerHTML = `
                    <div class="bg-gray-50 p-4 rounded-lg flex items-center justify-between">
                        <div>
                            <p class="text-xs text-gray-500">Nomor Rekening / VA</p>
                            <p class="text-lg font-bold text-gray-800 tracking-wide">${paymentMethod.number}</p>
                            <p class="text-xs text-gray-500 mt-1">A.N ${paymentMethod.holder}</p>
                        </div>
                        <button class="copy-btn" onclick="copyText('${paymentMethod.number}')">
                            <i class="far fa-copy"></i> Salin
                        </button>
                    </div>
                `;

                 instructionsContainer.innerHTML = `
                        <div class="instruction-step"><div class="step-number">1</div><p class="text-sm">Buka aplikasi bank atau e-wallet Anda.</p></div>
                        <div class="instruction-step"><div class="step-number">2</div><p class="text-sm">Pilih menu Transfer ke ${paymentMethod.name}.</p></div>
                        <div class="instruction-step"><div class="step-number">3</div><p class="text-sm">Masukkan nomor rekening: <strong>${paymentMethod.number}</strong></p></div>
                        <div class="instruction-step"><div class="step-number">4</div><p class="text-sm">Masukkan nominal <strong>Rp ${amount.toLocaleString('id-ID')}</strong> (harus tepat).</p></div>
                    `;
            }
        }

        function backToForm() {
            document.getElementById('view-payment').classList.add('hidden');
            document.getElementById('view-form').classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        // --- UTILS ---
        
        function startCountdown() {
            if (countdownInterval) clearInterval(countdownInterval);
            countdownInterval = setInterval(() => {
                const now = new Date().getTime();
                const distance = expiryTime - now;

                if (distance < 0) {
                    clearInterval(countdownInterval);
                    document.getElementById('countdown').innerHTML = "WAKTU HABIS";
                    return;
                }

                const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((distance % (1000 * 60)) / 1000);

                document.getElementById('countdown').innerHTML = 
                    `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            }, 1000);
        }

        function copyText(textOrId) {
            let text = textOrId;
            const element = document.getElementById(textOrId);
            if (element) text = element.value || element.innerText;

            navigator.clipboard.writeText(text).then(() => {
                showModal('Berhasil', 'Teks berhasil disalin ke clipboard');
            }, () => {
                // Fallback
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showModal('Berhasil', 'Teks berhasil disalin');
                } catch (err) {
                    console.error('Copy failed', err);
                }
                document.body.removeChild(textArea);
            });
        }

        function showModal(title, msg) {
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalMessage').innerText = msg;
            const modal = document.getElementById('infoModal');
            modal.classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }
        
        // Notifications Logic (RESTORED RANDOM NAMES)
        
        function initNotifications() {
            setInterval(() => {
                const name = FIRST_NAMES[Math.floor(Math.random() * FIRST_NAMES.length)];
                const toast = document.getElementById('toast');
                document.getElementById('toast-name').innerText = name;
                
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 4000);
            }, 15000 + Math.random() * 10000);
        }

        // --- QRIS GENERATOR UTILS (CRC16) ---
        function createDynamicQris(qris, nominal) {
            let qrisModified = qris.slice(0, -4).replace("010211", "010212");
            const nominalStr = String(Math.round(nominal));
            const amountLength = nominalStr.length < 10 ? "0" + nominalStr.length : nominalStr.length.toString();
            const amountPart = "54" + amountLength + nominalStr;
            
            if (qrisModified.includes("5802ID")) {
                let parts = qrisModified.split("5802ID");
                qrisModified = parts[0] + amountPart + "5802ID" + parts[1];
            } else {
                 // Fallback
            }
            
            // Recalculate CRC
            const crc = crc16ccitt(qrisModified);
            return qrisModified + crc;
        }

        function crc16ccitt(str) {
            let crc = 0xFFFF;
            for (let c = 0; c < str.length; c++) {
                crc ^= str.charCodeAt(c) << 8;
                for (let i = 0; i < 8; i++) {
                    if (crc & 0x8000) crc = (crc << 1) ^ 0x1021;
                    else crc = crc << 1;
                }
            }
            return (crc & 0xFFFF).toString(16).toUpperCase().padStart(4, "0");
        }

        function getDetailsModalHTML(details) {
            const { pkg, totalPrice, paymentId, nama, whatsapp, price } = details;
            const uniqueCodeAmount = totalPrice - price;
            return `
                <div class="details-modal-header p-4 flex items-center justify-between">
                    <h3 class="text-lg font-bold">Ringkasan Transaksi</h3>
                    <button onclick="closeModal('detailsModal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times text-xl"></i></button>
                </div>
                <div class="details-modal-body p-4 pt-2">
                    <p class="text-xs text-gray-500 mb-3">Nomor Invoice: <strong>${paymentId}</strong></p>
                    <div class="text-center mb-3">
                        <p class="text-sm text-gray-600 mb-1">Total Pembayaran</p>
                        <div class="flex items-center justify-center">
                            <p class="text-3xl font-bold text-gray-900">Rp ${totalPrice.toLocaleString('id-ID')}</p>
                        </div>
                    </div>
                    <div class="space-y-2 border-t border-b border-gray-200 py-3 my-3">
                        <div>
                            <div class="flex justify-between text-sm">
                                <span>${pkg}</span>
                                <span class="font-semibold text-gray-800">Rp ${price.toLocaleString('id-ID')}</span>
                            </div>
                        </div>
                         <div class="flex justify-between text-xs">
                            <span class="text-gray-500">Kode Unik</span>
                            <span class="font-medium">Rp ${uniqueCodeAmount.toLocaleString('id-ID')}</span>
                        </div>
                    </div>
                    <div class="pt-2">
                        <h4 class="font-semibold mb-2 text-sm">Informasi Pelanggan</h4>
                        <div class="space-y-2 text-sm">
                            <div>
                                <p class="text-gray-500 text-xs mb-0.5">Nama</p>
                                <p class="font-medium">${nama}</p>
                            </div>
                            <div>
                                <p class="text-gray-500 text-xs mb-0.5">Nomor WhatsApp</p>
                                <p class="font-medium">${whatsapp}</p>
                            </div>
                             <div>
                                <p class="text-gray-500 text-xs mb-0.5">Email Apple ID</p>
                                <p class="font-medium">${details.email}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function showDetailsModal(event) {
            if(event) event.preventDefault();
            const modalContent = document.getElementById('detailsModalContent');
            const modal = document.getElementById('detailsModal');
            
            modalContent.innerHTML = getDetailsModalHTML(currentOrderDetails);
            modal.classList.add('active');
        }

    </script>
</body>
</html>
