<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jasa Unblock IMEI Resmi - Sinyal Kembali Normal</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/1001/1001322.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.1/qrcode.min.js"></script>
    <style>
        :root {
            --primary: #2563EB;
            --primary-dark: #1D4ED8;
            --primary-light: #EFF6FF;
            --surface: #ffffff;
            --bg-main: #F3F4F6;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-main);
            color: #1F2937;
            -webkit-font-smoothing: antialiased;
        }

        .font-mono-code { font-family: 'JetBrains Mono', monospace; }

        /* Modern Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94A3B8; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }

        @keyframes pulse-subtle { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        .animate-pulse-subtle { animation: pulse-subtle 2s infinite; }

        /* Custom UI Elements */
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05);
        }

        .input-modern {
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .input-modern:focus {
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
        }

        /* Toggle Switch */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #2563EB;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #2563EB;
        }

        /* Radio Card Selection */
        .radio-card-input:checked + .radio-card-label {
            border-color: #2563EB;
            background-color: #EFF6FF;
            box-shadow: 0 0 0 1px #2563EB;
        }
        .radio-card-input:checked + .radio-card-label .radio-indicator {
            border-color: #2563EB;
            background-color: #2563EB;
        }
        .radio-card-input:checked + .radio-card-label .radio-indicator::after {
            transform: scale(1);
        }

        /* Terminal Style */
        .terminal-window {
            background: #111827;
            box-shadow: 0 20px 50px -10px rgba(0, 0, 0, 0.3);
        }
        .terminal-log::-webkit-scrollbar { width: 6px; }
        .terminal-log::-webkit-scrollbar-thumb { background: #374151; }

        /* Log Entry Styles */
        .log-entry { margin-bottom: 6px; font-size: 13px; line-height: 1.5; display: flex; opacity: 0; animation: fadeIn 0.2s forwards; }
        .log-prefix { color: #6B7280; margin-right: 10px; flex-shrink: 0; user-select: none; }
        .log-msg { word-break: break-all; }
        .log-info { color: #E5E7EB; }
        .log-success { color: #4ADE80; }
        .log-warning { color: #FBBF24; }
        .log-error { color: #F87171; }
        
        /* Modal */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .image-modal-content img {
             max-height: 70vh;
             width: auto;
             object-fit: contain;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 sm:p-6 lg:p-8">

    <!-- Header / Brand (Minimalist) -->
    <header class="absolute top-0 left-0 w-full p-6 flex justify-between items-center z-10">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold text-lg">
                <i class="fas fa-signal"></i>
            </div>
            <span class="font-bold text-gray-800 text-lg tracking-tight">IMEI<span class="text-blue-600">Unlocker</span></span>
        </div>
        <div class="text-xs font-medium bg-green-100 text-green-700 px-3 py-1 rounded-full flex items-center gap-1">
            <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
            Server Online
        </div>
    </header>

    <main class="w-full max-w-xl mx-auto relative z-20 mt-12 sm:mt-0">
        
        <!-- ==================== INITIAL SCREEN ==================== -->
        <div id="initial-screen" class="animate-fade-in">
            <div class="text-center mb-8">
                <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-900 mb-3 tracking-tight">
                    Sinyal HP Hilang?
                </h1>
                <p class="text-gray-500 text-lg leading-relaxed max-w-md mx-auto">
                    Layanan unblock IMEI resmi & permanen. Aman, cepat, dan bergaransi uang kembali.
                </p>
            </div>

            <div class="glass-panel bg-white rounded-2xl p-6 sm:p-8 shadow-xl border border-gray-100">
                
                <!-- IMEI 1 -->
                <div class="mb-5">
                    <label class="block text-sm font-semibold text-gray-700 mb-2 ml-1">Nomor IMEI</label>
                    <div class="relative">
                        <input type="number" id="imei-input" 
                            class="input-modern w-full px-5 py-4 bg-gray-50 border border-gray-200 rounded-xl text-lg font-mono-code focus:outline-none focus:bg-white focus:border-blue-500 transition-colors"
                            placeholder="15 Digit Angka" autocomplete="off">
                        <div class="absolute inset-y-0 right-4 flex items-center pointer-events-none text-gray-400">
                            <i class="fas fa-barcode"></i>
                        </div>
                    </div>
                </div>

                <!-- Dual SIM Toggle -->
                <div class="mb-5 flex items-center justify-between bg-blue-50 p-4 rounded-xl border border-blue-100 cursor-pointer" id="dual-sim-toggle">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600">
                            <i class="fas fa-sim-card"></i>
                        </div>
                        <div class="text-left">
                            <span class="block text-sm font-bold text-gray-800">Dual SIM?</span>
                            <span class="block text-xs text-gray-500">Aktifkan untuk 2 IMEI</span>
                        </div>
                    </div>
                    <div class="relative inline-block w-12 mr-2 align-middle select-none transition duration-200 ease-in">
                        <input type="checkbox" name="toggle" id="toggle-switch-checkbox" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer border-gray-300 transition-all duration-300 left-0 top-0"/>
                        <label for="toggle-switch-checkbox" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer transition-colors duration-300"></label>
                    </div>
                </div>

                <!-- IMEI 2 (Hidden) -->
                <div id="imei2-container" class="mb-5 hidden">
                    <label class="block text-sm font-semibold text-gray-700 mb-2 ml-1">Nomor IMEI 2 (SIM 2)</label>
                    <div class="relative">
                        <input type="number" id="imei2-input" 
                            class="input-modern w-full px-5 py-4 bg-gray-50 border border-gray-200 rounded-xl text-lg font-mono-code focus:outline-none focus:bg-white focus:border-blue-500 transition-colors"
                            placeholder="15 Digit Angka" autocomplete="off">
                         <div class="absolute inset-y-0 right-4 flex items-center pointer-events-none text-gray-400">
                            <i class="fas fa-barcode"></i>
                        </div>
                    </div>
                    <p class="text-xs text-blue-600 mt-2 ml-1 font-medium"><i class="fas fa-check-circle mr-1"></i> Harga tetap sama untuk 2 IMEI!</p>
                </div>

                <!-- Actions -->
                <button id="start-unblock-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-500/30 transition-all transform active:scale-[0.98] flex items-center justify-center gap-2 text-lg">
                    <i class="fas fa-unlock-alt"></i> Buka Blokir Sekarang
                </button>

                <div class="mt-6 flex justify-center">
                     <button id="example-imei-btn" class="text-sm text-gray-500 hover:text-blue-600 transition-colors flex items-center gap-1">
                        <i class="far fa-question-circle"></i> Cara Cek IMEI
                    </button>
                </div>
            </div>
            
            <div class="mt-8 flex justify-center gap-6 text-gray-400 grayscale opacity-70">
                <i class="fab fa-android text-2xl"></i>
                <i class="fab fa-apple text-2xl"></i>
                <i class="fas fa-shield-alt text-2xl"></i>
            </div>
        </div>

        <!-- ==================== PROCESSING SCREEN ==================== -->
        <div id="processing-screen" class="hidden animate-fade-in w-full max-w-2xl mx-auto">
            <div class="text-center mb-6">
                 <div class="inline-block p-3 bg-blue-100 rounded-full text-blue-600 mb-3 animate-pulse">
                    <i class="fas fa-cog fa-spin text-2xl"></i>
                </div>
                <h2 class="text-xl font-bold text-gray-900">Mendaftarkan Perangkat...</h2>
                <p class="text-sm text-gray-500 mt-1">Mohon jangan tutup halaman ini</p>
            </div>

            <div class="terminal-window rounded-xl overflow-hidden border border-gray-800 font-mono-code text-sm">
                <!-- Mac Traffic Lights -->
                <div class="bg-gray-900 px-4 py-3 flex items-center gap-2 border-b border-gray-800">
                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                    <div class="w-3 h-3 rounded-full bg-green-500"></div>
                    <div class="ml-auto text-xs text-gray-600">reg_client_v3.0</div>
                </div>
                
                <!-- Logs -->
                <div id="log-container" class="terminal-log p-4 h-80 overflow-y-auto text-gray-300">
                    <!-- Logs will be injected here -->
                </div>

                <!-- Footer Status -->
                <div class="bg-gray-900 px-4 py-3 border-t border-gray-800">
                    <div class="flex justify-between text-xs text-gray-500 mb-2">
                        <span id="status-text">Initializing...</span>
                        <span id="progress-text">0%</span>
                    </div>
                    <div class="w-full bg-gray-800 rounded-full h-1.5 overflow-hidden">
                        <div id="progress-bar" class="bg-gradient-to-r from-blue-500 to-green-400 h-full w-0 transition-all duration-300 ease-out"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== PAYMENT FORM SCREEN ==================== -->
        <div id="payment-screen" class="hidden animate-fade-in w-full">
            <!-- Success Header -->
            <div class="bg-green-50 border border-green-100 rounded-2xl p-6 text-center mb-8 relative overflow-hidden">
                <div class="absolute -top-10 -right-10 w-32 h-32 bg-green-100 rounded-full blur-3xl opacity-50"></div>
                <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-3 shadow-sm text-green-500 text-3xl">
                    <i class="fas fa-check"></i>
                </div>
                <h2 class="text-xl font-bold text-gray-900">IMEI Terverifikasi!</h2>
                <p class="text-sm text-gray-600 mt-1">Perangkat siap untuk di-unblock.</p>
            </div>

            <form id="orderForm" class="space-y-8">
                
                <!-- Package Selection -->
                <section>
                    <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <span class="w-7 h-7 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold">1</span>
                        Pilih Durasi Garansi
                    </h3>
                    <div id="package-selection" class="grid gap-3"></div>
                </section>

                <!-- User Details -->
                <section>
                    <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <span class="w-7 h-7 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold">2</span>
                        Data Diri
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1 ml-1">Nama Lengkap</label>
                            <input type="text" id="nama" name="nama" class="input-modern w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:border-blue-500 bg-white" placeholder="Sesuai KTP/Identitas">
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1 ml-1">Nomor WhatsApp</label>
                                <input type="tel" id="whatsapp" name="whatsapp" class="input-modern w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:border-blue-500 bg-white" placeholder="08xxxxxxxxxx">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1 ml-1">Email Aktif</label>
                                <input type="email" id="email" name="email" class="input-modern w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:border-blue-500 bg-white" placeholder="contoh@gmail.com">
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Payment Method -->
                <section>
                    <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <span class="w-7 h-7 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold">3</span>
                        Metode Pembayaran
                    </h3>
                    <div id="payment-method-selection" class="grid grid-cols-2 gap-3"></div>
                </section>

                <!-- Summary & Submit -->
                <div class="bg-gray-50 rounded-2xl p-6 border border-gray-200">
                    <div id="order-details-in-form"></div>
                    <button type="button" id="submit-btn" class="w-full bg-gray-900 hover:bg-black text-white font-bold py-4 rounded-xl shadow-lg transition-all transform active:scale-[0.98] mt-6 flex items-center justify-center gap-2">
                        <span>Lanjut Pembayaran</span> <i class="fas fa-arrow-right"></i>
                    </button>
                    <p class="text-center text-xs text-gray-500 mt-4 flex items-center justify-center gap-1">
                        <i class="fas fa-lock text-green-500"></i> Transaksi Anda dienkripsi dan aman.
                    </p>
                </div>
            </form>

            <!-- FAQ Section -->
            <div class="mt-12 pt-8 border-t border-gray-200">
                <h3 class="text-center font-bold text-gray-400 uppercase tracking-widest text-xs mb-6">Pertanyaan Umum</h3>
                <div id="info-section-full" class="space-y-2"></div>
            </div>
        </div>

        <!-- ==================== PAYMENT INSTRUCTION SCREEN ==================== -->
        <div id="payment-instruction-container" class="hidden animate-fade-in w-full max-w-lg mx-auto"></div>

        <!-- ==================== STATUS CHECK SCREEN ==================== -->
        <div id="status-check-screen" class="hidden animate-fade-in w-full max-w-2xl mx-auto"></div>

    </main>

    <footer id="footer" class="w-full text-center py-8 mt-auto relative z-10 text-gray-400 text-sm">
        <p>&copy; <span id="currentYear"></span> Official IMEI Unblock Service.</p>
    </footer>

    <!-- ==================== MODALS ==================== -->
    
    <!-- Image Modal -->
    <div id="imageModal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop p-4">
        <div class="relative bg-transparent max-w-lg w-full animate-fade-in image-modal-content flex flex-col items-center">
            <button class="absolute -top-12 right-0 text-white hover:text-gray-300 text-3xl transition-colors" onclick="closeImageModal()">
                <i class="fas fa-times"></i>
            </button>
            <img src="https://pixvid.org/images/2025/11/10/k2uTX.jpg" alt="Cara Cek IMEI" class="rounded-2xl shadow-2xl ring-1 ring-white/20">
            <div class="mt-4 bg-black/80 text-white px-6 py-3 rounded-full backdrop-blur-md">
                Tekan <span class="font-bold font-mono text-yellow-400">*#06#</span> di menu telepon
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div id="infoModal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop p-4">
        <div class="bg-white rounded-2xl max-w-sm w-full p-6 shadow-2xl transform transition-all scale-100 animate-fade-in text-center">
            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-600 text-xl">
                <i class="fas fa-info"></i>
            </div>
            <h3 id="modalTitle" class="text-lg font-bold text-gray-900 mb-2">Informasi</h3>
            <p id="modalMessage" class="text-gray-600 mb-6 text-sm leading-relaxed">Pesan disini.</p>
            <button class="w-full bg-gray-900 text-white font-semibold py-3 rounded-xl hover:bg-black transition-colors" onclick="closeInfoModal()">
                OK, Mengerti
            </button>
        </div>
    </div>

    <script>
    /* ==========================================================================
       LOGIC & VALIDATION (PRESERVED)
       ========================================================================== */
    const operatorPrefixes = {
        'Telkomsel': ['0811', '0812', '0813', '0821', '0822', '0823', '0851', '0852', '0853'],
        'by.U': ['0851'],
        'Indosat Ooredoo': ['0814', '0815', '0816', '0855', '0856', '0857', '0858'],
        'Tri (3)': ['0895', '0896', '0897', '0898', '0899'],
        'XL Axiata': ['0817', '0818', '0819', '0859', '0877', '0878', '0879'],
        'Live.On': ['0859'],
        'Axis': ['0831', '0832', '0833', '0838'],
        'Smartfren': ['0881', '0882', '0883', '0884', '0885', '0886', '0887', '0888', '0889']
    };
    const blacklistedNumbers = ['081234567890'];

    function isInvalidPattern(nomor) {
        if (blacklistedNumbers.includes(nomor)) return true;
        const numberPart = nomor.substring(2);
        if (/(\d)\1{4,}/.test(numberPart)) return true; // Repeats 5+ times
        for (let i = 0; i < numberPart.length - 4; i++) {
            const sub = numberPart.substring(i, i + 5);
            const isAscending = '0123456789'.includes(sub);
            const isDescending = '9876543210'.includes(sub);
            if (isAscending || isDescending) return true;
        }
        const uniqueDigits = new Set(numberPart.split(''));
        if (uniqueDigits.size < 4) return true;
        if (/(..)\1\1/.test(numberPart)) return true;
        return false;
    }

    function getOperatorFromNumber(nomor) {
        const prefix = nomor.substring(0, 4);
        for (const operator in operatorPrefixes) {
            if (operatorPrefixes[operator].includes(prefix)) return operator;
        }
        return null;
    }

    function validatePhoneNumber(nomorHp) {
        const genericError = { isValid: false, message: 'Nomor WhatsApp tidak valid.' };
        if (nomorHp.length < 10) return genericError;
        const operator = getOperatorFromNumber(nomorHp);
        if (!operator) return genericError;
        const maxLength = operator === 'Tri (3)' ? 13 : 12;
        if (nomorHp.length > maxLength) return genericError;
        if (isInvalidPattern(nomorHp)) return genericError;
        return { isValid: true, message: 'Valid' };
    }

    function validateEmail(email) {
        return /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(email).toLowerCase());
    }

    // --- DOM READY ---
    document.addEventListener('DOMContentLoaded', function() {
        const elements = {
            initialScreen: document.getElementById('initial-screen'),
            processingScreen: document.getElementById('processing-screen'),
            paymentScreen: document.getElementById('payment-screen'),
            paymentInstructionContainer: document.getElementById('payment-instruction-container'),
            statusCheckScreen: document.getElementById('status-check-screen'),
            footer: document.getElementById('footer'),
            currentYear: document.getElementById('currentYear'),
            packageSelection: document.getElementById('package-selection'),
            paymentMethodSelection: document.getElementById('payment-method-selection'),
            orderDetailsInForm: document.getElementById('order-details-in-form'),
            infoSectionFull: document.getElementById('info-section-full'),
            orderForm: document.getElementById('orderForm'),
            submitBtn: document.getElementById('submit-btn'),
            startUnblockBtn: document.getElementById('start-unblock-btn'),
            imeiInput: document.getElementById('imei-input'),
            imei2Input: document.getElementById('imei2-input'),
            imei2Container: document.getElementById('imei2-container'),
            dualSimToggle: document.getElementById('dual-sim-toggle'),
            toggleSwitchCheckbox: document.getElementById('toggle-switch-checkbox'),
            logContainer: document.getElementById('log-container'),
            progressBar: document.getElementById('progress-bar'),
            statusText: document.getElementById('status-text'),
            progressText: document.getElementById('progress-text') // Added ID
        };

        const uniqueCode = Math.floor(Math.random() * (500 - 100 + 1)) + 100;
        let expiryTime;
        let enteredImei = '';
        let enteredImei2 = '';
        let isDualSim = false;

        // --- IMEI PATTERN CHECK ---
        function isValidImeiPattern(imei) {
             const isSequential = (str) => {
                for (let i = 0; i < str.length - 2; i++) {
                    const current = parseInt(str[i]), next = parseInt(str[i + 1]), afterNext = parseInt(str[i + 2]);
                    if (next === current + 1 && afterNext === next + 1) {
                         let seqLen = 3; for(let j=i+3; j<str.length; j++) if(parseInt(str[j]) === parseInt(str[j-1])+1) seqLen++; else break;
                         if (seqLen >= 5) return true;
                    }
                    if (next === current - 1 && afterNext === next - 1) {
                         let seqLen = 3; for(let j=i+3; j<str.length; j++) if(parseInt(str[j]) === parseInt(str[j-1])-1) seqLen++; else break;
                         if (seqLen >= 5) return true;
                    }
                }
                return false;
            };
            const hasRepeatedPattern = (str) => {
                for (let d = 0; d <= 9; d++) if (str.includes(String(d).repeat(8))) return true;
                for (let i = 0; i < str.length - 5; i++) {
                    const pat = str.substring(i, i + 2);
                    let count = 1;
                    for (let j = i + 2; j < str.length - 1; j += 2) { if (str.substring(j, j + 2) === pat) { count++; if(count >= 3) return true; } else break; }
                }
                return false;
            };
            const obviousFakePatterns = ['123456789012345','098765432109876','111111111111111','000000000000000','123450987654321','987654321098765','555555555555555','999999999999999'];
            if (obviousFakePatterns.includes(imei)) return false;
            if (imei.split('').every(c => c === imei[0])) return false;
            if (isSequential(imei)) return false;
            if (hasRepeatedPattern(imei)) return false;
            if (imei === imei.split('').reverse().join('')) return false;
            return true;
        }

        // --- DATA ---
        const packages = {
            '3months': { id: '3months', name: "Unblock IMEI 3 Bulan", price: 70000, normalPrice: 200000, title: "Paket 3 Bulan", description: "Garansi sinyal 3 bulan." },
            '1year': { id: '1year', name: "Unblock IMEI 1 Tahun", price: 150000, normalPrice: 400000, title: "Paket 1 Tahun (Best Seller)", description: "Garansi sinyal 1 tahun penuh." },
            'permanent': { id: 'permanent', name: "Unblock IMEI Permanen", price: 250000, normalPrice: 700000, title: "Paket Permanen", description: "Sekali bayar untuk selamanya." }
        };
        let currentPackageId = '1year';

        const paymentAccounts = {
            qris: { displayName: 'QRIS', accountHolder: 'Epay', number: '00020101021126610016ID.CO.SHOPEE.WWW01189360091800223157700208223157700303UMI51440014ID.CO.QRIS.WWW0215ID10254270621910303UMI5204481453033605802ID5904Epay6013JAKARTA PUSAT61051061062070703A0163042F15', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Logo_QRIS.svg/163px-Logo_QRIS.svg.png', type: 'qris' },
            bca_va: { displayName: 'BCA VA', accountHolder: 'Epayment', number: '39358089510639366', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Bank_Central_Asia.svg/330px-Bank_Central_Asia.svg.png', type: 'va' },
            gopay: { displayName: 'Gopay', accountHolder: 'Gopay 6289510639366', number: '089510639366', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/86/Gopay_logo.svg/320px-Gopay_logo.svg.png', type: 'ewallet' },
            dana: { displayName: 'DANA', accountHolder: 'DNID089510639366', number: '089510639366', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Logo_dana_blue.svg/330px-Logo_dana_blue.svg.png', type: 'ewallet' },
        };

        // --- EVENTS ---
        elements.dualSimToggle.addEventListener('click', function(e) {
            // Prevent triggering twice if clicking the checkbox directly
            if (e.target !== elements.toggleSwitchCheckbox) {
                elements.toggleSwitchCheckbox.checked = !elements.toggleSwitchCheckbox.checked;
            }
            isDualSim = elements.toggleSwitchCheckbox.checked;
            if (isDualSim) {
                elements.imei2Container.classList.remove('hidden');
                elements.imei2Container.classList.add('animate-fade-in');
                elements.imeiInput.placeholder = "15 Digit (SIM 1)";
            } else {
                elements.imei2Container.classList.add('hidden');
                elements.imeiInput.placeholder = "15 Digit Angka";
                elements.imei2Input.value = '';
            }
        });

        // --- RENDERERS (NEW DESIGN) ---
        const getPackageSelectionHTML = () => {
            let html = '';
            Object.entries(packages).forEach(([key, pkg]) => {
                const isSelected = key === currentPackageId;
                html += `
                    <label class="cursor-pointer relative">
                        <input type="radio" name="package" value="${key}" class="radio-card-input sr-only" ${isSelected ? 'checked' : ''}>
                        <div class="radio-card-label border-2 border-gray-100 rounded-xl p-4 transition-all hover:bg-gray-50 flex items-center gap-4 bg-white">
                            <div class="radio-indicator w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center transition-all flex-shrink-0 relative">
                                <span class="block w-2.5 h-2.5 rounded-full bg-white transform scale-0 transition-transform absolute"></span>
                            </div>
                            <div class="flex-grow">
                                <h4 class="font-bold text-gray-900 text-sm sm:text-base">${pkg.title}</h4>
                                <p class="text-xs text-gray-500">${pkg.description}</p>
                            </div>
                            <div class="text-right">
                                <span class="block font-bold text-blue-600">${formatCurrency(pkg.price)}</span>
                                <span class="block text-xs text-gray-400 line-through">${formatCurrency(pkg.normalPrice)}</span>
                            </div>
                        </div>
                    </label>`;
            });
            return html;
        };
        
        const getPaymentMethodsHTML = (accounts) => {
            let html = '';
            Object.entries(accounts).forEach(([key, account], index) => {
                html += `
                    <label class="cursor-pointer">
                        <input type="radio" name="payment-method" value="${key}" class="radio-card-input sr-only" ${index === 0 ? 'checked' : ''}>
                        <div class="radio-card-label border border-gray-200 rounded-xl p-3 flex flex-col items-center justify-center gap-2 h-24 hover:bg-gray-50 transition-all bg-white text-center">
                            <img src="${account.logo}" class="h-6 object-contain grayscale opacity-80 transition-all">
                            <span class="text-xs font-semibold text-gray-600">${account.displayName}</span>
                        </div>
                    </label>`;
            });
            return html;
        };

        const getOrderDetailsHTML = (pkg, totalPrice) => {
            const imeiInfo = isDualSim ? `<div class="flex justify-between text-xs text-blue-600 mb-2 font-medium"><span>Dual SIM Activated</span><span>2 IMEI</span></div>` : '';
            return `
                <div class="space-y-3 text-sm border-b border-gray-200 pb-4 mb-4">
                    ${imeiInfo}
                    <div class="flex justify-between text-gray-600">
                        <span>Paket Dipilih</span>
                        <span class="font-medium text-gray-900 text-right">${pkg.name}</span>
                    </div>
                    <div class="flex justify-between text-gray-600">
                        <span>Harga Paket</span>
                        <span class="font-medium text-gray-900">${formatCurrency(pkg.price)}</span>
                    </div>
                    <div class="flex justify-between text-gray-600">
                        <span>Kode Unik</span>
                        <span class="font-medium text-gray-900">${formatCurrency(uniqueCode)}</span>
                    </div>
                </div>
                <div class="flex justify-between items-center">
                    <span class="font-bold text-gray-800 text-lg">Total Bayar</span>
                    <span class="font-bold text-blue-600 text-2xl tracking-tight">${formatCurrency(totalPrice)}</span>
                </div>`;
        };

        const getInfoSectionHTML = () => {
             return `
                <details class="group bg-white rounded-xl border border-gray-100 mb-2 overflow-hidden">
                    <summary class="flex justify-between items-center font-medium cursor-pointer list-none p-4 text-sm text-gray-700 hover:bg-gray-50">
                        <span>Apakah ini aman & legal?</span>
                        <span class="transition group-open:rotate-180"><i class="fas fa-chevron-down"></i></span>
                    </summary>
                    <div class="text-gray-600 text-sm p-4 pt-0 leading-relaxed border-t border-gray-50">
                        100% aman dan legal. Data IMEI Anda didaftarkan langsung ke database whitelist pemerintah (Kemenperin/Bea Cukai) sehingga sinyal aktif permanen dan bebas blokir.
                    </div>
                </details>
                <details class="group bg-white rounded-xl border border-gray-100 mb-2 overflow-hidden">
                    <summary class="flex justify-between items-center font-medium cursor-pointer list-none p-4 text-sm text-gray-700 hover:bg-gray-50">
                        <span>Berapa lama prosesnya?</span>
                        <span class="transition group-open:rotate-180"><i class="fas fa-chevron-down"></i></span>
                    </summary>
                    <div class="text-gray-600 text-sm p-4 pt-0 leading-relaxed border-t border-gray-50">
                        Estimasi proses 15-30 menit setelah pembayaran terverifikasi. Anda bisa cek status secara real-time di halaman ini.
                    </div>
                </details>
                <details class="group bg-white rounded-xl border border-gray-100 mb-2 overflow-hidden">
                    <summary class="flex justify-between items-center font-medium cursor-pointer list-none p-4 text-sm text-gray-700 hover:bg-gray-50">
                        <span>Garansi uang kembali?</span>
                        <span class="transition group-open:rotate-180"><i class="fas fa-chevron-down"></i></span>
                    </summary>
                    <div class="text-gray-600 text-sm p-4 pt-0 leading-relaxed border-t border-gray-50">
                        Ya, kami memberikan garansi 100% uang kembali jika dalam 1x24 jam sinyal tidak muncul setelah status "Sukses".
                    </div>
                </details>
             `;
        };

        function formatCurrency(value) { return `Rp${value.toLocaleString('id-ID')}`; }

        function updateDisplay() {
            const pkg = packages[currentPackageId];
            const totalPrice = pkg.price + uniqueCode;
            elements.orderDetailsInForm.innerHTML = getOrderDetailsHTML(pkg, totalPrice);
        }

        function getCurrentTimestamp() {
            const now = new Date();
            return `[${now.toLocaleTimeString('en-GB', { hour12: false })}.${now.getMilliseconds().toString().padStart(3, '0')}]`;
        }

        // --- PROCESSING LOGIC ---
        function startProcessingAnimation() {
            elements.initialScreen.classList.add('hidden');
            elements.processingScreen.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            elements.logContainer.innerHTML = '';
            elements.progressBar.style.width = '0%';
            elements.statusText.textContent = 'Initializing...';

            const isImei1Valid = isValidImeiPattern(enteredImei);
            const isImei2Valid = isDualSim ? isValidImeiPattern(enteredImei2) : true;
            
            // Random Data for Logs
            const sessionId = Math.random().toString(36).substring(2, 10).toUpperCase();
            const serverIp = `103.28.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`;

            const baseSteps = [
                { text: `<span class="log-info">Connecting to upstream server ${serverIp}:443...</span>`, delay: 300, progress: 5 },
                { text: `<span class="log-success">Connection established (TLSv1.3 AES_256_GCM).</span>`, delay: 400, progress: 10 },
                { text: `<span class="log-info">Handshaking with Kemenperin gateway...</span>`, delay: 500, progress: 15, status: 'Handshake...' },
                { text: `<span class="log-success">Authorized. Session ID: ${sessionId}</span>`, delay: 400, progress: 20 },
                { text: `<span class="log-info">Preparing database query...</span>`, delay: 600, progress: 25 },
            ];
            
            const imei1Steps = [
                 { text: `<span class="log-warning">Verifying IMEI 1: ${enteredImei}...</span>`, delay: 500, progress: 30, status: 'Verifying IMEI 1' },
            ];

            if (!isImei1Valid) {
                 const errorSteps = [
                     { text: `<span class="log-error">CRITICAL: Luhn check failed for IMEI 1.</span>`, delay: 600, progress: 35 },
                     { text: `<span class="log-error">Pattern analysis: INVALID/FAKE IMEI DETECTED.</span>`, delay: 800, progress: 40 },
                     { text: `<span class="log-error">Terminating session...</span>`, delay: 500, progress: 45, type: 'error' }
                 ];
                 processStepsWithError([...baseSteps, ...imei1Steps, ...errorSteps], 'IMEI Tidak Valid', 'Nomor IMEI yang Anda masukkan terdeteksi tidak valid. Pastikan input 15 digit angka yang benar dari *#06#.');
                 return;
            }

            const imei1ValidSteps = [
                { text: `<span class="log-success">IMEI 1 valid. Brand/Model lookup successful.</span>`, delay: 600, progress: 40 },
                { text: `<span class="log-info">Checking whitelist status...</span>`, delay: 700, progress: 45 },
                { text: `<span class="log-warning">Status: BLOCKED (Not Registered).</span>`, delay: 500, progress: 50 },
            ];

            const imei2Steps = isDualSim ? [
                { text: `<span class="log-warning">Verifying IMEI 2: ${enteredImei2}...</span>`, delay: 500, progress: 55, status: 'Verifying IMEI 2' }
            ] : [];

            if (isDualSim && !isImei2Valid) {
                 const errorSteps2 = [
                     { text: `<span class="log-error">CRITICAL: Luhn check failed for IMEI 2.</span>`, delay: 600, progress: 60 },
                     { text: `<span class="log-error">Terminating session...</span>`, delay: 500, progress: 65 }
                 ];
                 processStepsWithError([...baseSteps, ...imei1Steps, ...imei1ValidSteps, ...imei2Steps, ...errorSteps2], 'IMEI 2 Tidak Valid', 'Nomor IMEI kedua tidak valid. Cek kembali input Anda.');
                 return;
            }

            const imei2ValidSteps = isDualSim ? [
                { text: `<span class="log-success">IMEI 2 valid.</span>`, delay: 600, progress: 65 },
                { text: `<span class="log-info">Linking IMEI 1 & IMEI 2 to single request...</span>`, delay: 500, progress: 70 }
            ] : [];

            const finalSteps = [
                { text: `<span class="log-info">Allocating registration slot in queue...</span>`, delay: 800, progress: 80, status: 'Allocating Slot' },
                { text: `<span class="log-success">Slot allocated. Ref: REG-${Date.now()}</span>`, delay: 600, progress: 85 },
                { text: `<span class="log-info">Generating invoice data...</span>`, delay: 500, progress: 90 },
                { text: `<span class="log-warning">Waiting for user payment...</span>`, delay: 400, progress: 95, status: 'Finalizing...' },
                { text: `<span class="log-success">Ready. Redirecting to payment gateway.</span>`, delay: 600, progress: 100 }
            ];

            const steps = [...baseSteps, ...imei1Steps, ...imei1ValidSteps, ...imei2Steps, ...imei2ValidSteps, ...finalSteps];
            runLogSequence(steps, () => {
                 setTimeout(() => {
                    elements.processingScreen.classList.add('hidden');
                    elements.paymentScreen.classList.remove('hidden');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 1000);
            });
        }

        function runLogSequence(steps, onComplete, isError = false) {
            let i = 0;
            function next() {
                if (i >= steps.length) {
                    if (onComplete) onComplete();
                    return;
                }
                const step = steps[i];
                setTimeout(() => {
                    const div = document.createElement('div');
                    div.className = 'log-entry';
                    div.innerHTML = `<span class="log-prefix">${getCurrentTimestamp()}</span><span class="log-msg">${step.text}</span>`;
                    elements.logContainer.appendChild(div);
                    elements.logContainer.scrollTop = elements.logContainer.scrollHeight;
                    
                    if (step.status) elements.statusText.textContent = step.status;
                    if (elements.progressText) elements.progressText.textContent = `${step.progress}%`; // Update text %
                    elements.progressBar.style.width = `${step.progress}%`;
                    
                    i++;
                    next();
                }, step.delay);
            }
            next();
        }

        function processStepsWithError(steps, title, msg) {
             runLogSequence(steps, () => {
                setTimeout(() => {
                    elements.processingScreen.classList.add('hidden');
                    elements.initialScreen.classList.remove('hidden');
                    showInfoModal(title, msg);
                }, 1500);
             }, true);
        }

        // --- FORM SUBMIT ---
        async function handleFormSubmit() {
            const formData = new FormData(elements.orderForm);
            const nama = formData.get('nama').trim();
            const whatsapp = formData.get('whatsapp').trim();
            const email = formData.get('email').trim();
            const paymentMethodKey = formData.get('payment-method');

            if (!nama || !whatsapp || !email) { showInfoModal('Data Belum Lengkap', 'Mohon lengkapi semua data.'); return; }
            if (!validateEmail(email)) { showInfoModal('Email Invalid', 'Gunakan email yang valid.'); return; }
            if (!validatePhoneNumber(whatsapp).isValid) { showInfoModal('WhatsApp Invalid', 'Nomor WA tidak valid.'); return; }

            elements.submitBtn.disabled = true;
            elements.submitBtn.innerHTML = '<i class="fas fa-circle-notch fa-spin mr-2"></i> Memproses...';

            const pkg = packages[currentPackageId];
            const totalPrice = pkg.price + uniqueCode;
            const paymentAccount = paymentAccounts[paymentMethodKey];
            const paymentId = `INV-${Math.floor(Date.now() / 1000)}`;

            const dataToSend = {
                sheetName: 'imei', nama, whatsapp, email, 
                paket: pkg.name, metodePembayaran: paymentAccount.displayName,
                totalTransfer: formatCurrency(totalPrice), idPembayaran: paymentId,
                nomorRekening: paymentAccount.number, imei1: enteredImei, imei2: enteredImei2 || '-', kodeUnik: uniqueCode
            };

            const appsScriptUrl = 'https://script.google.com/macros/s/AKfycbySaAB2WT0D59UlLyZcXliWvNURCnHcRrqz5P8C2LCQbVdk0hn3Qkl1glGiLJSql_Wh/exec';

            try {
                 await fetch(appsScriptUrl, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify(dataToSend) });
                 showPaymentInstructions(formData, pkg, totalPrice, paymentAccount, paymentId, paymentMethodKey);
            } catch (e) {
                 showInfoModal('Gagal Koneksi', 'Gagal mengirim data. Coba lagi.');
            } finally {
                elements.submitBtn.disabled = false;
                elements.submitBtn.innerHTML = 'Lanjut Pembayaran <i class="fas fa-arrow-right ml-2"></i>';
            }
        }

        function showPaymentInstructions(formData, pkg, totalPrice, paymentAccount, paymentId, paymentMethodKey) {
            elements.paymentScreen.classList.add('hidden');
            elements.paymentInstructionContainer.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });

            expiryTime = new Date(Date.now() + 24 * 3600 * 1000);
            
            let methodSpecificHTML = '';
            if (paymentMethodKey === 'qris') {
                methodSpecificHTML = `
                    <div class="bg-white p-4 rounded-xl border-2 border-dashed border-gray-300 flex flex-col items-center justify-center mb-4">
                        <div id="qrcode" class="mb-3"></div>
                        <p class="text-xs text-center text-gray-500">Scan QRIS ini dengan GoPay, OVO, Dana, ShopeePay, atau Mobile Banking.</p>
                         <button id="downloadQrisButton" class="text-blue-600 text-sm font-bold mt-2 hover:underline"><i class="fas fa-download"></i> Simpan QR</button>
                    </div>`;
            } else {
                methodSpecificHTML = `
                    <div class="bg-gray-50 p-4 rounded-xl border border-gray-200 mb-4">
                        <p class="text-xs text-gray-500 mb-1">Nomor Rekening / Virtual Account</p>
                        <div class="flex items-center justify-between">
                            <span class="text-xl font-mono font-bold text-gray-800 tracking-wider">${paymentAccount.number}</span>
                            <button onclick="copyToClipboard('${paymentAccount.number}', 'No. Rekening')" class="text-blue-600 hover:bg-blue-50 p-2 rounded-lg text-sm font-bold"><i class="far fa-copy"></i> Salin</button>
                        </div>
                    </div>`;
            }

            const html = `
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
                    <div class="bg-gray-900 text-white p-6 text-center">
                        <h2 class="text-lg font-bold mb-1">Menunggu Pembayaran</h2>
                        <div id="countdown-timer-display" class="font-mono text-xl opacity-90">--:--:--</div>
                    </div>
                    
                    <div class="p-6">
                        <div class="text-center mb-6">
                            <p class="text-sm text-gray-500 mb-1">Total yang harus dibayar</p>
                            <div class="flex items-center justify-center gap-2">
                                <span class="text-3xl font-bold text-blue-600 tracking-tight">${formatCurrency(totalPrice)}</span>
                                <button onclick="copyToClipboard('${totalPrice}', 'Nominal')" class="text-gray-400 hover:text-blue-600"><i class="far fa-copy"></i></button>
                            </div>
                            <p class="text-xs text-orange-500 mt-2 bg-orange-50 inline-block px-3 py-1 rounded-full border border-orange-100 font-medium">
                                <i class="fas fa-exclamation-circle mr-1"></i> Transfer TEPAT sampai 3 digit terakhir
                            </p>
                        </div>

                        <div class="mb-6">
                            <div class="flex items-center gap-3 mb-3">
                                <img src="${paymentAccount.logo}" class="h-8 object-contain">
                                <div>
                                    <p class="font-bold text-gray-900 text-sm">${paymentAccount.displayName}</p>
                                    <p class="text-xs text-gray-500">${paymentAccount.accountHolder}</p>
                                </div>
                            </div>
                            ${methodSpecificHTML}
                        </div>

                        <div class="text-center space-y-3">
                             <button id="check-status-btn" class="w-full border-2 border-blue-600 text-blue-600 font-bold py-3 rounded-xl hover:bg-blue-50 transition-colors">
                                <i class="fas fa-sync-alt mr-1"></i> Cek Status Pembayaran
                            </button>
                            <p class="text-xs text-gray-400">ID Transaksi: ${paymentId}</p>
                        </div>
                    </div>
                </div>
            `;
            
            elements.paymentInstructionContainer.innerHTML = html;
            startCountdown();

            document.getElementById('check-status-btn').addEventListener('click', () => showStatusCheckAnimation(paymentId));

            if (paymentMethodKey === 'qris') {
                setTimeout(() => {
                    const container = document.getElementById('qrcode');
                    if (container) {
                         const qrisStatic = paymentAccount.number;
                         try {
                            const qrisDynamic = createDynamicQrisString(qrisStatic, { nominal: totalPrice });
                            container.innerHTML = '';
                            QRCode.toCanvas(qrisDynamic, { width: 200, margin: 0 }, (err, canvas) => {
                                if(!err) {
                                     container.appendChild(canvas);
                                     canvas.classList.add('rounded-lg');
                                     document.getElementById('downloadQrisButton').onclick = () => {
                                         const link = document.createElement('a');
                                         link.download = 'QRIS-Pembayaran.png'; link.href = canvas.toDataURL(); link.click();
                                     };
                                }
                            });
                         } catch(e) { console.error(e); }
                    }
                }, 100);
            }
        }

        function showStatusCheckAnimation(paymentId) {
            elements.paymentInstructionContainer.classList.add('hidden');
            elements.statusCheckScreen.classList.remove('hidden');
            
            const html = `
                <div class="text-center mb-6">
                    <h2 class="text-xl font-bold">Memeriksa Pembayaran...</h2>
                </div>
                <div class="terminal-window rounded-xl overflow-hidden border border-gray-800 font-mono-code text-sm">
                     <div class="bg-gray-900 px-4 py-3 flex items-center gap-2 border-b border-gray-800">
                        <div class="w-3 h-3 rounded-full bg-red-500"></div><div class="w-3 h-3 rounded-full bg-yellow-500"></div><div class="w-3 h-3 rounded-full bg-green-500"></div>
                     </div>
                     <div id="status-log-container" class="terminal-log p-4 h-64 overflow-y-auto text-gray-300"></div>
                     <div class="bg-gray-900 px-4 py-3 border-t border-gray-800">
                         <div class="w-full bg-gray-800 rounded-full h-1 overflow-hidden"><div id="status-progress-bar" class="bg-blue-500 h-full w-0 transition-all"></div></div>
                     </div>
                </div>
                <button id="back-to-payment-btn" class="mt-6 w-full text-blue-600 font-bold hover:underline">Kembali</button>
            `;
            elements.statusCheckScreen.innerHTML = html;
            
            document.getElementById('back-to-payment-btn').onclick = () => {
                elements.statusCheckScreen.classList.add('hidden');
                elements.paymentInstructionContainer.classList.remove('hidden');
            };

            const logCont = document.getElementById('status-log-container');
            const progBar = document.getElementById('status-progress-bar');
            
            const steps = [
                { text: `<span class="log-info">Connecting to payment gateway API...</span>`, delay: 300, progress: 20 },
                { text: `<span class="log-info">Querying Transaction ID: ${paymentId}</span>`, delay: 500, progress: 40 },
                { text: `<span class="log-info">Waiting for bank confirmation...</span>`, delay: 800, progress: 60 },
                { text: `<span class="log-warning">Result: PAYMENT PENDING (No funds received yet)</span>`, delay: 600, progress: 80 },
                { text: `<span class="log-error">Verification failed. Please complete transfer.</span>`, delay: 500, progress: 100 }
            ];

            let i = 0;
            function next() {
                if (i >= steps.length) return;
                const s = steps[i];
                setTimeout(() => {
                    const d = document.createElement('div');
                    d.className = 'log-entry';
                    d.innerHTML = `<span class="log-prefix">${getCurrentTimestamp()}</span><span class="log-msg">${s.text}</span>`;
                    logCont.appendChild(d); logCont.scrollTop = logCont.scrollHeight;
                    progBar.style.width = `${s.progress}%`;
                    i++; next();
                }, s.delay);
            }
            next();
        }

        function startCountdown() {
            const el = document.getElementById('countdown-timer-display');
            if (!el || !expiryTime) return;
            const i = setInterval(() => {
                const diff = expiryTime - Date.now();
                if (diff < 0) { clearInterval(i); el.innerText = "EXPIRED"; return; }
                const h = Math.floor(diff / 3600000).toString().padStart(2,'0');
                const m = Math.floor((diff % 3600000) / 60000).toString().padStart(2,'0');
                const s = Math.floor((diff % 60000) / 1000).toString().padStart(2,'0');
                el.innerText = `${h}:${m}:${s}`;
            }, 1000);
        }

        // --- INIT ---
        elements.currentYear.innerText = new Date().getFullYear();
        document.getElementById('example-imei-btn').onclick = showImageModal;
        elements.startUnblockBtn.onclick = () => {
             const imei = elements.imeiInput.value.trim();
             if (imei.length !== 15) { showInfoModal('IMEI Invalid', 'Masukkan 15 digit angka.'); return; }
             enteredImei = imei;
             if (isDualSim) enteredImei2 = elements.imei2Input.value.trim();
             startProcessingAnimation();
        };
        elements.submitBtn.onclick = handleFormSubmit;
        elements.packageSelection.addEventListener('change', (e) => {
             if(e.target.name === 'package') { currentPackageId = e.target.value; updateDisplay(); }
        });
        
        // Initial Render
        elements.packageSelection.innerHTML = getPackageSelectionHTML();
        elements.paymentMethodSelection.innerHTML = getPaymentMethodsHTML(paymentAccounts);
        elements.infoSectionFull.innerHTML = getInfoSectionHTML();
        updateDisplay();
    });

    // --- UTILS ---
    function showInfoModal(t, m) {
        document.getElementById('modalTitle').innerText = t;
        document.getElementById('modalMessage').innerText = m;
        document.getElementById('infoModal').classList.remove('hidden');
    }
    function closeInfoModal() { document.getElementById('infoModal').classList.add('hidden'); }
    function showImageModal() { document.getElementById('imageModal').classList.remove('hidden'); }
    function closeImageModal() { document.getElementById('imageModal').classList.add('hidden'); }
    
    function copyToClipboard(txt, lbl) {
        navigator.clipboard.writeText(txt).then(() => showInfoModal('Berhasil Salin', `${lbl} berhasil disalin.`));
    }
    
    // QRIS Utils
    function toCRC16(input) {
        let crc = 0xFFFF;
        for (let i = 0; i < input.length; i++) {
            crc ^= input.charCodeAt(i) << 8;
            for (let j = 0; j < 8; j++) { crc = crc & 0x8000 ? (crc << 1) ^ 0x1021 : crc << 1; }
        }
        return (crc & 0xFFFF).toString(16).toUpperCase().padStart(4, '0');
    }
    function createDynamicQrisString(qris, { nominal }) {
        let q = qris.slice(0, -4).replace("010211", "010212");
        const s = String(Math.round(nominal));
        const len = s.length < 10 ? "0" + s.length : s.length.toString();
        q = q.replace("5802ID", `54${len}${s}5802ID`);
        return q + toCRC16(q);
    }
    </script>
</body>
</html>
