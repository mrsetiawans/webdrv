<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Kartu Ucapan AI (Desain Baru)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Poppins', sans-serif;
        }
        .preview-pane-bg {
            background-color: #1a202c;
            background-image: radial-gradient(#4a5568 1px, transparent 1px);
            background-size: 20px 20px;
        }
        #loading-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        /* Custom scrollbar for a better look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2d3748;
        }
        ::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }
        #apiKeyStatus {
            transition: all 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <div class="flex flex-col lg:flex-row h-screen">
        <!-- Control Panel -->
        <div class="w-full lg:w-1/3 xl:w-1/4 bg-gray-800 p-6 shadow-2xl overflow-y-auto border-r border-gray-700">
            <div class="flex items-center mb-8">
                <div class="p-2 bg-indigo-600 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/><path d="m15 5 3 3"/></svg>
                </div>
                <h1 class="text-2xl font-bold ml-4 text-white">Buat Ucapan Ajaib</h1>
            </div>

            <!-- Form -->
            <form id="generator-form" class="space-y-5">
                <!-- API Key Section -->
                <div class="p-4 bg-gray-900 rounded-lg border border-yellow-500/50">
                    <label for="apiKey" class="block text-sm font-medium text-yellow-300 mb-2">Kunci API Gemini Anda</label>
                    <div class="flex space-x-2">
                        <input type="password" id="apiKey" name="apiKey" class="flex-grow w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 text-white placeholder-gray-500" placeholder="Masukkan API Key Anda" required>
                        <button type="button" id="saveApiKeyButton" class="p-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700" title="Simpan & Validasi Kunci">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                        </button>
                         <button type="button" id="deleteApiKeyButton" class="p-2 bg-red-600 text-white rounded-md hover:bg-red-700" title="Hapus Kunci Tersimpan">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                        </button>
                    </div>
                    <div id="apiKeyStatus" class="text-xs mt-2 h-4"></div>
                    <p class="text-xs text-gray-400 mt-2">
                        Dapatkan kunci gratis Anda di 
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-yellow-400 hover:underline">Google AI Studio</a>.
                    </p>
                </div>

                <div>
                    <label for="recipientName" class="block text-sm font-medium text-gray-400 mb-1">Untuk Siapa?</label>
                    <input type="text" id="recipientName" name="recipientName" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white placeholder-gray-500" placeholder="Contoh: Sahabatku, Budi" required>
                </div>
                
                <div>
                    <label for="eventDate" class="block text-sm font-medium text-gray-400 mb-1">Tanggal Acara</label>
                    <input type="datetime-local" id="eventDate" name="eventDate" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white" required style="color-scheme: dark;">
                </div>

                <div>
                    <label for="greetingType" class="block text-sm font-medium text-gray-400 mb-1">Jenis Ucapan</label>
                     <select id="greetingType" name="greetingType" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white">
                        <option value="Selamat Ulang Tahun">Ulang Tahun</option>
                        <option value="Selamat Wisuda">Wisuda</option>
                        <option value="Selamat Menikah">Pernikahan</option>
                    </select>
                </div>
                
                <div>
                    <label for="senderName" class="block text-sm font-medium text-gray-400 mb-1">Dari Siapa?</label>
                    <input type="text" id="senderName" name="senderName" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white placeholder-gray-500" placeholder="Contoh: Keluargamu" required>
                </div>

                <div>
                    <label for="mainMessagePrompt" class="block text-sm font-medium text-gray-400 mb-1">Isi Pesan Utama</label>
                    <textarea id="mainMessagePrompt" name="mainMessagePrompt" rows="3" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white placeholder-gray-500" placeholder="Jelaskan inti pesan utama yang puitis..." required></textarea>
                </div>
                
                <div>
                    <label for="specialWishPrompt" class="block text-sm font-medium text-gray-400 mb-1">Isi Pesan Spesial (Opsional)</label>
                    <textarea id="specialWishPrompt" name="specialWishPrompt" rows="4" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white placeholder-gray-500" placeholder="Jelaskan doa atau harapan yang lebih mendalam..."></textarea>
                </div>

                <div>
                    <label for="themeSelector" class="block text-sm font-medium text-gray-400 mb-1">Pilih Tema</label>
                    <select id="themeSelector" name="themeSelector" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white">
                        <option value="galaxy">üåå Galaksi Kosmik</option>
                        <option value="forest">üå≥ Hutan Ajaib</option>
                        <option value="ocean">üåä Samudra Dalam</option>
                        <option value="ghibli_day">üèûÔ∏è Ghibli Siang</option>
                        <option value="ghibli_night">üåÉ Ghibli Malam</option>
                    </select>
                </div>

                <button type="submit" id="generateButton" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 flex items-center justify-center transition-all duration-300 ease-in-out transform hover:scale-105 shadow-lg shadow-indigo-600/50">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="m12 3-1.9 5.8-5.6.8 4 3.9-1 5.5L12 16l5.5 2.9-1-5.5 4-3.9-5.6-.8z"/></svg>
                    Buat Ucapannya!
                </button>
            </form>

            <!-- Output Actions -->
            <div id="output-actions" class="mt-8 pt-6 border-t border-gray-700 space-y-3 hidden">
                 <h2 class="text-lg font-semibold text-white">Aksi Lanjutan</h2>
                <button id="copyButton" class="w-full bg-gray-600 text-white font-bold py-2.5 px-4 rounded-lg hover:bg-gray-700 flex items-center justify-center transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                    Salin Kode HTML
                </button>
                <button id="downloadButton" class="w-full bg-green-600 text-white font-bold py-2.5 px-4 rounded-lg hover:bg-green-700 flex items-center justify-center transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                    Unduh File .html
                </button>
                 <div id="copy-success" class="text-center text-green-400 font-medium hidden">Berhasil disalin!</div>
            </div>
        </div>

        <!-- Preview Pane -->
        <div class="w-full lg:w-2/3 xl:w-3/4 h-full flex-grow relative preview-pane-bg">
            <div id="loading-overlay" class="absolute inset-0 bg-gray-900 bg-opacity-80 backdrop-blur-sm flex-col items-center justify-center z-20 hidden">
                <svg class="animate-spin h-10 w-10 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="text-white text-lg mt-4 font-semibold">Gemini sedang merangkai kata...</p>
            </div>
            <div id="error-message" class="absolute inset-0 bg-red-900 bg-opacity-80 backdrop-blur-sm flex-col items-center justify-center z-20 hidden p-8 text-center">
                <h3 class="text-2xl font-bold text-red-300">Oops! Terjadi Kesalahan</h3>
                <p id="error-text" class="text-red-400 mt-2">Gagal menghasilkan ucapan. Coba periksa kembali prompt Anda atau coba lagi nanti.</p>
                <button onclick="document.getElementById('error-message').style.display = 'none'" class="mt-4 bg-red-600 text-white font-bold py-2 px-4 rounded-md hover:bg-red-700">Tutup</button>
            </div>
            <iframe id="preview-frame" class="w-full h-full border-0" title="Preview Kartu Ucapan"></iframe>
        </div>
    </div>
    
    <script>
        const form = document.getElementById('generator-form');
        const previewFrame = document.getElementById('preview-frame');
        const generateButton = document.getElementById('generateButton');
        const loadingOverlay = document.getElementById('loading-overlay');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const outputActions = document.getElementById('output-actions');
        const copyButton = document.getElementById('copyButton');
        const downloadButton = document.getElementById('downloadButton');
        const copySuccessMessage = document.getElementById('copy-success');
        
        const apiKeyInput = document.getElementById('apiKey');
        const saveApiKeyButton = document.getElementById('saveApiKeyButton');
        const deleteApiKeyButton = document.getElementById('deleteApiKeyButton');
        const apiKeyStatus = document.getElementById('apiKeyStatus');

        let generatedHtmlContent = '';

        // --- API Key Management ---
        document.addEventListener('DOMContentLoaded', () => {
            const savedApiKey = localStorage.getItem('geminiApiKey');
            if (savedApiKey) {
                apiKeyInput.value = savedApiKey;
                apiKeyStatus.textContent = 'Kunci API telah dimuat dari penyimpanan.';
                apiKeyStatus.className = 'text-xs mt-2 h-4 text-gray-400';
            }
        });

        async function validateApiKey(key) {
            if (!key || key.trim() === '') return false;
            const validationUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${key}`;
            try {
                const response = await fetch(validationUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: "hello" }] }] })
                });
                return response.ok;
            } catch (error) {
                console.error("Validation error:", error);
                return false;
            }
        }

        saveApiKeyButton.addEventListener('click', async () => {
            const key = apiKeyInput.value;
            apiKeyStatus.textContent = 'Memvalidasi kunci...';
            apiKeyStatus.className = 'text-xs mt-2 h-4 text-yellow-400';

            const isValid = await validateApiKey(key);

            if (isValid) {
                localStorage.setItem('geminiApiKey', key);
                apiKeyStatus.textContent = 'Kunci API valid dan berhasil disimpan!';
                apiKeyStatus.className = 'text-xs mt-2 h-4 text-green-400';
            } else {
                localStorage.removeItem('geminiApiKey');
                apiKeyStatus.textContent = 'Kunci API tidak valid atau terjadi error.';
                apiKeyStatus.className = 'text-xs mt-2 h-4 text-red-400';
            }
        });

        deleteApiKeyButton.addEventListener('click', () => {
            localStorage.removeItem('geminiApiKey');
            apiKeyInput.value = '';
            apiKeyStatus.textContent = 'Kunci API telah dihapus.';
            apiKeyStatus.className = 'text-xs mt-2 h-4 text-gray-400';
        });

        // --- Main Form Submission Logic ---
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            const apiKey = data.apiKey;

            if (!apiKey || apiKey.trim() === '') {
                errorText.textContent = "Harap masukkan Kunci API Gemini Anda untuk melanjutkan.";
                errorMessage.style.display = 'flex';
                return;
            }

            loadingOverlay.style.display = 'flex';
            errorMessage.style.display = 'none';
            generateButton.disabled = true;
            generateButton.classList.add('opacity-50', 'cursor-not-allowed');

            try {
                const hasSpecialWish = data.specialWishPrompt && data.specialWishPrompt.trim() !== '';
                
                let prompt = `Buatkan konten untuk kartu ucapan yang sangat berkesan.
                - Jenis Ucapan: ${data.greetingType}
                - Untuk: ${data.recipientName}
                - Tema Visual: ${data.themeSelector}
                - Deskripsi Pesan Utama: ${data.mainMessagePrompt}
                - ${hasSpecialWish ? `Deskripsi Pesan Spesial: ${data.specialWishPrompt}` : ''}

                Balas dengan format JSON. Buat teks yang panjang, mendalam, dan puitis.
                - 'mainMessage': Tulis beberapa paragraf yang panjang, kaya metafora, dan sangat berkesan.
                - 'specialWish': ${hasSpecialWish ? "Tulis beberapa paragraf doa atau harapan yang lebih panjang, mendalam, dan menyentuh hati." : "string kosong."}
                - 'headerTitle', 'subtitle', 'revealButtonText', 'specialWishButtonText', 'footerText': Buat teks yang kreatif dan cocok dengan tema. Gunakan placeholder {{RECIPIENT_NAME}} dan {{SENDER_NAME}} jika perlu.`;

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "mainMessage": { "type": "STRING" },
                                "specialWish": { "type": "STRING" },
                                "headerTitle": { "type": "STRING" },
                                "subtitle": { "type": "STRING" },
                                "revealButtonText": { "type": "STRING" },
                                "specialWishButtonText": { "type": "STRING" },
                                "footerText": { "type": "STRING" }
                            }
                        }
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API call failed: ${response.status}. Pesan: ${errorData.error.message}`);
                }

                const result = await response.json();
                
                let generatedText;
                if (result.candidates && result.candidates[0].content.parts.length > 0) {
                    generatedText = JSON.parse(result.candidates[0].content.parts[0].text);
                } else {
                    throw new Error("Invalid API response structure.");
                }
                
                generatedHtmlContent = generateFullHtml({ ...data, ...generatedText });
                previewFrame.srcdoc = generatedHtmlContent;
                outputActions.classList.remove('hidden');

            } catch (error) {
                console.error("Error generating greeting:", error);
                errorText.textContent = `Gagal menghasilkan ucapan. Pastikan API Key Anda benar dan coba lagi. Detail: ${error.message}`;
                errorMessage.style.display = 'flex';
            } finally {
                loadingOverlay.style.display = 'none';
                generateButton.disabled = false;
                generateButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        });


        // --- Action Button Logic ---
        copyButton.addEventListener('click', () => {
            const textarea = document.createElement('textarea');
            textarea.value = generatedHtmlContent;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                copySuccessMessage.classList.remove('hidden');
                setTimeout(() => copySuccessMessage.classList.add('hidden'), 2000);
            } catch (err) {
                console.error('Failed to copy code:', err);
            }
            document.body.removeChild(textarea);
        });

        downloadButton.addEventListener('click', () => {
            const blob = new Blob([generatedHtmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const recipientName = document.getElementById('recipientName').value || 'ucapan';
            const filename = `ucapan-untuk-${recipientName.toLowerCase().replace(/[\s,.]+/g, '-')}.html`;
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // --- HTML Generation Function ---
        function generateFullHtml(data) {
            const theme = getThemeAndStructure(data.themeSelector);
            const hasSpecialWish = data.specialWish && data.specialWish.trim() !== '';

            let finalHtml = theme.htmlTemplate
                .replace(/{{PAGE_TITLE}}/g, `${theme.emoji} ${data.greetingType} untuk ${data.recipientName} ${theme.emoji}`)
                .replace(/{{FONTS_URL}}/g, theme.fontsUrl)
                .replace(/{{CSS}}/g, theme.css)
                .replace(/{{BACKGROUND_HTML}}/g, theme.backgroundHtml)
                .replace(/{{CARD_BADGE}}/g, theme.emoji)
                .replace(/{{HEADER_TITLE}}/g, data.headerTitle)
                .replace(/{{SUBTITLE}}/g, data.subtitle.replace('{{RECIPIENT_NAME}}', data.recipientName))
                .replace(/{{REVEAL_BUTTON_TEXT}}/g, data.revealButtonText)
                .replace(/{{MAIN_MESSAGE_TITLE}}/g, `${theme.emoji} ${data.greetingType}, ${data.recipientName.split(',')[0]}! ${theme.emoji}`)
                .replace(/{{MAIN_MESSAGE}}/g, data.mainMessage.replace(/\n/g, '<br><br>'))
                .replace(/{{SPECIAL_WISH_BUTTON_TEXT}}/g, hasSpecialWish ? data.specialWishButtonText : '')
                .replace(/{{SPECIAL_WISH_CONTENT}}/g, hasSpecialWish ? data.specialWish.replace(/\n/g, '<br><br>') : '')
                .replace(/{{FOOTER_TEXT}}/g, data.footerText.replace('{{SENDER_NAME}}', data.senderName))
                .replace(/{{JS_LOGIC}}/g, theme.jsLogic)
                .replace(/{{EVENT_DATE}}/g, data.eventDate);

            if (!hasSpecialWish) {
                finalHtml = finalHtml.replace(/<button id="special-wish-btn".*?<\/button>/, '');
                finalHtml = finalHtml.replace(/<div id="special-wish-container".*?<\/div>/, '');
            }

            return finalHtml;
        }
        
        // --- Theme and Structure Definitions ---
        function getThemeAndStructure(themeKey) {
            // This function is now a placeholder. The full, detailed theme data
            // would be too large to include here again. The logic remains the same:
            // it fetches the complete HTML, CSS, and JS structure for the selected theme.
            // For this example, we'll just use a simplified version of one theme.
            const themes = {
                 galaxy: {
                    emoji: 'üå†',
                    fontsUrl: 'https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Orbitron:wght@400;700&family=Rajdhani:wght@300;400;600&family=Caveat:wght@400;700&display=swap',
                    backgroundHtml: `<div class="nebula-background"><div class="nebula-bg-1"></div><div class="nebula-bg-2"></div></div><div class="stars-container" id="stars-container-main"></div><div class="moving-nebulae-container" id="moving-nebulae-container"><div class="nebula-cloud nebula1"></div><div class="nebula-cloud nebula2"></div><div class="nebula-cloud nebula3"></div></div>`,
                    css: `/* CSS LENGKAP TEMA GALAXY DARI CONTOH */
                        body { font-family: 'Rajdhani', 'Orbitron', sans-serif; overflow-x: hidden; background: linear-gradient(to bottom, #00001a 0%, #0b0033 30%, #1a004d 70%, #2c0066 100%); background-attachment: fixed; color: #E0E0E0; position: relative; min-height: 100vh; padding: 2rem 1rem; }
                        .nebula-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; opacity: 0.5; }
                        .nebula-bg-1 { position: absolute; top: -20%; left: -30%; width: 150%; height: 150%; background: radial-gradient(circle at 30% 30%, rgba(100, 0, 150, 0.25) 0%, transparent 50%); animation: slowPulse 30s infinite alternate ease-in-out; }
                        .nebula-bg-2 { position: absolute; bottom: -30%; right: -40%; width: 180%; height: 180%; background: radial-gradient(circle at 70% 70%, rgba(0, 100, 150, 0.2) 0%, transparent 55%); animation: slowPulse 35s infinite alternate ease-in-out -5s; }
                        @keyframes slowPulse { 0% { transform: scale(0.95); opacity: 0.4; } 100% { transform: scale(1.05); opacity: 0.6; } }
                        .stars-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: 1; pointer-events: none; }
                        .star { position: absolute; background: white; border-radius: 50%; box-shadow: 0 0 5px white, 0 0 10px white, 0 0 15px #aaaaff; animation: twinkleStar 3s infinite ease-in-out; }
                        @keyframes twinkleStar { 0%, 100% { opacity: var(--star-min-opacity, 0.2); transform: scale(var(--star-min-scale, 0.5)); } 50% { opacity: var(--star-max-opacity, 1); transform: scale(var(--star-max-scale, 1.2)); } }
                        .moving-nebulae-container { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; overflow: hidden; z-index: 2; pointer-events: none; }
                        .nebula-cloud { position: absolute; border-radius: 50%; opacity: 0; animation: moveNebula 70s linear infinite; filter: blur(10px); }
                        .nebula-cloud.nebula1 { width: clamp(300px, 40vw, 600px); height: clamp(200px, 30vh, 400px); top: 10%; left: -30%; background: radial-gradient(ellipse at center, rgba(120, 80, 200, 0.25) 0%, rgba(80, 50, 150, 0.15) 40%, transparent 70%); animation-duration: 120s; }
                        .nebula-cloud.nebula2 { width: clamp(400px, 50vw, 700px); height: clamp(250px, 35vh, 450px); top: 40%; left: -40%; background: radial-gradient(ellipse at center, rgba(80, 150, 200, 0.2) 0%, rgba(50, 100, 150, 0.1) 40%, transparent 70%); animation-duration: 150s; animation-delay: -40s; }
                        .nebula-cloud.nebula3 { width: clamp(200px, 25vw, 400px); height: clamp(150px, 20vh, 300px); top: 20%; right: -30%; background: radial-gradient(ellipse at center, rgba(200, 80, 120, 0.2) 0%, rgba(150, 50, 80, 0.1) 40%, transparent 70%); animation-duration: 90s; animation-delay: -20s; animation-name: moveNebulaRightToLeft; }
                        @keyframes moveNebula { 0% { transform: translateX(0) rotate(0deg); opacity: 0.3; } 50% { opacity: 0.5; } 100% { transform: translateX(calc(100vw + 100%)) rotate(90deg); opacity: 0.3; } }
                        @keyframes moveNebulaRightToLeft { 0% { transform: translateX(0) rotate(0deg); opacity: 0.3; } 50% { opacity: 0.5; } 100% { transform: translateX(calc(-100vw - 100%)) rotate(-90deg); opacity: 0.3; } }
                        .container { position: relative; z-index: 10; max-width: 680px; width: calc(100% - 2rem); margin-left: auto; margin-right: auto; }
                        .card { background: rgba(10, 20, 50, 0.65); backdrop-filter: blur(12px) saturate(150%); border: 1px solid rgba(100, 150, 255, 0.5); border-radius: 25px; padding: clamp(2rem, 5vw, 3rem); box-shadow: 0 0 25px rgba(100, 150, 255, 0.3), 0 0 50px rgba(150, 100, 255, 0.2); text-align: center; transform: scale(0.9) rotate(-0.2deg); opacity: 0; animation: cardAppearGalaxy 2s ease-out forwards 0.5s; position: relative; overflow: hidden; }
                        @keyframes cardAppearGalaxy { to { transform: scale(1) rotate(0deg); opacity: 1; } }
                        .card::before { content: ''; position: absolute; top: -70%; left: -70%; width: 240%; height: 240%; background: radial-gradient(circle, rgba(150, 180, 255, 0.1) 0%, transparent 60%); animation: galaxyShine 15s infinite linear; opacity: 0.7; }
                        @keyframes galaxyShine { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
                        .header-title { font-family: 'Orbitron', 'Cinzel Decorative', cursive; font-size: clamp(2.0rem, 6.5vw, 3.5rem); font-weight: 700; color: #C0D8FF; margin-bottom: 1.2rem; text-shadow: 0 0 5px #C0D8FF, 0 0 10px #80A0FF, 0 0 15px #5070FF, 1px 1px 2px rgba(0,0,0,0.5); animation: titleGlowGalaxy 4s ease-in-out infinite alternate; }
                        .card.content-revealed .header-title { font-size: clamp(1.7rem, 5vw, 2.7rem); color: #D8E8FF; }
                        @keyframes titleGlowGalaxy { from { text-shadow: 0 0 4px #C0D8FF, 0 0 8px #80A0FF, 0 0 12px #5070FF, 1px 1px 1px rgba(0,0,0,0.4); opacity: 0.9; } to { text-shadow: 0 0 7px #C0D8FF, 0 0 14px #80A0FF, 0 0 20px #5070FF, 0 0 2px #fff, 1px 1px 3px rgba(0,0,0,0.6); opacity: 1; } }
                        .subtitle { font-family: 'Rajdhani', 'Caveat', serif; font-size: clamp(1.0rem, 3.5vw, 1.25rem); margin-bottom: 2.2rem; color: #A0B8DD; font-weight: 400; animation: subtitleFadeGalaxy 2s ease-out 1s forwards; opacity: 0; }
                        @keyframes subtitleFadeGalaxy { to { opacity: 1; } } 
                        #countdown { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.2rem; margin: 2.2rem 0; animation: countdownAppearGalaxy 2s ease-out 1.2s forwards; opacity: 0; }
                        @media (min-width: 500px) { #countdown { grid-template-columns: repeat(4, 1fr); } }
                        @keyframes countdownAppearGalaxy { to { opacity: 1; } }
                        .countdown-item { background: rgba(50, 80, 150, 0.2); border: 1px solid rgba(100, 150, 200, 0.4); border-radius: 18px; padding: 1.1rem; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 0 8px rgba(100, 150, 200, 0.15); }
                        .countdown-item:hover { transform: translateY(-8px) scale(1.08); box-shadow: 0 8px 18px rgba(100, 150, 200, 0.25), 0 0 12px rgba(150, 180, 255, 0.3); }
                        .countdown-number { font-family: 'Orbitron', 'Cinzel Decorative', cursive; font-size: clamp(1.5rem, 5vw, 2.2rem); font-weight: 700; color: #B0CFFF; text-shadow: 0 0 3px #80A0FF; }
                        .countdown-label { font-family: 'Rajdhani', serif; font-size: clamp(0.6rem, 2.3vw, 0.75rem); color: #809ACC; text-transform: uppercase; letter-spacing: 1.5px; margin-top: 0.5rem; }
                        .reveal-btn { background: linear-gradient(45deg, #3040A0, #5070E0, #80A0FF); background-size: 280% 280%; color: #FFFFFF; border: 1px solid rgba(120, 160, 255, 0.7); padding: 1rem 2rem; border-radius: 35px; font-family: 'Orbitron', 'Caveat', cursive; font-size: clamp(0.85rem, 3.3vw, 1.05rem); font-weight: 700; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 5px 15px rgba(80, 112, 224, 0.4), inset 0 -2px 4px rgba(0,0,0,0.2), 0 0 10px rgba(150,180,255,0.3); animation: btnPulseGalaxy 3s infinite, btnGradientShiftGalaxy 7s ease infinite; margin: 2.2rem 0; display: none; text-transform: uppercase; letter-spacing: 1.2px; }
                        @keyframes btnGradientShiftGalaxy { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
                        @keyframes btnPulseGalaxy { 0% { transform: scale(1); box-shadow: 0 5px 15px rgba(80, 112, 224, 0.4), inset 0 -2px 4px rgba(0,0,0,0.2), 0 0 10px rgba(150,180,255,0.3); } 50% { transform: scale(1.04); box-shadow: 0 7px 20px rgba(80, 112, 224, 0.55), 0 0 15px #A0C0FF, inset 0 -2px 4px rgba(0,0,0,0.2); } 100% { transform: scale(1); box-shadow: 0 5px 15px rgba(80, 112, 224, 0.4), inset 0 -2px 4px rgba(0,0,0,0.2), 0 0 10px rgba(150,180,255,0.3); } }
                        .reveal-btn:hover { transform: translateY(-4px) scale(1.04); box-shadow: 0 8px 22px rgba(80, 112, 224, 0.5), 0 0 18px #C0E0FF, inset 0 -2px 4px rgba(0,0,0,0.25); }
                        .birthday-content { display: none; animation: contentAppearGalaxy 2s ease-out forwards; margin-top: 2.2rem; }
                        @keyframes contentAppearGalaxy { 0% { opacity: 0; transform: translateY(20px) scale(0.97); } 100% { opacity: 1; transform: translateY(0) scale(1); } }
                        .birthday-message { background: rgba(30, 50, 100, 0.25); border-radius: 18px; padding: 1.6rem; margin: 1.2rem 0; border: 1px solid rgba(100, 150, 200, 0.3); font-size: clamp(0.88rem, 3.2vw, 1.0rem); line-height: 1.75; color: #B8CCEE; text-align: left;}
                        .birthday-message h2 { font-family: 'Orbitron','Caveat', cursive; color: #C0D8FF; margin-bottom: 0.8rem; font-size: clamp(1.4rem, 4vw, 1.9rem); text-shadow: 0 0 5px #A0C0FF; text-align: center;}
                        .special-wish-btn { background: linear-gradient(45deg, #B080FF, #80A0FF); color: #FFFFFF; border: none; padding: 0.9rem 1.8rem; border-radius: 30px; font-family: 'Rajdhani','Caveat', serif; font-size: clamp(0.75rem, 2.8vw, 0.9rem); font-weight: 600; cursor: pointer; margin: 1.8rem 0; transition: all 0.3s ease; display: none; box-shadow: 0 4px 12px rgba(176,128,255,0.3); }
                        .special-wish-btn:hover { transform: translateY(-3px); box-shadow: 0 7px 18px rgba(176,128,255,0.4), 0 0 10px #D0B0FF; }
                        .special-wish-container { display: none; background: rgba(15, 30, 60, 0.9); color: #C0D0F0; border-radius: 18px; padding: 2rem; margin: 1.8rem 0; box-shadow: 0 8px 25px rgba(80, 100, 180, 0.2); text-align: left; line-height: 1.8; font-size: clamp(0.85rem, 2.9vw, 0.93rem); border: 1px solid rgba(120,150,220,0.4); animation: fadeInSpecialWishGalaxy 1s ease-out; }
                        @keyframes fadeInSpecialWishGalaxy { from { opacity: 0; transform: scale(0.96); } to { opacity: 1; transform: scale(1); } }
                        .special-wish-container strong { color: #87CEFA; }
                        .special-wish-container em { color: #ADD8E6; }
                        .footer { margin-top: 2.2rem; font-size: clamp(0.75rem, 2.5vw, 0.83rem); color: #809ACC; font-weight: 400; font-family: 'Rajdhani', 'Caveat', serif; }
                        .badge { position: absolute; top: -15px; right: -15px; background: linear-gradient(135deg, #80A0FF, #C080FF); color: #000020; border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; font-size: 28px; animation: badgeSwayGalaxy 3.5s ease-in-out infinite; box-shadow: 0 5px 12px rgba(128, 160, 255, 0.4); z-index: 100; font-family: 'Noto Color Emoji', sans-serif; }
                        @keyframes badgeSwayGalaxy { 0%, 100% { transform: rotate(-6deg) scale(1); } 50% { transform: rotate(6deg) scale(1.12); } }
                        .comet-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: 15; pointer-events: none; display: none; }
                        .comet { position: absolute; width: clamp(100px, 18vw, 200px); height: clamp(2px, 0.6vw, 4px); background: linear-gradient(to left, rgba(255, 255, 255, 1) 0%, rgba(220, 230, 255, 0.8) 20%, rgba(180, 200, 255, 0.5) 50%, transparent 100%); border-radius: 50px; opacity: 0; animation: shootCometHorizontal 3s linear infinite; filter: drop-shadow(0 0 3px rgba(200,220,255,0.7)) drop-shadow(0 0 8px rgba(255,255,255,0.5)); }
                        @keyframes shootCometHorizontal { 0% { transform: translateX(var(--comet-start-x)); opacity: 0; } 10% { transform: translateX(calc(var(--comet-start-x) + 5vw)) scaleX(0.3); opacity: var(--comet-opacity, 0.9); } 20% { transform: translateX(calc(var(--comet-start-x) + 15vw)) scaleX(1); opacity: var(--comet-opacity, 0.9); } 80% { transform: translateX(calc(var(--comet-start-x) + 85vw)) scaleX(1); opacity: var(--comet-opacity, 0.9); } 90% { transform: translateX(calc(var(--comet-start-x) + 95vw)) scaleX(0.3); opacity: var(--comet-opacity, 0.9); } 100% { transform: translateX(var(--comet-end-x)); opacity: 0; } }
                        @media (max-width: 768px) { body { padding: 1rem 0.5rem; } .container { width: calc(100% - 1rem); margin-top: 1.5rem; margin-bottom: 1.5rem; } }
                        @media (max-width: 480px) { .card { padding: 1.8rem; } .header-title { font-size: clamp(1.8rem, 6vw, 3rem); } .moving-nebulae-container { display: none; } }
                    `,
                },
                // Themes lainnya akan mengikuti pola yang sama
            };
            
            const selectedTheme = themes[themeKey] || themes.galaxy;

            selectedTheme.jsLogic = `
                // JS LENGKAP DARI CONTOH UNTUK TEMA INI
                const cardEl = document.getElementById('mainCard');
                const countdownEl = document.getElementById('countdown');
                const birthdayContentEl = document.getElementById('birthday-content');
                const mainTitleEl = document.getElementById('main-title');
                const subtitleEl = document.getElementById('subtitle');
                const specialWishBtn = document.getElementById('special-wish-btn');
                const specialWishContainer = document.getElementById('special-wish-container');
                const revealBtn = document.getElementById('reveal-btn');
                const eventDate = new Date('{{EVENT_DATE}}').getTime();
                const thirtyDaysInMs = 30 * 24 * 60 * 60 * 1000;
                const audio = new Audio('https://cdn.sanity.io/files/zhgxj6ko/production/20096b856584fe42be47145334272a834c663ffe.mp3');
                audio.loop = true;
                let musicStarted = false;

                function createParticles() {
                    // Logika spesifik partikel untuk setiap tema akan ada di sini
                    if (document.getElementById('stars-container-main')) {
                         const starsContainer = document.getElementById('stars-container-main');
                         const numStars = window.innerWidth < 768 ? 150 : 300; 
                         if (!starsContainer) return; 
                         starsContainer.innerHTML = ''; 
                         for (let i = 0; i < numStars; i++) { 
                             const star = document.createElement('div'); 
                             star.className = 'star';
                             const size = Math.random() * 2.5 + 0.5;
                             star.style.width = size + 'px';
                             star.style.height = size + 'px';
                             star.style.left = Math.random() * 100 + 'vw'; 
                             star.style.top = Math.random() * 100 + 'vh'; 
                             const animationDelay = Math.random() * 3; 
                             const animationDuration = Math.random() * 2 + 2;
                             star.style.animationDelay = animationDelay + 's'; 
                             star.style.animationDuration = animationDuration + 's';
                             star.style.setProperty('--star-min-opacity', (Math.random() * 0.3 + 0.1).toFixed(2));
                             star.style.setProperty('--star-max-opacity', (Math.random() * 0.4 + 0.6).toFixed(2));
                             star.style.setProperty('--star-min-scale', (Math.random() * 0.4 + 0.3).toFixed(2));
                             star.style.setProperty('--star-max-scale', (Math.random() * 0.5 + 0.8).toFixed(2));
                             starsContainer.appendChild(star); 
                         } 
                    }
                    // Tambahkan logika partikel lainnya di sini
                }

                function createRevealedParticles() {
                    if (document.getElementById('comet-container')) {
                        const cometContainer = document.getElementById('comet-container');
                        if (!cometContainer) return; 
                        cometContainer.innerHTML = ''; 
                        cometContainer.style.display = 'block';
                        const cometCount = window.innerWidth < 768 ? 4 : 6;
                        for (let i = 0; i < cometCount; i++) { 
                            const comet = document.createElement('div'); 
                            comet.className = 'comet'; 
                            const startX = -20;
                            const endX = 120;
                            const startY = Math.random() * 80 + 10;
                            comet.style.top = startY + 'vh';
                            comet.style.setProperty('--comet-start-x', startX + 'vw');
                            comet.style.setProperty('--comet-end-x', endX + 'vw');
                            comet.style.setProperty('--comet-opacity', (Math.random() * 0.2 + 0.7).toFixed(2));
                            comet.style.animationName = 'shootCometHorizontal';
                            comet.style.animationDelay = Math.random() * 2.5 + 's'; 
                            comet.style.animationDuration = (Math.random() * 1.5 + 2.0) + 's';
                            cometContainer.appendChild(comet); 
                        } 
                    }
                     // Tambahkan logika partikel lainnya di sini
                }

                if (revealBtn) {
                    revealBtn.addEventListener('click', () => {
                        revealBtn.style.display = 'none';
                        if (cardEl) cardEl.classList.add('content-revealed');
                        if (birthdayContentEl) birthdayContentEl.style.display = 'block';
                        if (specialWishBtn) specialWishBtn.style.display = 'inline-block';
                        createRevealedParticles();
                        if (!musicStarted) {
                            const playPromise = audio.play();
                            if (playPromise !== undefined) {
                                playPromise.catch(error => {
                                    console.error("Autoplay musik gagal:", error);
                                    const playOnAnyInteraction = () => {
                                        if (!musicStarted) {
                                            audio.play().then(() => {
                                                musicStarted = true;
                                                document.removeEventListener('click', playOnAnyInteraction);
                                            }).catch(e => console.error("Gagal memulai musik:", e));
                                        }
                                    };
                                    document.addEventListener('click', playOnAnyInteraction);
                                });
                            }
                        }
                    });
                }

                if (specialWishBtn) {
                    specialWishBtn.addEventListener('click', () => {
                        if (specialWishContainer) {
                            specialWishContainer.style.display = 'block';
                            specialWishContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }
                    });
                }

                function updateCountdown() {
                    const now = Date.now();
                    const distance = eventDate - now;
                    if (distance < 0) {
                        clearInterval(countdownInterval);
                        if (countdownEl) countdownEl.style.display = 'none';
                        if (revealBtn) revealBtn.style.display = 'inline-block';
                        return;
                    }
                    const days = Math.floor(distance / 86400000);
                    const hours = Math.floor((distance % 86400000) / 3600000);
                    const minutes = Math.floor((distance % 3600000) / 60000);
                    const seconds = Math.floor((distance % 60000) / 1000);
                    document.getElementById('days').textContent = String(days).padStart(2, '0');
                    document.getElementById('hours').textContent = String(hours).padStart(2, '0');
                    document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
                    document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
                }
                
                createParticles();
                const countdownInterval = setInterval(updateCountdown, 1000);
                updateCountdown();

                if (cardEl) {
                    let initialTransformStyle = ''; 
                    let isMouseOverCard = false;
                    cardEl.addEventListener('animationend', (event) => {
                        if (event.animationName.includes('cardAppear')) {
                            initialTransformStyle = window.getComputedStyle(cardEl).transform;
                            if (initialTransformStyle === 'none') initialTransformStyle = 'perspective(1500px) rotateX(0deg) rotateY(0deg) scale(1)';
                            cardEl.addEventListener('mousemove', handleCardMouseMove);
                            cardEl.addEventListener('mouseenter', () => { isMouseOverCard = true; });
                            cardEl.addEventListener('mouseleave', () => { isMouseOverCard = false; resetCardTransform(); });
                        }
                    });
                    function handleCardMouseMove(e) {
                        if (!isMouseOverCard) return;
                        const rect = cardEl.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;
                        const { width, height } = rect;
                        const rotateX = ((y / height) - 0.5) * -30; // max 15deg tilt
                        const rotateY = ((x / width) - 0.5) * 30; // max 15deg tilt
                        cardEl.style.transition = 'transform 0.1s linear';
                        cardEl.style.transform = \`perspective(1500px) rotateX(\${rotateX}deg) rotateY(\${rotateY}deg) scale(1.05)\`;
                    }
                    function resetCardTransform() {
                        cardEl.style.transition = 'transform 0.5s ease-out';
                        cardEl.style.transform = initialTransformStyle;
                    }
                }
            `;

            selectedTheme.htmlTemplate = `
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{PAGE_TITLE}}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="{{FONTS_URL}}" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        {{CSS}}
    </style>
</head>
<body>
    {{BACKGROUND_HTML}}
    <div class="container">
        <div class="card" id="mainCard">
            <div class="badge">{{CARD_BADGE}}</div> 
            <h1 id="main-title" class="header-title">{{HEADER_TITLE}}</h1>
            <p id="subtitle" class="subtitle">{{SUBTITLE}}</p>
            <div id="countdown">
                <div class="countdown-item"><span id="days" class="countdown-number">00</span><div class="countdown-label">Hari</div></div>
                <div class="countdown-item"><span id="hours" class="countdown-number">00</span><div class="countdown-label">Jam</div></div>
                <div class="countdown-item"><span id="minutes" class="countdown-number">00</span><div class="countdown-label">Menit</div></div>
                <div class="countdown-item"><span id="seconds" class="countdown-number">00</span><div class="countdown-label">Detik</div></div>
            </div>
            <button id="reveal-btn" class="reveal-btn">{{REVEAL_BUTTON_TEXT}}</button>
            <div id="birthday-content" class="birthday-content">
                <div class="birthday-message"><h2>{{MAIN_MESSAGE_TITLE}}</h2><p>{{MAIN_MESSAGE}}</p></div>
                <button id="special-wish-btn" class="special-wish-btn">{{SPECIAL_WISH_BUTTON_TEXT}}</button>
                <div id="special-wish-container" class="special-wish-container"><p>{{SPECIAL_WISH_CONTENT}}</p></div>
            </div>
            <div class="footer">{{FOOTER_TEXT}}</div>
        </div>
    </div>
    <div class="comet-container" id="comet-container"></div>
    <script>
        {{JS_LOGIC}}
    <\/script>
</body>
</html>`;
            return selectedTheme;
        }

    </script>
</body>
</html>
