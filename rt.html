<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merdeka Mengajar SD/SMP/SMA 2025/2026</title>
    <link rel="icon" type="image/png" href="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/Logo_of_Ministry_of_Education_and_Culture_of_Republic_of_Indonesia.svg/100px-Logo_of_Ministry_of_Education_and_Culture_of_Republic_of_Indonesia.svg.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.1/qrcode.min.js"></script>
    <!-- === KODE FACEBOOK PIXEL DIMULAI DI SINI === -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '630583642253416');
      fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=630583642253416&ev=PageView&noscript=1"
    /></noscript>
    <!-- === AKHIR DARI KODE FACEBOOK PIXEL === -->
    <style>
        :root {
            /* Vibrant Google-Style Palette */
            --theme-primary: #1a73e8;
            --theme-primary-hover: #1557b0;
            --theme-background: #f8f9fa;
            --theme-surface: #ffffff;
            --theme-on-surface: #3c4043;
            --theme-on-surface-variant: #5f6368;
            --theme-outline: #dadce0;
            --theme-outline-variant: #e8eaed;

            /* Custom Google Colors */
            --google-blue: #4285F4;
            --google-green: #34A853;
            --google-yellow: #FBBC05;
            --google-red: #EA4335;

            /* Shadows */
            --shadow-1: 0 1px 2px 0 rgba(60,64,67,.3), 0 1px 3px 1px rgba(60,64,67,.15);
            --shadow-2: 0 1px 2px 0 rgba(60,64,67,.3), 0 2px 6px 2px rgba(60,64,67,.15);
            --shadow-3: 0 4px 8px 3px rgba(60,64,67,.15), 0 1px 3px rgba(60,64,67,.3);
        }

        /* Google Sans Typography */
        body {
            font-family: 'Google Sans', 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--theme-background);
            color: var(--theme-on-surface);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .google-sans {
            font-family: 'Google Sans', sans-serif;
        }

        /* Enhanced Material Design Components */
        .material-card {
            background: var(--theme-surface);
            border-radius: 12px;
            box-shadow: var(--shadow-1);
            transition: box-shadow 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--theme-outline);
        }

        .material-card:hover {
            box-shadow: var(--shadow-2);
        }

        .material-card-elevated {
            box-shadow: var(--shadow-2);
        }

        /* Enhanced Form Inputs */
        .form-input {
            border: 2px solid var(--theme-outline);
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 8px;
            padding: 10px 12px;
            width: 100%;
            background-color: var(--theme-surface);
            font-size: 16px;
            font-family: 'Roboto', sans-serif;
            color: var(--theme-on-surface);
        }

        .form-input:focus {
            border-color: var(--theme-primary);
            background-color: var(--theme-surface);
            outline: none;
            box-shadow: 0 0 0 1px var(--theme-primary);
        }

        .form-input::placeholder {
            color: var(--theme-on-surface-variant);
        }

        /* Enhanced Google-style Buttons */
        .cta-button {
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 24px;
            padding: 12px 28px;
            font-size: 15px;
            font-weight: 500;
            font-family: 'Google Sans', sans-serif;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            width: 100%;
            border: none;
            text-transform: none;
            letter-spacing: 0.25px;
            min-height: 46px;
        }

        .blue-button {
            background-color: var(--theme-primary);
            color: white;
            box-shadow: var(--shadow-1);
        }

        .blue-button:hover {
            background-color: var(--theme-primary-hover);
            box-shadow: var(--shadow-2);
            transform: translateY(-1px);
        }

        .blue-button:active {
            transform: translateY(0);
            box-shadow: var(--shadow-1);
        }
        
        .cta-button:disabled {
            background-color: var(--theme-outline-variant);
            color: var(--theme-on-surface-variant);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Enhanced Modal Styling */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.85);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--theme-surface);
            margin: auto;
            padding: 28px;
            width: 90%;
            max-width: 480px;
            border-radius: 16px;
            box-shadow: var(--shadow-3);
            text-align: center;
            position: relative;
            animation: modalSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-content h3 {
            color: var(--theme-on-surface);
            margin-bottom: 12px;
            font-size: 18px;
            font-weight: 500;
            font-family: 'Google Sans', sans-serif;
        }

        .modal-content p {
            color: var(--theme-on-surface-variant);
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 14px;
        }

        .modal-ok-button {
            background-color: var(--theme-primary);
            color: white;
            padding: 10px 28px;
            border: none;
            border-radius: 24px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            font-family: 'Google Sans', sans-serif;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 36px;
        }

        .modal-ok-button:hover {
            background-color: var(--theme-primary-hover);
            box-shadow: var(--shadow-1);
        }

        /* === START: Auto-Scrolling Testimonial Carousel Styles === */
        @keyframes scroll {
            from { transform: translateX(0); }
            to { transform: translateX(-100%); }
        }

        .testimonial-carousel-container {
            display: flex;
            overflow: hidden;
            position: relative;
            width: 100%;
            -webkit-mask-image: linear-gradient(to right, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 5%, rgba(0,0,0,1) 95%, rgba(0,0,0,0) 100%);
            mask-image: linear-gradient(to right, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 5%, rgba(0,0,0,1) 95%, rgba(0,0,0,0) 100%);
        }

        .testimonial-track {
            flex-shrink: 0;
            display: flex;
            justify-content: flex-start;
            min-width: 100%;
            animation: scroll 60s linear infinite;
        }

        .testimonial-carousel-container:hover .testimonial-track {
            animation-play-state: paused;
        }

        .testimonial-slide {
            flex-shrink: 0;
            width: 40vw;
            max-width: 380px;
            padding: 0 6px;
        }
        
        .testimonial-image {
            width: 100%;
            height: auto;
            object-fit: cover;
            aspect-ratio: 4 / 3;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .testimonial-image:hover {
            transform: scale(1.03);
            box-shadow: var(--shadow-2);
        }
        /* === END: Auto-Scrolling Testimonial Carousel Styles === */

        /* Enhanced Notification Toast */
        .notif-box {
            position: fixed;
            top: 24px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #3c4043;
            color: #ffffff;
            border-radius: 8px;
            box-shadow: var(--shadow-3);
            padding: 16px 24px;
            display: none;
            align-items: center;
            gap: 12px;
            width: auto;
            max-width: 400px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Roboto', sans-serif;
        }

        .notif-box.show {
            display: flex;
            opacity: 1;
            animation: slideInAndOut 5s ease-in-out forwards;
        }

        @keyframes slideInAndOut {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            10% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            90% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
        }

        .notif-icon-wrapper {
            color: var(--google-green);
            font-size: 20px;
            flex-shrink: 0;
        }

        .notif-message {
            font-size: 14px;
            line-height: 1.4;
        }

        .notif-message strong {
            font-weight: 500;
        }
        
        /* Enhanced FAQ Section */
        .faq-item {
            border-bottom: 1px solid var(--theme-outline);
            transition: background-color 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .faq-item:last-child {
            border-bottom: none;
        }

        .faq-item:hover {
            background-color: var(--theme-background);
        }

        .faq-item summary {
            font-weight: 500;
            font-size: 15px;
            color: var(--theme-on-surface);
            padding: 16px 12px;
            cursor: pointer;
            list-style: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Google Sans', sans-serif;
        }

        .faq-item summary::-webkit-details-marker {
            display: none;
        }

        .faq-item summary::after {
            content: '\f078';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--theme-on-surface-variant);
            font-size: 14px;
        }

        .faq-item[open] summary::after {
            transform: rotate(180deg);
        }

        .faq-content {
            padding: 0 12px 16px 12px;
            color: var(--theme-on-surface-variant);
            line-height: 1.6;
            font-size: 14px;
        }

        .faq-item[open] summary {
            color: var(--theme-primary);
        }
       
        /* Enhanced Product Info Display */
        #product-info-form-top {
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .product-info-card {
            background: linear-gradient(135deg, #e8f0fe 0%, var(--theme-surface) 100%);
            border: 1px solid var(--theme-outline);
            border-radius: 16px;
            padding: 16px;
        }

        /* Enhanced Payment Method Styles */
        .payment-radio {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .payment-label {
            display: flex;
            align-items: center;
            padding: 12px;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border-radius: 12px;
            margin: 2px;
        }

        .payment-label:hover {
            background-color: var(--theme-background);
        }

        .payment-radio:checked + .payment-label {
            background-color: #e8f0fe; /* Light blue */
            box-shadow: inset 0 0 0 2px var(--theme-primary);
        }
        
        .form-payment-logo-container {
            width: 48px;
            height: 32px;
            background-color: #ffffff;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            padding: 4px;
            border: 1px solid var(--theme-outline, #dadce0);
            flex-shrink: 0;
        }

        .payment-logo {
            max-height: 100%;
            max-width: 100%;
            object-fit: contain;
        }

        .custom-radio-button {
            height: 20px;
            width: 20px;
            border: 2px solid var(--theme-outline);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            flex-shrink: 0;
            margin-left: auto;
        }

        .custom-radio-button .dot {
            height: 8px;
            width: 8px;
            border-radius: 50%;
            background-color: transparent;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .payment-radio:checked + .payment-label .custom-radio-button {
            border-color: var(--theme-primary);
        }

        .payment-radio:checked + .payment-label .custom-radio-button .dot {
            background-color: var(--theme-primary);
        }

        /* Enhanced Payment Instruction Layout */
        .payment-header {
            background: linear-gradient(135deg, #202124 0%, #3c4043 100%);
            color: #fff;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 999;
        }

        .payment-card {
            background-color: var(--theme-surface);
            border: 1px solid var(--theme-outline);
            border-radius: 12px;
            padding: 16px;
            margin-top: 12px;
            box-shadow: var(--shadow-1);
        }

        .copy-button-text {
            background: none;
            border: none;
            color: var(--theme-primary);
            font-weight: 500;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .copy-button-text:hover {
            background-color: #e8f0fe;
        }

        .confirm-button-outlined {
            width: 100%;
            padding: 12px 24px;
            border: 2px solid var(--theme-primary);
            color: var(--theme-primary);
            background-color: transparent;
            border-radius: 24px;
            font-weight: 500;
            font-family: 'Google Sans', sans-serif;
            cursor: pointer;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 48px;
        }

        .confirm-button-outlined:hover {
            background-color: #e8f0fe;
            box-shadow: var(--shadow-1);
        }

        .payment-accordion {
            border-bottom: 1px solid var(--theme-outline);
        }

        .payment-accordion:last-child {
            border-bottom: none;
        }

        .payment-accordion summary {
            font-weight: 500;
            padding: 14px 0;
            cursor: pointer;
            list-style: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Google Sans', sans-serif;
        }

        .payment-accordion summary::-webkit-details-marker {
            display: none;
        }

        .payment-accordion summary::after {
            content: '\f078';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--theme-on-surface-variant);
        }

        .payment-accordion[open] summary::after {
            transform: rotate(180deg);
        }

        .payment-accordion-content {
            padding-bottom: 16px;
            color: var(--theme-on-surface-variant);
            line-height: 1.6;
        }

        .payment-accordion-content ol {
            list-style-type: decimal;
            padding-left: 20px;
            font-size: 14px;
        }

        .payment-header {
            padding: 1rem;
        }

        .payment-header h2 {
            font-size: 1.125rem;
            font-weight: 500;
            font-family: 'Google Sans', sans-serif;
            color: #ffffff;
        }

        .countdown-timer {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .countdown-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .countdown-number {
            background-color: var(--google-red);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-weight: 600;
            font-size: 1.1rem;
            font-family: 'Google Sans', sans-serif;
            text-align: center;
        }
        
        /* Enhanced Details Modal (Bottom Sheet) */
        #detailsModal {
            align-items: flex-end;
        }

        .details-modal-content {
            background-color: var(--theme-surface);
            width: 100%;
            max-width: 100%;
            border-radius: 20px 20px 0 0;
            box-shadow: var(--shadow-3);
            text-align: left;
            transform: translateY(100%);
        }

        .details-modal-content.is-open {
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .details-modal-content.is-closing {
            animation: slideDown 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        @keyframes slideDown {
            from { transform: translateY(0); }
            to { transform: translateY(100%); }
        }

        .details-modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--theme-outline);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .details-modal-header h3 {
            font-size: 18px;
            font-weight: 500;
            color: var(--theme-on-surface);
            font-family: 'Google Sans', sans-serif;
        }

        .details-modal-close {
            font-size: 24px;
            font-weight: 400;
            color: var(--theme-on-surface-variant);
            cursor: pointer;
            background: none;
            border: none;
            padding: 8px;
            border-radius: 50%;
            transition: background-color 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .details-modal-close:hover {
            background-color: var(--theme-outline-variant);
        }

        .details-modal-body {
            padding: 20px 24px 32px 24px;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* Enhanced Mobile Responsiveness */
        @media (max-width: 768px) {
            .notif-box {
                left: 16px;
                right: 16px;
                top: 16px;
                transform: translateX(0);
                width: calc(100% - 32px);
                max-width: none;
            }

            @keyframes slideInAndOut {
                0% { opacity: 0; transform: translateY(-20px); }
                10% { opacity: 1; transform: translateY(0); }
                90% { opacity: 1; transform: translateY(0); }
                100% { opacity: 0; transform: translateY(-20px); }
            }

            .material-card {
                border-radius: 16px;
                margin: 0 4px;
            }

            .form-input {
                font-size: 16px;
            }
            .payment-header {
                padding: 0.875rem 1rem;
            }

            .payment-header h2 {
                font-size: 1.0625rem;
            }

            .countdown-timer {
                margin-top: 0.25rem;
            }

            .countdown-number {
                font-size: 0.875rem;
                padding: 0.15rem 0.4rem;
            }

            .countdown-item {
                font-size: 0.75rem;
            }
        }

        /* Enhanced Image Modal */
        .modal-image-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .modal-content-image {
            margin: auto;
            display: block;
            width: auto;
            max-width: 90%;
            max-height: 80vh;
            animation: zoomIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 8px;
        }

        .close-image-modal-button {
            margin-top: 20px;
            color: #ffffff;
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 24px;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 500;
            font-family: 'Google Sans', sans-serif;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .close-image-modal-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .modal-nav {
            cursor: pointer;
            position: absolute;
            top: 50%;
            width: 44px;
            height: 44px;
            margin-top: -22px;
            color: white;
            font-weight: bold;
            font-size: 24px;
            transition: 0.3s ease;
            border-radius: 50%;
            user-select: none;
            -webkit-user-select: none;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
        }

        .modal-nav.prev { left: 20px; }
        .modal-nav.next { right: 20px; }

        .modal-nav:hover {
            background-color: rgba(0, 0, 0, 0.7);
            transform: scale(1.1);
        }

        @keyframes zoomIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Enhanced Feature Icons */
        .feature-icon {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .feature-icon:hover {
            transform: scale(1.1);
        }

        /* Enhanced Security Badge */
        .security-badge {
            background: #e8f0fe;
            color: #1557b0;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        /* Enhanced Typography */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Google Sans', sans-serif;
            color: var(--theme-on-surface);
        }
        
        .text-google-blue { color: var(--google-blue); }
        .text-google-green { color: var(--google-green); }
        .bg-google-blue { background-color: var(--google-blue); }

        /* Smooth Scrolling */
        html { scroll-behavior: smooth; }

        /* Loading States */
        .spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <div id="payment-instruction-container">
        <!-- Konten akan di-generate oleh JavaScript -->
    </div>
    
    <div class="p-1 sm:p-4 lg:p-8">
        <div id="main-content-container">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-x-12 gap-y-8 max-w-7xl mx-auto">
                <!-- Kolom Kiri: Form & Pembayaran -->
                <div class="lg:col-span-1 material-card p-5 md:p-8">
                    <!-- Info Produk -->
                    <div id="product-info-form-top" class="mb-4"></div>

                    <!-- Accordion for Details -->
                    <div id="details-accordion-container" class="mb-4"></div>

                    <!-- Form -->
                    <form id="orderForm">
                        <h2 class="text-lg font-bold mb-3 google-sans">Lengkapi Data Pemesanan</h2>
                        <div class="space-y-4">
                            <div>
                                <input type="text" id="nama" name="nama" class="form-input" placeholder="Nama Lengkap *">
                            </div>
                            <div>
                                <input type="tel" id="whatsapp" name="whatsapp" class="form-input" placeholder="No. WhatsApp Aktif *">
                            </div>
                            <div>
                                <input type="email" id="email" name="email" class="form-input" placeholder="Alamat Email *">
                            </div>
                        </div>

                        <!-- Honeypot field for anti-spam -->
                        <input type="text" name="honeypot" style="display: none" tabindex="-1" autocomplete="off">

                        <!-- Bagian Pemilihan Perangkat Ajar -->
                        <div class="border-t border-gray-200 pt-4 mt-4">
                            <h2 class="text-lg font-bold mb-3 google-sans">Pilih Perangkat Ajar</h2>
                            <div id="order-items-container" class="space-y-4">
                                <!-- Order items will be injected here by JavaScript -->
                            </div>
                            <button type="button" id="add-order-btn" class="mt-4 text-sm text-google-blue font-medium flex items-center hover:bg-blue-50 p-2 rounded-lg">
                                <i class="fas fa-plus-circle mr-2"></i>Tambah Pilihan Lain (Jenjang/Kelas)
                            </button>
                        </div>

                        <!-- Rincian Pesanan (Updated) -->
                        <div id="order-summary-container" class="mt-4"></div>

                        <!-- Metode Pembayaran -->
                        <div id="payment-method-selection" class="mt-4"></div>

                        <button type="button" id="submit-btn" class="cta-button blue-button mt-4">
                            <i class="fas fa-download mr-2"></i>
                            Pesan & Unduh Sekarang
                        </button>
                    </form>
                </div>

                <!-- Kolom Kanan: Testimoni, FAQ -->
                <div class="lg:col-span-1 py-4 space-y-4">
                   <div id="testimonials-full"></div>
                   <div class="material-card p-5 md:p-6">
                       <div id="info-section-full"></div>
                   </div>
                </div>
            </div>
        </div>

        <footer id="footer" class="text-center mt-8 text-gray-500 text-sm">
            <p>Copyright Â© <span id="currentYear">2025</span> Merdeka Mengajar.</p>
        </footer>
    </div>

    <!-- Modal for Info/Confirmation -->
    <div id="infoModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle"></h3>
            <p id="modalMessage"></p>
            <button class="modal-ok-button" onclick="closeInfoModal()">OK</button>
        </div>
    </div>

    <!-- Modal untuk Zoom Gambar -->
    <div id="imageModal" class="modal">
        <span class="modal-nav prev" onclick="showPrevImage()">&#10094;</span>
        <span class="modal-nav next" onclick="showNextImage()">&#10095;</span>
        <div class="modal-image-wrapper">
            <img class="modal-content-image" id="modalImage">
            <button class="close-image-modal-button" onclick="closeImageModal()">Tutup</button>
        </div>
    </div>
        
    <!-- Modal for Transaction Details -->
    <div id="detailsModal" class="modal">
        <div class="details-modal-content" id="detailsModalContent">
            <!-- Content will be injected by JS -->
        </div>
    </div>

    <!-- Notification Popup -->
    <div class="notif-box" id="notifBox">
        <div class="notif-icon-wrapper"><i class="far fa-check-circle"></i></div>
        <div class="notif-content-area">
             <div class="notif-message">
                 <div><strong class="notif-name">Nama Acak</strong> baru saja memesan!</div>
             </div>
        </div>
    </div>

    <template id="order-item-template">
        <div class="p-4 border border-gray-200 rounded-lg space-y-3 relative order-item-card bg-white shadow-sm">
            <button type="button" class="absolute top-2 right-2 text-gray-400 hover:text-red-500 remove-order-item-btn h-8 w-8 flex items-center justify-center rounded-full hover:bg-red-50" title="Hapus Pilihan Ini">
                <i class="fas fa-times"></i>
            </button>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Jenjang</label>
                    <select name="jenjang" class="form-input jenjang-select">
                        <option value="">-- Pilih Jenjang --</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Kelas</label>
                    <select name="kelas" class="form-input kelas-select" disabled>
                        <option value="">-- Pilih Jenjang --</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Mata Pelajaran</label>
                    <select name="mapel" class="form-input mapel-select" disabled>
                        <option value="">-- Pilih Kelas --</option>
                    </select>
                </div>
            </div>
        </div>
    </template>

    <script>
    // --- VALIDATION LOGIC ---
    const operatorPrefixes = {
        'Telkomsel': ['0811', '0812', '0813', '0821', '0822', '0823', '0851', '0852', '0853'], 'by.U': ['0851'], 'Indosat Ooredoo': ['0814', '0815', '0816', '0855', '0856', '0857', '0858'], 'Tri (3)': ['0895', '0896', '0897', '0898', '0899'], 'XL Axiata': ['0817', '0818', '0819', '0859', '0877', '0878', '0879'], 'Live.On': ['0859'], 'Axis': ['0831', '0832', '0833', '0838'], 'Smartfren': ['0881', '0882', '0883', '0884', '0885', '0886', '0887', '0888', '0889']
    };
    const blacklistedNumbers = ['081234567890'];

    function isInvalidPattern(nomor) {
        if (blacklistedNumbers.includes(nomor)) return true;
        const numberPart = nomor.substring(2);
        if (/(\d)\1{4,}/.test(numberPart)) return true;
        for (let i = 0; i < numberPart.length - 4; i++) {
            const sub = numberPart.substring(i, i + 5);
            if ('0123456789'.includes(sub) || '9876543210'.includes(sub)) return true;
        }
        return new Set(numberPart.split('')).size < 4 || /(..)\1\1/.test(numberPart);
    }

    function getOperatorFromNumber(nomor) {
        const prefix = nomor.substring(0, 4);
        for (const operator in operatorPrefixes) { if (operatorPrefixes[operator].includes(prefix)) return operator; }
        return null;
    }

    function validatePhoneNumber(nomorHp) {
        const genericError = { isValid: false, message: 'Silahkan isi dengan nomor WhatsApp yang benar dan aktif.' };
        if (nomorHp.length < 10) return genericError;
        const operator = getOperatorFromNumber(nomorHp);
        if (!operator) return genericError;
        if (nomorHp.length > (operator === 'Tri (3)' ? 13 : 12)) return genericError;
        if (isInvalidPattern(nomorHp)) return genericError;
        return { isValid: true, message: 'Nomor valid.' };
    }

    document.addEventListener('DOMContentLoaded', function() {
        // --- ELEMENTS ---
        const elements = {
            mainContentContainer: document.getElementById('main-content-container'),
            paymentInstructionContainer: document.getElementById('payment-instruction-container'),
            footer: document.getElementById('footer'),
            currentYear: document.getElementById('currentYear'),
            productInfoFormTop: document.getElementById('product-info-form-top'),
            detailsAccordionContainer: document.getElementById('details-accordion-container'),
            paymentMethodSelection: document.getElementById('payment-method-selection'),
            orderSummaryContainer: document.getElementById('order-summary-container'),
            testimonialsFull: document.getElementById('testimonials-full'),
            infoSectionFull: document.getElementById('info-section-full'),
            orderItemsContainer: document.getElementById('order-items-container'),
            addOrderBtn: document.getElementById('add-order-btn'),
            orderItemTemplate: document.getElementById('order-item-template'),
            orderForm: document.getElementById('orderForm'),
            submitBtn: document.getElementById('submit-btn'),
            notifBox: document.getElementById('notifBox'),
            notifName: document.querySelector('#notifBox .notif-name'),
            detailsModal: document.getElementById('detailsModal'),
            detailsModalContent: document.getElementById('detailsModalContent'),
        };

        // --- CONFIGURATION ---
        const uniqueCode = Math.floor(Math.random() * (500 - 100 + 1)) + 100;
        let countdownInterval;
        let expiryTime;
        let currentOrderDetails = {};
        let cart = []; // Holds all the selected order items

        const pricing = {
            "SD": 50000,
            "SMP": 75000,
            "SMA": 100000
        };

        const packages = {
            perangkatAjar: {
                id: 'perangkatAjar',
                name: "Perangkat Ajar Lengkap",
                title: "Perangkat Ajar Deep Learning 2025/2026",
                logoIcon: 'fa-solid fa-book-open-reader',
                description: "Solusi lengkap administrasi mengajar Kurikulum Nasional untuk jenjang SD, SMP, & SMA.",
                kelengkapan: [
                    "Modul Ajar Terintegrasi Deep Learning (2 Semester)",
                    "Capaian Pembelajaran (CP)",
                    "Alur Tujuan Pembelajaran (ATP)",
                    "Lembar Kerja Peserta Didik (LKPD)",
                    "Asesmen (Diagnostik, Formatif, Sumatif)",
                    "Program Tahunan (PROTA)",
                    "Program Semester (PROMES)",
                    "Alokasi Waktu Pembelajaran",
                    "Administrasi Wali Kelas Lengkap",
                    "Daftar Nilai & Jurnal Harian",
                    "Analisis Penilaian Kurikulum Nasional",
                    "Bonus: Media Ajar & Materi Presentasi"
                ],
                 mapel: [
                    "Pendidikan Pancasila", "Bahasa Indonesia", "Bahasa Inggris", "Matematika",
                    "Informatika", "PJOK", "IPS (Antropologi)", "IPS (Ekonomi)", "IPS (Geografi)",
                    "IPS (Sosiologi)", "IPA (Biologi)", "IPA (Fisika)", "IPA (Kimia)",
                    "Seni Budaya", "Prakarya", "PAI Islam"
                ],
                testimonials: [
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0008.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0009.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0010.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0011.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0012.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0013.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0014.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0015.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0016.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0017.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0018.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0019.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0020.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0021.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0022.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0023.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0024.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0025.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0026.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0027.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0028.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0029.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0030.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0031.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0032.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0033.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0034.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0035.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0036.jpg",
                    "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0037.jpg"
                ]
            }
        };

        let currentPackageId = 'perangkatAjar';

        const fullSubjectList = ["Pendidikan Pancasila", "Bahasa Indonesia", "Bahasa Inggris", "Matematika", "Informatika", "PJOK", "Sejarah", "Seni Budaya", "Prakarya", "PAI Islam", "Sosiologi", "Ekonomi", "Geografi", "Biologi", "Kimia", "Fisika", "IPAS", "IPS", "IPA", "Tematik"];

        const educationalData = {
            "SD": {
                "Kelas 1": fullSubjectList,
                "Kelas 2": fullSubjectList,
                "Kelas 3": fullSubjectList,
                "Kelas 4": fullSubjectList,
                "Kelas 5": fullSubjectList,
                "Kelas 6": fullSubjectList
            },
            "SMP": {
                "Kelas 7": fullSubjectList,
                "Kelas 8": fullSubjectList,
                "Kelas 9": fullSubjectList
            },
            "SMA": {
                "Kelas 10": fullSubjectList,
                "Kelas 11": fullSubjectList,
                "Kelas 12": fullSubjectList
            }
        };

        const paymentAccounts = {
            qris: { displayName: 'QRIS', accountHolder: 'Epay', number: '00020101021126610016ID.CO.SHOPEE.WWW01189360091800223157700208223157700303UMI51440014ID.CO.QRIS.WWW0215ID10254270621910303UMI5204481453033605802ID5904Epay6013JAKARTA PUSAT61051061062070703A0163042F15', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Logo_QRIS.svg/163px-Logo_QRIS.svg.png', type: 'qris' },
            cimb: { displayName: 'Cimb Niaga', accountHolder: 'Octo Pay - 6289510639366', number: '6289510639366', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/CIMB_Niaga_logo.svg/330px-CIMB_Niaga_logo.svg.png', type: 'va' },
            bca_va: { displayName: 'BCA Virtual Account', accountHolder: 'Epayment', number: '39358089510639366', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Bank_Central_Asia.svg/330px-Bank_Central_Asia.svg.png', type: 'va' },
            gopay: { displayName: 'Gopay', accountHolder: 'Gopay 6289510639366', number: '089510639366', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/86/Gopay_logo.svg/320px-Gopay_logo.svg.png', type: 'ewallet' },
            dana: { displayName: 'DANA', accountHolder: 'DNID089510639366', number: '089510639366', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Logo_dana_blue.svg/330px-Logo_dana_blue.svg.png', type: 'ewallet' },
            ovo: { displayName: 'OVO', accountHolder: 'OVO Epayment', number: '089510639366', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/eb/Logo_ovo_purple.svg/330px-Logo_ovo_purple.svg.png', type: 'ewallet' }
        };

        // --- TEMPLATE FUNCTIONS ---
        const getProductInfoHTML = (pkg) => {
            const logoHtml = `<div class="flex justify-center text-5xl text-google-blue"><i class="${pkg.logoIcon}"></i></div>`;
            return `
            <div class="product-info-card">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                    <div class="text-center mb-2 md:mb-0 flex-grow">
                        ${logoHtml}
                        <h1 class="text-2xl font-bold mt-3 google-sans">${pkg.title}</h1>
                        <p class="text-md text-gray-600 mt-1">${pkg.description}</p>
                    </div>
                    <div class="text-center md:text-right mt-2 md:mt-0 md:pl-6">
                        <div class="text-3xl font-bold text-google-blue google-sans">Mulai dari ${formatCurrency(pricing.SD)}</div>
                        <p class="text-sm text-gray-500 mt-1">Per Mata Pelajaran</p>
                        <div class="mt-2">
                            <span class="inline-block bg-yellow-100 text-yellow-800 text-xs px-3 py-1 rounded-full">
                                <i class="fas fa-tag mr-1"></i>Promo Tahun Ajaran Baru
                            </span>
                        </div>
                    </div>
                </div>
            </div>`;
        }

        const getDetailsAccordionHTML = (pkg) => {
            const kelengkapanHTML = `<ul class="space-y-3">${pkg.kelengkapan.map((f, index) => `<li class="flex items-start"><i class="fas fa-check-circle text-green-500 mt-1 mr-3 text-lg feature-icon"></i><span class="text-theme-on-surface-variant text-sm leading-relaxed">${f}</span></li>`).join('')}</ul>`;
            const mapelHTML = `<div class="grid grid-cols-2 gap-x-4 gap-y-2">${pkg.mapel.map(m => `<div class="flex items-center text-sm"><i class="fas fa-book text-blue-400 mr-2"></i><span>${m}</span></div>`).join('')}</div>`;

            return `
                <details class="faq-item">
                    <summary>Kelengkapan Perangkat Ajar</summary>
                    <div class="faq-content">${kelengkapanHTML}</div>
                </details>
                <details class="faq-item">
                    <summary>Mata Pelajaran Tersedia</summary>
                    <div class="faq-content">${mapelHTML}</div>
                </details>
            `;
        }

        const getPaymentMethodsHTML = (accounts) => {
            let html = `<h2 class="text-lg font-bold mb-4 text-gray-800 google-sans">Metode Pembayaran</h2><div class="payment-group">`;
            Object.entries(accounts).forEach(([key, account], index) => {
                html += `
                    <div class="${index === 0 ? '' : 'border-t border-gray-200'}">
                        <input type="radio" id="${key}" name="payment-method" value="${key}" class="payment-radio" ${index === 0 ? 'checked' : ''}>
                        <label for="${key}" class="payment-label">
                            <div class="form-payment-logo-container">
                                <img src="${account.logo}" alt="Logo ${account.displayName}" class="payment-logo">
                            </div>
                            <span class="font-medium text-gray-800 flex-grow google-sans text-sm">${account.displayName}</span>
                            <span class="custom-radio-button"><span class="dot"></span></span>
                        </label>
                    </div>`;
            });
            html += `</div><div class="bg-gray-50 p-3 mt-4 rounded-xl text-center text-xs text-gray-600"><i class="fas fa-shield-alt text-green-600 mr-2"></i>Pembayaran aman dan terenkripsi.</div>`;
            return html;
        };

        const getTestimonialsHTML = (pkg) => {
            const images = pkg.testimonials;
            const singleTrackHTML = images.map((url, index) => `
                <div class="testimonial-slide">
                    <img src="${url}" alt="Testimoni Guru ${index + 1}" class="testimonial-image" onclick="openImageModal(event, ${index})">
                </div>`).join('');

            return `
            <div class="material-card p-3 md:p-4 rounded-2xl">
                <h2 class="text-xl font-bold text-center mb-2 google-sans">Testimoni Guru & Pendidik</h2>
                <p class="text-center text-gray-500 text-xs mb-4">Ribuan guru telah merasakan manfaatnya</p>
                <div class="testimonial-carousel-container" id="carousel-wrapper">
                    <div class="testimonial-track">${singleTrackHTML}</div>
                    <div class="testimonial-track" aria-hidden="true">${singleTrackHTML}</div>
                </div>
            </div>`;
        }

        const getInfoSectionHTML = () => {
             return `
                <h3 class="text-2xl font-bold mb-4 text-center google-sans">Tanya Jawab (FAQ)</h3>
                <div class="space-y-0">
                    <details class="faq-item">
                        <summary>Apa itu Perangkat Ajar Deep Learning?</summary>
                        <div class="faq-content">Ini adalah kumpulan lengkap dokumen administrasi mengajar yang siap pakai, dirancang untuk membantu guru dalam menerapkan Kurikulum Nasional secara efektif dan efisien.</div>
                    </details>
                    <details class="faq-item">
                        <summary>Apakah sudah sesuai Kurikulum Nasional?</summary>
                        <div class="faq-content">Ya, 100%. Seluruh komponen, mulai dari CP, TP, ATP, hingga Asesmen disusun berdasarkan panduan terbaru Kurikulum Nasional dari Kemendikbudristek.</div>
                    </details>
                    <details class="faq-item">
                        <summary>Untuk jenjang apa saja perangkat ini?</summary>
                        <div class="faq-content">Tersedia lengkap untuk semua jenjang, mulai dari SD, SMP, hingga SMA/SMK. Anda bisa memilih jenjang dan mata pelajaran saat melakukan pemesanan.</div>
                    </details>
                    <details class="faq-item">
                        <summary>Bagaimana saya akan menerima filenya?</summary>
                        <div class="faq-content">Setelah pembayaran terkonfirmasi, link unduhan Google Drive akan secara otomatis dikirimkan ke nomor WhatsApp yang Anda daftarkan. Pastikan nomor WhatsApp Anda aktif.</div>
                    </details>
                    <details class="faq-item">
                        <summary>Apa format filenya dan apakah bisa diedit?</summary>
                        <div class="faq-content">File tersedia dalam format Microsoft Word (.docx) dan PDF. Format Word disediakan agar Anda dapat dengan mudah mengedit dan menyesuaikannya dengan kebutuhan di sekolah Anda.</div>
                    </details>
                    <details class="faq-item">
                        <summary>Berapa lama proses pengirimannya?</summary>
                        <div class="faq-content">Prosesnya instan. Link akan dikirimkan ke email Anda dalam 1-5 menit setelah Anda melakukan konfirmasi pembayaran.</div>
                    </details>
                </div>
            `;
        };

        // --- FUNCTIONS ---
        function formatCurrency(value) {
            return `Rp${value.toLocaleString('id-ID', { minimumFractionDigits: 0 })}`;
        }

        function getIndonesianTimezone() {
            const offset = new Date().getTimezoneOffset() / -60;
            if (offset === 7) return 'WIB';
            if (offset === 8) return 'WITA';
            if (offset === 9) return 'WIT';
            return `GMT${offset > 0 ? '+' : '-'}${String(Math.abs(Math.floor(offset))).padStart(2, '0')}:00`;
        }

        function updateOrderSummary() {
            let subtotal = 0;
            let summaryHTML = '';
            
            const validCartItems = cart.filter(item => item.jenjang && item.kelas && item.mapel);

            validCartItems.forEach(item => {
                const pricePerMapel = pricing[item.jenjang] || 0;
                subtotal += pricePerMapel;
            });
            
            const totalPrice = subtotal + uniqueCode;

            if (validCartItems.length > 0) {
                summaryHTML = `
                    <div class="border-t border-gray-200 pt-4">
                        <h3 class="text-lg font-bold mb-4 google-sans">Rincian Pesanan</h3>
                        <div class="space-y-3 text-gray-600">
                `;

                validCartItems.forEach((item, index) => {
                    const pricePerMapel = pricing[item.jenjang] || 0;
                    summaryHTML += `
                         <div class="flex justify-between items-center">
                            <div class="text-sm">
                                ${item.jenjang} - ${item.kelas}
                                <p class="text-xs text-gray-500">${item.mapel}</p>
                            </div>
                             <span class="font-semibold text-gray-800 text-md">${formatCurrency(pricePerMapel)}</span>
                         </div>
                    `;
                });

                summaryHTML += `
                     <div class="flex justify-between mt-3">
                         <span class="text-sm">Kode Unik</span>
                         <span class="font-medium text-gray-800 text-sm">${formatCurrency(uniqueCode)}</span>
                     </div>
                     <hr class="my-2 border-gray-200">
                     <div class="flex justify-between font-bold text-lg text-gray-800 google-sans">
                         <span>Total</span>
                         <span class="text-google-blue">${formatCurrency(totalPrice)}</span>
                     </div>
                    </div>
                 </div>
                `;
            }

            elements.orderSummaryContainer.innerHTML = summaryHTML;
        }

        function updateCart() {
            cart = [];
            const orderItemCards = elements.orderItemsContainer.querySelectorAll('.order-item-card');
            orderItemCards.forEach(card => {
                const jenjangSelect = card.querySelector('.jenjang-select');
                const kelasSelect = card.querySelector('.kelas-select');
                const mapelSelect = card.querySelector('.mapel-select');

                cart.push({
                    id: card.dataset.id,
                    jenjang: jenjangSelect.value,
                    kelas: kelasSelect.value,
                    mapel: mapelSelect.value
                });
            });
            updateOrderSummary();
        }

        function handleJenjangChange(event) {
            const jenjang = event.target.value;
            const orderItemCard = event.target.closest('.order-item-card');
            const kelasSelect = orderItemCard.querySelector('.kelas-select');
            const mapelSelect = orderItemCard.querySelector('.mapel-select');

            kelasSelect.innerHTML = '<option value="">-- Pilih Kelas --</option>';
            mapelSelect.innerHTML = '<option value="">-- Pilih Kelas --</option>';
            kelasSelect.disabled = true;
            mapelSelect.disabled = true;

            if (jenjang && educationalData[jenjang]) {
                Object.keys(educationalData[jenjang]).forEach(kelas => {
                    const option = document.createElement('option');
                    option.value = kelas;
                    option.textContent = kelas;
                    kelasSelect.appendChild(option);
                });
                kelasSelect.disabled = false;
            }
            updateCart();
        }

        function handleKelasChange(event) {
            const kelas = event.target.value;
            const orderItemCard = event.target.closest('.order-item-card');
            const jenjang = orderItemCard.querySelector('.jenjang-select').value;
            const mapelSelect = orderItemCard.querySelector('.mapel-select');

            mapelSelect.innerHTML = '<option value="">-- Pilih Mata Pelajaran --</option>';
            mapelSelect.disabled = true;

            if (jenjang && kelas && educationalData[jenjang][kelas]) {
                const mapels = educationalData[jenjang][kelas];
                mapels.forEach(mapel => {
                    const option = document.createElement('option');
                    option.value = mapel;
                    option.textContent = mapel;
                    mapelSelect.appendChild(option);
                });
                mapelSelect.disabled = false;
            }
            updateCart();
        }

        let orderItemIdCounter = 0;
        function addOrderItem() {
            const templateClone = elements.orderItemTemplate.content.cloneNode(true);
            const orderItemCard = templateClone.querySelector('.order-item-card');
            
            const uniqueId = `item-${orderItemIdCounter++}`;
            orderItemCard.dataset.id = uniqueId;

            const jenjangSelect = templateClone.querySelector('.jenjang-select');
            Object.keys(educationalData).forEach(jenjang => {
                jenjangSelect.innerHTML += `<option value="${jenjang}">${jenjang}</option>`;
            });

            jenjangSelect.addEventListener('change', handleJenjangChange);
            templateClone.querySelector('.kelas-select').addEventListener('change', handleKelasChange);
            templateClone.querySelector('.mapel-select').addEventListener('change', updateCart); // Update cart on mapel change
            templateClone.querySelector('.remove-order-item-btn').addEventListener('click', (e) => {
                 e.currentTarget.closest('.order-item-card').remove();
                 updateCart();
            });

            elements.orderItemsContainer.appendChild(templateClone);
            updateCart();
        }

        function generateWaLink(formData, orderDetails, totalPrice, paymentMethodName, paymentId) {
             const pesanWA = `Halo, saya ingin konfirmasi pembayaran untuk pesanan:\n\n` +
                          `*ID Pembayaran:* ${paymentId}\n` +
                          `*Produk:* Perangkat Ajar Lengkap\n` +
                          `*Rincian Pesanan:*${orderDetails}\n\n`+
                          `*Metode Pembayaran:* ${paymentMethodName}\n` +
                          `*Nama:* ${formData.get('nama')}\n` +
                          `*No. WhatsApp:* ${formData.get('whatsapp')}\n` +
                          `*Email Pengiriman:* ${formData.get('email')}\n` +
                          `*Total Transfer:* ${formatCurrency(totalPrice)}\n\n` +
                          `Saya sudah melakukan transfer. Mohon untuk segera diproses. Terima kasih.`;
            return `https://wa.me/6285602152097?text=${encodeURIComponent(pesanWA)}`;
        }

        function showPaymentInstructions(formData, orderDetails, totalPrice, paymentAccount, paymentId, paymentMethodKey) {
            window.scrollTo(0, 0);
            
            const pkg = packages[currentPackageId];
            currentOrderDetails = { pkg, totalPrice, paymentId, nama: formData.get('nama'), whatsapp: formData.get('whatsapp'), orderDetails: orderDetails };
            elements.mainContentContainer.parentElement.style.display = 'none';
            elements.footer.style.display = 'none';

            const waLink = generateWaLink(formData, pkg, totalPrice, paymentAccount.displayName, paymentId);
            expiryTime = new Date(new Date().getTime() + 24 * 60 * 60 * 1000);
            const paymentDeadlineFormatted = `${expiryTime.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })} pukul ${expiryTime.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }).replace(/\./g, ':')} (${getIndonesianTimezone()})`;

            let paymentDetailsBlock = '';
            if (paymentMethodKey === 'qris') {
                paymentDetailsBlock = `
                    <div class="text-center">
                        <div id="qrcodeContainer" class="bg-white p-3 rounded-xl border-2 border-gray-200 w-full max-w-[250px] h-auto mx-auto my-4 material-card-elevated">
                            <div id="qrcode" class="flex justify-center items-center"></div>
                        </div>
                        <button id="downloadQrisButton" class="cta-button blue-button max-w-xs mx-auto">
                            <i class="fas fa-download mr-2"></i>Unduh QRIS
                        </button>
                        <p class="text-center text-xs text-gray-600 mt-3">Pindai QR Code di atas menggunakan aplikasi perbankan atau e-wallet Anda.</p>
                    </div>`;
            } else {
                 paymentDetailsBlock = `
                    <div class="mt-4">
                        <p class="text-xs text-gray-500 mb-1">Nomor Virtual Account</p>
                        <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
                            <p class="text-xl font-bold text-gray-800 tracking-wider google-sans">${paymentAccount.number}</p>
                            <button onclick="copyToClipboard('${paymentAccount.number}', 'Nomor Virtual Account')" class="copy-button-text"><i class="far fa-copy mr-1"></i>Salin</button>
                        </div>
                    </div>`;
            }

            let instructionAccordionHTML = `
                <details class="payment-accordion" open><summary>Instruksi Umum</summary><div class="payment-accordion-content"><ol class="space-y-2">
                    <li>Buka aplikasi perbankan atau e-wallet Anda.</li>
                    <li>Pilih menu transfer atau pembayaran.</li>
                    <li>Masukkan detail pembayaran yang tertera di atas.</li>
                    <li>Pastikan nominal transfer sesuai dengan total pembayaran hingga digit terakhir.</li>
                    <li>Selesaikan transaksi dan simpan bukti pembayaran Anda.</li>
                </ol></div></details>`;
            
            const paymentViewHTML = `
                <div class="payment-header">
                    <h2 class="google-sans">Selesaikan Pembayaran</h2>
                    <div class="countdown-timer" id="countdown-timer-display"></div>
                </div>
                <div class="max-w-lg mx-auto">
                    <div class="p-2 sm:p-4">
                        <div class="payment-card">
                            <h3 class="font-bold text-lg google-sans mb-1">Ringkasan Transaksi</h3>
                            <div class="flex justify-between items-center mt-2 text-xs text-gray-600">
                                <span>Nomor Invoice: <strong>${paymentId}</strong></span>
                                <a href="#" onclick="showDetailsModal(event)" class="font-semibold text-google-blue">Lihat detail</a>
                            </div>
                            <hr class="my-4">
                            <p class="text-xs text-gray-600 mb-1">Total Pembayaran</p>
                            <div class="flex items-center justify-between">
                                <p class="text-2xl font-bold text-google-blue google-sans">${formatCurrency(totalPrice)}</p>
                                <button onclick="copyToClipboard('${totalPrice}', 'Total Pembayaran')" class="copy-button-text"><i class="far fa-copy mr-1"></i>Salin</button>
                            </div>
                        </div>
                        <div class="payment-card">
                            <h3 class="font-bold text-lg google-sans mb-3">Silahkan Bayar ke</h3>
                            <div class="flex justify-between items-start mt-3">
                                <div>
                                    <p class="text-sm text-gray-500">${paymentAccount.displayName}</p>
                                    <p class="font-semibold text-gray-800 text-md">${paymentAccount.accountHolder}</p>
                                </div>
                                <div class="form-payment-logo-container">
                                    <img src="${paymentAccount.logo}" alt="Logo ${paymentAccount.displayName}" class="payment-logo">
                                </div>
                            </div>
                            ${paymentDetailsBlock}
                            <div class="mt-6">
                                <p class="text-xs text-gray-500 mb-1">Bayar Sebelum</p>
                                <p class="font-semibold text-gray-800 text-sm">${paymentDeadlineFormatted}</p>
                            </div>
                            <a href="${waLink}" target="_blank" class="block mt-6">
                               <button class="confirm-button-outlined"><i class="fab fa-whatsapp mr-2"></i>Konfirmasi Pembayaran</button>
                            </a>
                        </div>
                        <div class="payment-card">
                            <h3 class="font-bold text-lg google-sans mb-2">Cara Membayar</h3>
                            <div class="mt-2">${instructionAccordionHTML}</div>
                        </div>
                    </div>
                </div>`;
            elements.paymentInstructionContainer.innerHTML = paymentViewHTML;
            startCountdown();

            if (paymentMethodKey === 'qris') {
                setTimeout(() => {
                    const qrcodeContainer = document.getElementById('qrcode');
                    if (qrcodeContainer) {
                        try {
                            const qrisDinamis = createDynamicQrisString(paymentAccount.number, { nominal: totalPrice });
                            qrcodeContainer.innerHTML = '';
                            QRCode.toCanvas(qrisDinamis, { width: 250, margin: 1, errorCorrectionLevel: 'H' }, (err, canvas) => {
                                if (err) throw err;
                                canvas.style.width = "100%"; canvas.style.height = "auto"; canvas.style.borderRadius = "8px";
                                qrcodeContainer.appendChild(canvas);
                                document.getElementById('downloadQrisButton').addEventListener('click', () => {
                                    const link = document.createElement('a');
                                    link.download = `QRIS-${paymentId}.png`;
                                    link.href = canvas.toDataURL("image/png");
                                    link.click();
                                });
                            });
                        } catch (e) {
                            qrcodeContainer.innerHTML = `<p class="text-red-500 text-sm">Gagal membuat QR Code. Silakan hubungi support.</p>`;
                        }
                    }
                }, 100);
            }
        }

        async function handleFormSubmit() {
            const formData = new FormData(elements.orderForm);
            const nama = formData.get('nama').trim();
            const whatsapp = formData.get('whatsapp').trim();
            const email = formData.get('email').trim();
            const paymentMethodKey = formData.get('payment-method');

            if (!nama || !whatsapp || !email || !paymentMethodKey) {
                showInfoModal('Data Belum Lengkap', 'Mohon lengkapi semua data yang diperlukan (Nama, WhatsApp, Email, dan Metode Pembayaran).');
                return;
            }
            const phoneValidationResult = validatePhoneNumber(whatsapp);
            if (!phoneValidationResult.isValid) {
                showInfoModal('Nomor WhatsApp Tidak Valid', phoneValidationResult.message);
                return;
            }
            const validCartItems = cart.filter(item => item.jenjang && item.kelas && item.mapel);
            if (validCartItems.length === 0) {
                showInfoModal('Pesanan Belum Lengkap', 'Mohon pilih jenjang, kelas, dan mata pelajaran untuk melanjutkan.');
                return;
            }

            elements.submitBtn.disabled = true;
            elements.submitBtn.innerHTML = '<i class="fas fa-spinner spinner mr-2"></i> Memproses...';

            const subtotal = validCartItems.reduce((acc, item) => {
                const pricePerMapel = pricing[item.jenjang] || 0;
                return acc + pricePerMapel;
            }, 0);
            const totalPrice = subtotal + uniqueCode;
            
            const orderDetailsString = validCartItems.map(item => {
                return `\n- ${item.jenjang} - ${item.kelas} (${item.mapel})`;
            }).join('');

            const paymentAccount = paymentAccounts[paymentMethodKey];
            const now = new Date();
            const paymentId = `INV-PA-${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}${String(now.getHours()).padStart(2, '0')}${String(totalPrice).slice(-3)}`;
            
            let submissionSuccess = false;
            try {
                const waLink = generateWaLink(formData, orderDetailsString, totalPrice, paymentAccount.displayName, paymentId);
                let followUpMessage = `Halo kak ${nama},\n\nTerima kasih telah memesan *Perangkat Ajar Lengkap*.\n\nBerikut rincian pembayaran Anda:\n- Invoice: ${paymentId}\n- Total: *${formatCurrency(totalPrice)}*\n\n`;
                followUpMessage += `*Rincian Pesanan:*\n${orderDetailsString}\n\n`;
                followUpMessage += paymentMethodKey === 'qris' 
                    ? `*- Metode:* ${paymentAccount.displayName}\nSilakan pindai QRIS di halaman pembayaran.\n` 
                    : `*- Metode:* ${paymentAccount.displayName}\n*- Nomor:* ${paymentAccount.number}` + (paymentAccount.accountHolder ? `\n*- Atas Nama:* ${paymentAccount.accountHolder}` : ``) + `\n`;
                followUpMessage += `\n*Penting:* Mohon transfer sesuai total di atas (termasuk kode unik) agar pesanan Anda diproses otomatis.\n\nSetelah transfer, klik tombol konfirmasi di halaman pembayaran atau melalui link berikut: ${waLink}\n\nTerima kasih`;
                
                const formattedWhatsapp = whatsapp.startsWith('0') ? '62' + whatsapp.substring(1) : whatsapp;
                const followUpLink = `https://wa.me/${formattedWhatsapp}?text=${encodeURIComponent(followUpMessage)}`;

                const response = await fetch('https://api.staticforms.xyz/submit', {
                    method: 'POST',
                    body: JSON.stringify({
                        apiKey: 'sf_195b5fj92dge8l9b391mng1g',
                        replyTo: email,
                        honeypot: formData.get('honeypot'),
                        name: nama, email: email, whatsapp: whatsapp,
                        '$Nomor Invoice': paymentId, 
                        '$Produk': 'Perangkat Ajar Lengkap', 
                        '$Rincian Pesanan': orderDetailsString,
                        '$Metode Pembayaran': paymentAccount.displayName, 
                        '$Total Transfer': formatCurrency(totalPrice), 
                        '$Link Follow Up WA': followUpLink
                    }),
                    headers: { 'Content-Type': 'application/json' }
                });
                if (response.ok) submissionSuccess = true;
            } catch (e) { console.error("Form submission error:", e); }

            elements.submitBtn.disabled = false;
            elements.submitBtn.innerHTML = '<i class="fas fa-download mr-2"></i> Pesan & Unduh Sekarang';

            if (submissionSuccess) {
                showPaymentInstructions(formData, orderDetailsString, totalPrice, paymentAccount, paymentId, paymentMethodKey);
            } else {
                showInfoModal('Pengiriman Gagal', 'Terjadi kesalahan saat mengirim data. Silakan coba lagi.');
            }
        }

        function startCountdown() {
            const countdownElement = document.getElementById('countdown-timer-display');
            if (!countdownElement || !expiryTime) return;
            countdownInterval = setInterval(() => {
                const distance = expiryTime - new Date().getTime();
                if (distance < 0) {
                    clearInterval(countdownInterval);
                    countdownElement.innerHTML = "Waktu Habis";
                    return;
                }
                const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((distance % (1000 * 60)) / 1000);
                countdownElement.innerHTML = `
                    <div class="countdown-item"><span class="countdown-number">${String(h).padStart(2, '0')}</span> Jam</div>
                    <div class="countdown-item"><span class="countdown-number">${String(m).padStart(2, '0')}</span> Menit</div>
                    <div class="countdown-item"><span class="countdown-number">${String(s).padStart(2, '0')}</span> Detik</div>`;
            }, 1000);
        }

        // --- NOTIFICATION ---
        const FIRST_NAMES = [ "Budi Santoso", "Ayu", "Rahmat", "Citra Dewi Kusuma", "Bayu Pratama", "Lina", "Wulan", "Adi", "Farhan Syahputra", "Hendra Wijaya", "Nana Puspita Dewi", "Joko", "Mega Sari", "Gilang Pramana Putra", "Sari", "Dedi", "Eka Suryani", "Teguh", "Putri Lestari Ayu", "Andi", "Bagus Wijaya", "Ilham Saputra Nugraha", "Rizal", "Mira Astuti", "Puspita", "Hari", "Tri Saputra", "Cahya Pratama", "Surya Darmawan Putra", "Wahyu Ramadhan", "Agus", "Indra Permana", "Linda", "Fajar Mahendra Saputra", "Yusuf", "Pramono Adi Nugroho", "Sinta Dewi", "Bima Pratama", "Dian", "Hasan Basri", "Nurul Aini", "Arif Budiman", "Feri", "Lukman Hakim", "Rangga", "Rini Anggraini Putri", "Tono", "Hadi Prasetyo", "Elisa Purnama", "Anisa Rahma", "Gunawan", "Melati", "Bagus Prasetyo Ramadhan", "Septi Amelia", "Cindy Amelia", "Windi Saputri", "Galih Pratama", "Evi", "Putra", "Slamet Riyadi", "Latif Hidayat", "Gita Puspita", "Darmawan", "Maya", "Erik Saputra Pratama", "Jani", "Jefri Maulana", "Bella Sari", "Maulana", "Novi Andriana Lestari", "Fajar Nugroho", "Taufik Hidayat", "Prasetyo", "Samsul", "Agung", "Endang", "Indah", "Hana Pertiwi", "Mirna", "Yulia", "Panca", "Niken", "Rio", "Adi Putra Ramadhan", "Ganda", "Wahida", "Robby Saputra", "Halim", "Firman Saputra", "Berlian Putra", "Ari", "Joko Setiawan", "Mustika", "Bahar", "Mega", "Erlangga", "Sofyan", "Doni", "Fatimah", "Dian Purnama Sari", "Rama", "Imam Saputra", "Johan", "Gusman", "Lintang", "Nabila", "Beni", "Purnama", "Murni", "Malik", "Nurlan", "Doni Saputra", "Lastri", "Berlinda", "Rasyid", "Tari", "Nia", "Tirta", "Juli Andriani", "Lutfi", "Suci", "Arman", "Yani", "Citra Ayu", "Harto", "Rangga Pratama", "Febrina", "Indra Gunawan Saputra", "Tomi", "Sutrisno", "Risma", "Jihan Ayu Pratiwi", "Lestari", "Dewi Kusuma", "Fahmi", "Rifki", "Wira", "Putra Wijaya", "Beni Setiawan", "Asep", "Gerry", "Prasetia", "Euis", "Latif", "Pajar", "Rahmat Hidayat", "Rudi", "Tika", "Danu", "Hesti", "Syahrul", "Anwar", "Miranti", "Nuraini", "Nurman", "Eman Kurnia", "Nirmala", "Hari Susanto", "Taufan", "Tono Prabowo", "Bayu Saputra Nugroho", "Darma", "Nurlaila", "Hafid", "Mustofa", "Elok", "Gunarto", "Novi", "Lasman", "Jamaludin", "Andi Wijaya Putra", "Herman", "Mila", "Wibowo", "Prayitno", "Adi Saputra", "Jamal", "Irfan", "Iskandar", "Yudha", "Lutris", "Samsul Hidayat", "Heru", "Bagus", "Rudianto", "Nanda Putri", "Laila Rahma", "Frans", "Hilda", "Cahya", "Rudi Pratama", "Setiawan", "Rangga Saputra", "Puspa", "Doni Prasetyo", "Nurul", "Febri", "Mega Sari Lestari", "Suyatno", "Tomiadi", "Fikri", "Lani", "Intan", "Johan Saputra", "Iwan", "Berliano", "Ilham", "Teddy", "Lani Puspita", "Eka Putri Andayani", "Hani", "Adi Wijaya", "Adit", "Dicky", "Gopal", "Pramono", "Gunadi", "Gilang", "Joko Prayitno Adi", "Mira", "Puspita Sari", "Maulana Hakim", "Putri Ayu Lestari", "Malik Prasetyo", "Toriq", "Joni", "Gilang Pratama", "Bagus Wijaya Putra", "Berlian", "Wandi", "Nurman Saputra", "Fajarudin", "Lutfi Pratama", "Citra", "Nanda", "Laras", "Tuti", "Yani Pratiwi", "Gusman Saputra", "Rangga Putra", "Prasetiawan", "Ismail", "Heri", "Adi Nugroho", "Putri", "Prasetyo Adi", "Dona", "Gani", "Jihan", "Puspita Dewi", "Rizal Maulana", "Mahendra", "Ayu Pratiwi", "Rangga Setiawan", "Lina Sari", "Fani", "Adi Wijaya Putra", "Sari Melati", "Andri", "Bima", "Teguh Santoso Adi", "Fajar", "Wulan Dewi", "Rama Pratama", "Nana", "Farhan", "Dion", "Melati Pertiwi", "Adi Putra", "Joko Santoso", "Doni Setiawan", "Lintang Pertiwi", "Septi", "Gopal Pramana", "Tomi Pratama", "Rio Nugraha", "Cindy", "Hafid Saputra", "Hendra", "Niken Lestari", "Rangga Nugroho", "Putri Ayu", "Sofyan Hidayat", "Robby", "Bima Saputra", "Indra", "Adi Kurniawan", "Nanda Saputra", "Gilang Saputra", "Wahyu", "Puspita Ayu", "Rudi Hartono", "Wulan Dewi Pertiwi", "Ayu Pratiwi Lestari", "Tono Adi", "Dedi Kurniawan", "Prasetyo Ramadhan", "Adi Setiawan", "Mira Lestari", "Farhan Syahputra Adi", "Nurul Hidayah", "Sari Anggraini", "Bayu", "Eman", "Putra Adi Nugroho", "Lestari Ayu", "Bambang", "Rangga Hidayat", "Mega Putri", "Adi Nugraha", "Anisa", "Siska", "Wandi Putra", "Fajar Saputra", "Gunawan Pratama", "Heri Setiawan", "Arif", "Ilham Nugroho", "Bagus Pratama", "Erlangga Putra", "Rian", "Pandu", "Tari Ayu", "Hendro", "Risma Ayu", "Adi Pratama", "Septi Ayu", "Bambang Santoso", "Lukman", "Gani Saputra", "Hasan", "Feri Kurniawan", "Tirta", "Bambang Prasetyo", "Pajar Saputra", "Arman Putra", "Murni Ayu", "Hafiz", "Euis Sari", "Bayu Nugroho", "Tomi Saputra", "Gerry Pratama", "Arif Prasetyo", "Johan Putra", "Hafid Nugraha", "Nabila Pertiwi", "Latif Saputra", "Ari Saputra", "Rio Saputra", "Tono Saputra", "Wandi Saputra", "Mahendra Putra", "Ilham Pratama", "Putri Dewi", "Adi Lestari", "Rangga Maulana", "Bayu Hidayat", "Fani Puspita", "Taufik", "Bagus Saputra", "Novi Puspita", "Rahmat Hidayatullah Putra", "Prayitno Saputra", "Adi Ramadhan", "Bayu Wijaya", "Gilang Nugraha", "Rangga Prasetyo", "Putra Purnama", "Wulan Pertiwi", "Adi Wijaya Ramadhan", "Budi", "Rian Pratama", "Samsul Nugroho", "Wahyu Saputra", "Teguh Prasetyo", "Fikri Nugraha", "Rizki Pratama" ]; 
        function showNextNotification() {
            if (!elements.notifBox || !elements.notifName) return;
            elements.notifName.textContent = FIRST_NAMES[Math.floor(Math.random() * FIRST_NAMES.length)];
            elements.notifBox.classList.remove('show');
            void elements.notifBox.offsetWidth;
            elements.notifBox.classList.add('show');
            setTimeout(showNextNotification, Math.floor(Math.random() * 10000) + 8000);
        }

        // --- INITIALIZATION ---
        function initializePage() {
            const pkg = packages[currentPackageId];
            testimonialImages = pkg.testimonials; // Populate images for modal
            elements.currentYear.textContent = new Date().getFullYear();
            
            // Render static content once
            elements.productInfoFormTop.innerHTML = getProductInfoHTML(pkg);
            elements.detailsAccordionContainer.innerHTML = getDetailsAccordionHTML(pkg);
            elements.paymentMethodSelection.innerHTML = getPaymentMethodsHTML(paymentAccounts);
            elements.testimonialsFull.innerHTML = getTestimonialsHTML(pkg);
            elements.infoSectionFull.innerHTML = getInfoSectionHTML();

            // Setup dynamic order functionality
            elements.addOrderBtn.addEventListener('click', addOrderItem);
            elements.submitBtn.addEventListener('click', handleFormSubmit);
            
            // Add the first order item by default
            addOrderItem();

            // Start notifications
            setTimeout(showNextNotification, 6000);
        }

        initializePage();

        // --- DETAILS MODAL LOGIC ---
        function getDetailsModalHTML(details) {
            const { pkg, totalPrice, paymentId, nama, whatsapp, orderDetails } = details;
            
            let orderItemsHTML = '';
            const validCartItems = cart.filter(item => item.jenjang && item.kelas && item.mapel);
            validCartItems.forEach(item => {
                const pricePerMapel = pricing[item.jenjang] || 0;
                orderItemsHTML += `
                    <div class="py-2">
                        <div class="flex justify-between text-base">
                            <span>${item.jenjang} - ${item.kelas} <span class="text-gray-500">(${item.mapel})</span></span>
                            <span class="font-semibold text-gray-800">${formatCurrency(pricePerMapel)}</span>
                        </div>
                    </div>
                `;
            });


            return `
                <div class="details-modal-header">
                    <h3>Ringkasan Transaksi</h3>
                    <button class="details-modal-close" onclick="closeDetailsModal()">&times;</button>
                </div>
                <div class="details-modal-body">
                    <p class="text-sm text-gray-500 mb-6">Nomor Invoice: <strong>${paymentId}</strong></p>
                    <div class="text-center mb-8">
                        <p class="text-sm text-gray-600 mb-2">Total Pembayaran</p>
                        <div class="flex items-center justify-center">
                            <p class="text-4xl font-bold text-google-blue google-sans">${formatCurrency(totalPrice)}</p>
                            <button onclick="copyToClipboard('${totalPrice}', 'Total Pembayaran')" class="copy-button-text"><i class="far fa-copy"></i></button>
                        </div>
                    </div>
                    <div class="space-y-2 border-t border-b border-gray-200 py-4 mb-4">
                        ${orderItemsHTML}
                         <div class="flex justify-between text-sm pt-2">
                            <span class="text-gray-500">Kode Unik</span>
                            <span class="font-medium">${formatCurrency(uniqueCode)}</span>
                        </div>
                    </div>
                    <div class="space-y-3 mb-8">
                        <div class="flex justify-between font-bold text-xl google-sans">
                            <span>Total Pembayaran</span>
                            <span class="text-google-blue">${formatCurrency(totalPrice)}</span>
                        </div>
                    </div>
                    <div class="border-t border-gray-200 pt-6">
                        <h4 class="font-semibold mb-4 google-sans">Informasi Pelanggan</h4>
                        <div class="grid grid-cols-2 gap-6">
                            <div><p class="text-gray-500 text-sm mb-1">Nama</p><p class="font-medium">${nama}</p></div>
                            <div><p class="text-gray-500 text-sm mb-1">Nomor Telepon</p><p class="font-medium">${whatsapp}</p></div>
                        </div>
                    </div>
                </div>`;
        }
        window.showDetailsModal = function(event) {
            event.preventDefault();
            elements.detailsModalContent.innerHTML = getDetailsModalHTML(currentOrderDetails);
            elements.detailsModal.style.display = 'flex';
            elements.detailsModalContent.classList.add('is-open');
        }
        window.closeDetailsModal = function() {
            elements.detailsModalContent.classList.remove('is-open');
            elements.detailsModalContent.classList.add('is-closing');
            setTimeout(() => { elements.detailsModal.style.display = 'none'; }, 300);
        }
    });

    // --- GLOBAL HELPER FUNCTIONS ---
    const infoModal = document.getElementById('infoModal');
    function showInfoModal(title, message) {
        if (!infoModal) return;
        infoModal.querySelector('#modalTitle').textContent = title;
        infoModal.querySelector('#modalMessage').textContent = message;
        infoModal.style.display = 'flex';
    }
    function closeInfoModal() {
        if (!infoModal) return;
        infoModal.style.display = 'none';
    }
    window.onclick = function(event) {
        if (event.target == infoModal) closeInfoModal();
        if (event.target == document.getElementById('detailsModal')) closeDetailsModal();
        if (event.target == document.getElementById('imageModal')) closeImageModal();
    }
    function copyToClipboard(text, entityName) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        try {
            document.execCommand('copy');
            showInfoModal('Berhasil Disalin!', `${entityName} telah disalin ke clipboard.`);
        } catch (err) {
            showInfoModal('Gagal!', 'Gagal menyalin. Coba secara manual.');
        }
        document.body.removeChild(textArea);
    }
    
    // --- QRIS LOGIC ---
    function toCRC16(input) {
        let crc = 0xFFFF;
        for (let i = 0; i < input.length; i++) {
            crc ^= input.charCodeAt(i) << 8;
            for (let j = 0; j < 8; j++) {
                crc = crc & 0x8000 ? (crc << 1) ^ 0x1021 : crc << 1;
            }
        }
        return (crc & 0xFFFF).toString(16).toUpperCase().padStart(4, '0');
    }
    function createDynamicQrisString(qris, { nominal }) {
        if (!qris) throw new Error('Parameter "qris" (string QRIS statis) dibutuhkan.');
        if (nominal === undefined) throw new Error('Parameter "nominal" dibutuhkan.');

        let qrisModified = qris.slice(0, -4).replace("010211", "010212");
        const nominalStr = String(Math.round(nominal));
        const amountLength = nominalStr.length < 10 ? "0" + nominalStr.length : nominalStr.length.toString();
        const amountPart = "54" + amountLength + nominalStr;
        if (!qrisModified.includes("5802ID")) throw new Error("Format string QRIS tidak dikenali.");
        let finalQris = qrisModified.replace("5802ID", amountPart + "5802ID");
        return finalQris + toCRC16(finalQris);
    }

    // --- Image Modal Functions ---
    const imageModal = document.getElementById('imageModal');
    const modalImg = document.getElementById("modalImage");
    let currentImageIndex;
    let testimonialImages = []; // Will be populated from the packages object

    window.openImageModal = function(event, index) {
        event.stopPropagation();
        imageModal.style.display = "flex";
        showImage(index);
    }
    window.closeImageModal = function() {
        imageModal.style.display = "none";
    }
    function showImage(index) {
        if (index >= testimonialImages.length || index < 0) return;
        currentImageIndex = index;
        modalImg.src = testimonialImages[index];
        document.querySelector('.modal-nav.prev').style.display = (index > 0) ? 'flex' : 'none';
        document.querySelector('.modal-nav.next').style.display = (index < testimonialImages.length - 1) ? 'flex' : 'none';
    }
    window.showNextImage = function() { showImage(currentImageIndex + 1); }
    window.showPrevImage = function() { showImage(currentImageIndex - 1); }
    document.addEventListener('keydown', function(event) {
        if (imageModal.style.display === 'flex') {
            if (event.key === 'ArrowRight') showNextImage();
            else if (event.key === 'ArrowLeft') showPrevImage();
            else if (event.key === 'Escape') closeImageModal();
        }
    });
    </script>
</body>
</html>
