<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Merdeka Mengajar - Perangkat Ajar 2025/2026</title>
    <link rel="icon" type="image/png" href="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/Logo_of_Ministry_of_Education_and_Culture_of_Republic_of_Indonesia.svg/100px-Logo_of_Ministry_of_Education_and_Culture_of_Republic_of_Indonesia.svg.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563EB',
                        'primary-dark': '#1D4ED8',
                        secondary: '#F1F5F9',
                    }
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.1/qrcode.min.js"></script>
    
    <!-- Meta Pixel Code -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '630583642253416');
      fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=630583642253416&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->

    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #1557b0;
            --secondary: #F5F5F7;
            --text-main: #1D1D1F;
            --text-secondary: #5f6368;
            --success: #34C759;
            --error: #FF3B30;
            --border: #D2D2D7;
            --bg-page: #FBFBFD;
            --google-blue: #4285F4;
            --google-green: #34A853;
            --google-yellow: #FBBC05;
            --google-red: #EA4335;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-page);
            color: var(--text-main);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Modern Card & Layout */
        .main-container {
            max-width: 520px;
            margin: 0 auto;
            min-height: 100vh;
            background: white;
            box-shadow: 0 0 40px rgba(0,0,0,0.05);
        }

        @media (min-width: 640px) {
            .main-container {
                min-height: auto;
                margin: 40px auto;
                border-radius: 24px;
                border: 1px solid rgba(0,0,0,0.05);
            }
            body {
                background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                padding-bottom: 40px;
            }
        }

        /* Glassmorphism Header */
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        /* Inputs */
        .input-group {
            position: relative;
            margin-bottom: 16px;
        }
        
        .modern-input, .modern-select {
            width: 100%;
            padding: 14px 16px;
            font-size: 15px;
            border: 1px solid var(--border);
            border-radius: 12px;
            outline: none;
            transition: all 0.2s ease;
            background: #F5F5F7;
            color: var(--text-main);
            appearance: none;
        }

        .modern-input:focus, .modern-select:focus {
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }
        
        .modern-select {
            padding-right: 40px;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
        }

        .input-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            pointer-events: none;
        }

        /* Payment Grid */
        .payment-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .payment-option {
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            height: 70px;
            position: relative;
        }

        .payment-option:hover {
            border-color: #b0b0b5;
            background: #fafafa;
        }

        .payment-option.selected {
            border-color: var(--primary);
            background: #e8f0fe;
            box-shadow: 0 2px 8px rgba(26, 115, 232, 0.1);
        }

        .payment-option img {
            height: 24px;
            width: auto;
            object-fit: contain;
            margin-bottom: 4px;
        }
        
        .payment-option span {
            font-size: 10px;
            color: var(--text-main);
            font-weight: 500;
            text-align: center;
        }

        /* Checkout Button */
        .btn-checkout {
            background: var(--primary);
            color: white;
            border: none;
            width: 100%;
            padding: 16px;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s, background 0.2s;
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.25);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-checkout:active {
            transform: scale(0.98);
        }
        
        .btn-checkout:disabled {
            background: #B0B0B5;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Features List */
        .feature-item {
            display: flex;
            align-items: start;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 14px;
            color: var(--text-main);
            line-height: 1.5;
        }

        .feature-icon {
            color: var(--success);
            margin-top: 3px;
        }

        /* Notification Toast */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: white;
            padding: 12px 20px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 100;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            width: max-content;
            max-width: 90%;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        /* Testimonial Carousel (Marquee) */
        .testimonial-carousel {
            overflow: hidden;
            width: 100%;
            position: relative;
            mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
            -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
        }
        
        .testimonial-track {
            display: flex;
            gap: 12px;
            width: max-content;
            animation: marquee 40s linear infinite;
            padding: 4px 0;
        }

        .testimonial-track:hover {
            animation-play-state: paused;
        }

        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .testimonial-item {
            flex-shrink: 0;
            width: 140px;
            height: 140px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .testimonial-item:hover {
            transform: scale(1.02);
        }

        .testimonial-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* FAQ Accordion */
        .faq-item {
            border-bottom: 1px solid var(--border);
        }
        .faq-item:last-child {
            border-bottom: none;
        }
        .faq-item summary {
            padding: 16px 0;
            cursor: pointer;
            font-weight: 500;
            list-style: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .faq-item summary::after {
            content: '\f078';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            transition: transform 0.2s;
            font-size: 12px;
            color: var(--text-secondary);
        }
        .faq-item[open] summary::after {
            transform: rotate(180deg);
        }
        .faq-content {
            padding-bottom: 16px;
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.4s ease forwards;
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal-box {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-overlay.active .modal-box {
            transform: scale(1);
        }
        
        /* Details Modal (Bottom Sheet style) */
        #detailsModal {
             align-items: flex-end;
        }
        #detailsModal .modal-box {
            width: 100%;
            max-width: 520px;
            margin: 0 auto;
            border-radius: 20px 20px 0 0;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #detailsModal.active .modal-box {
            transform: translateY(0);
        }
        
        /* Payment Instruction Styles */
        .instruction-step {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }
        .step-number {
            width: 24px;
            height: 24px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .copy-btn {
            background: rgba(26, 115, 232, 0.1);
            color: var(--primary);
            border: none;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        /* Scrollbar for modal */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body>

    <!-- Notification Toast -->
    <div id="toast" class="toast">
        <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600 flex-shrink-0">
            <i class="fas fa-check"></i>
        </div>
        <div class="text-sm">
            <p class="font-semibold text-gray-900" id="toast-title">Budi Santoso</p>
            <p class="text-gray-500 text-xs" id="toast-message">Baru saja memesan perangkat ajar</p>
        </div>
    </div>

    <div class="main-container relative">
        <!-- Main Form View -->
        <div id="view-form">
            <!-- Header -->
            <div class="sticky-header px-6 py-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/Logo_of_Ministry_of_Education_and_Culture_of_Republic_of_Indonesia.svg/100px-Logo_of_Ministry_of_Education_and_Culture_of_Republic_of_Indonesia.svg.png" alt="Logo" class="w-8 h-8 object-contain">
                    <div>
                        <h1 class="font-bold text-lg leading-none text-gray-800">Merdeka Mengajar</h1>
                        <p class="text-xs text-gray-500 font-medium">Perangkat Ajar 2025</p>
                    </div>
                </div>
                <div class="bg-blue-50 text-blue-600 px-3 py-1 rounded-full text-xs font-semibold">
                    <i class="fas fa-check-circle mr-1"></i> Terverifikasi
                </div>
            </div>

            <div class="p-6 pb-24">
                <!-- Hero / Product Info -->
                <div class="text-center mb-8 animate-fade-in">
                    <span class="inline-block bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-bold mb-3 animate-pulse">
                        <i class="fas fa-star mr-1"></i> KURIKULUM NASIONAL
                    </span>
                    <h2 class="text-2xl font-bold mb-2">Perangkat Ajar Deep Learning & KBC</h2>
                    <p class="text-gray-500 text-sm px-2">Solusi administrasi lengkap untuk SD/MI, SMP/MTS, SMA/MAN & SMK/MAK. Siap pakai & mudah diedit.</p>
                </div>

                <!-- Form -->
                <form id="orderForm" class="space-y-6">
                    
                    <!-- Features Summary -->
                    <div class="bg-gray-50 rounded-xl p-4 border border-gray-100 animate-fade-in" style="animation-delay: 0.1s">
                        <div class="feature-item"><i class="fas fa-check-circle feature-icon"></i> <span>Modul Ajar Terintegrasi</span></div>
                        <div class="feature-item"><i class="fas fa-check-circle feature-icon"></i> <span>CP, TP, ATP, LKPD Lengkap</span></div>
                        <div class="feature-item"><i class="fas fa-check-circle feature-icon"></i> <span>Format Word/Docx (Bisa Edit)</span></div>
                        <button type="button" onclick="showFeaturesModal()" class="text-blue-600 text-sm font-semibold mt-2 hover:underline">Lihat Detail Kelengkapan</button>
                    </div>

                    <!-- Cart / Selection Display Section (Updated) -->
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6 animate-fade-in" style="animation-delay: 0.15s">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-base font-bold text-slate-900">Pilih Perangkat Ajar</h2>
                            <button type="button" onclick="openAddItemModal()" class="text-sm font-semibold text-primary hover:text-primary-dark transition-colors flex items-center gap-1">
                                <i class="fas fa-plus"></i> Tambah
                            </button>
                        </div>

                        <!-- List of Selected Items -->
                        <div id="cart-items-container" class="space-y-4 mb-4 hidden">
                            <!-- Items will be injected here via JS -->
                        </div>

                        <!-- Empty State -->
                        <div id="empty-cart-state" class="text-center py-6 border-2 border-dashed border-slate-200 rounded-xl bg-slate-50">
                            <div class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-slate-100 text-slate-400 mb-2">
                                <i class="fas fa-basket-shopping text-lg"></i>
                            </div>
                            <p class="text-slate-500 text-xs mb-3">Belum ada perangkat ajar yang dipilih.</p>
                            <button type="button" onclick="openAddItemModal()" class="px-4 py-2 bg-white border border-slate-300 rounded-lg text-xs font-medium text-slate-700 hover:bg-slate-50 transition-colors shadow-sm">
                                Pilih Sekarang
                            </button>
                        </div>

                        <!-- Total Price Display -->
                        <div id="total-container" class="hidden mt-4 pt-3 border-t border-slate-100 flex justify-between items-center">
                            <span class="font-semibold text-sm text-slate-700">Total Estimasi</span>
                            <span id="widget-total-display" class="font-bold text-lg text-primary">Rp0</span>
                        </div>
                    </div>

                    <!-- Testimonials -->
                    <div class="animate-fade-in" style="animation-delay: 0.18s">
                        <label class="text-sm font-semibold text-gray-700 ml-1 mb-2 block">Kata Mereka</label>
                        <div class="testimonial-carousel" id="testimonial-container">
                            <!-- Filled by JS -->
                        </div>
                    </div>

                    <!-- User Data -->
                    <div class="space-y-4 animate-fade-in" style="animation-delay: 0.2s">
                        <label class="text-sm font-semibold text-gray-700 ml-1">Data Pemesan</label>
                        
                        <div class="input-group">
                            <input type="text" id="nama" name="nama" class="modern-input" placeholder="Nama Lengkap" required>
                            <i class="fas fa-user input-icon"></i>
                        </div>
                        
                        <div class="input-group">
                            <input type="tel" id="whatsapp" name="whatsapp" class="modern-input" placeholder="Nomor WhatsApp (08xx)" required inputmode="numeric">
                            <i class="fab fa-whatsapp input-icon"></i>
                        </div>

                        <div class="input-group">
                            <input type="email" id="email" name="email" class="modern-input" placeholder="Alamat Email" required>
                            <i class="fas fa-envelope input-icon"></i>
                        </div>
                    </div>

                    <!-- Hidden Fields -->
                    <input type="text" name="honeypot" style="display: none" tabindex="-1" autocomplete="off">
                    <input type="hidden" name="sheetName" value="kurmer">

                    <!-- Payment Method -->
                    <div class="space-y-3 animate-fade-in" style="animation-delay: 0.25s">
                        <label class="text-sm font-semibold text-gray-700 ml-1">Metode Pembayaran</label>
                        <div class="payment-grid" id="payment-grid">
                            <!-- Generated by JS -->
                        </div>
                        <input type="hidden" id="selectedPayment" name="payment-method" value="qris">
                    </div>

                </form>

                <!-- FAQ Section -->
                <div class="mt-8 animate-fade-in" style="animation-delay: 0.3s">
                    <h3 class="font-bold text-gray-900 mb-4">Pertanyaan Umum (FAQ)</h3>
                    <div id="faq-container">
                        <!-- Filled by JS -->
                    </div>
                </div>

                <p class="text-center text-xs text-gray-400 mt-8">Â© <span id="currentYear">2025</span> Merdeka Mengajar. All Rights Reserved.</p>
            </div>

            <!-- Sticky Bottom Bar -->
            <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-[0_-4px_20px_rgba(0,0,0,0.05)] z-40 sm:absolute sm:rounded-b-3xl">
                <div class="max-w-[520px] mx-auto flex items-center justify-between gap-4">
                    <div>
                        <p class="text-xs text-gray-500">Total Pembayaran</p>
                        <p class="text-xl font-bold text-blue-600" id="total-price-display">Rp 0</p>
                    </div>
                    <button type="button" id="submit-btn" class="btn-checkout flex-1" onclick="handleFormSubmit()">
                        Pesan Sekarang <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Payment Instruction View (Hidden by default) -->
        <div id="view-payment" class="hidden min-h-screen bg-gray-50 sm:rounded-3xl overflow-hidden">
             <div class="bg-white p-4 sticky top-0 z-10 border-b flex items-center gap-3 shadow-sm">
                <button onclick="backToForm()" class="text-gray-500 hover:text-black">
                    <i class="fas fa-arrow-left text-lg"></i>
                </button>
                <h2 class="font-bold text-lg">Instruksi Pembayaran</h2>
            </div>

            <div class="p-6 pb-24">
                <!-- Timer -->
                <div class="bg-blue-600 text-white rounded-xl p-4 text-center mb-6 shadow-lg shadow-blue-200">
                    <p class="text-xs opacity-80 mb-1">Selesaikan pembayaran dalam</p>
                    <div class="text-2xl font-bold font-mono" id="countdown">23:59:59</div>
                </div>

                <!-- Total Amount Card -->
                <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm mb-6 text-center relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gray-200"></div>
                    <p class="text-gray-500 text-sm mb-1">Total yang harus dibayar</p>
                    <div class="flex items-center justify-center gap-2 mb-2">
                         <h1 class="text-3xl font-bold text-gray-900" id="payment-amount">Rp 0</h1>
                         <button class="copy-btn" onclick="copyText('payment-amount-raw')"><i class="far fa-copy"></i></button>
                    </div>
                    <p class="text-xs text-red-500 bg-red-50 inline-block px-2 py-1 rounded mb-4">
                        <i class="fas fa-exclamation-circle"></i> Transfer tepat hingga 3 digit terakhir
                    </p>
                     <div id="invoice-details-summary" class="border-t border-gray-100 pt-3 text-xs text-gray-500 flex justify-between items-center">
                        <!-- Populated by JS -->
                     </div>
                </div>

                <!-- Payment Details -->
                <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm mb-6">
                    <div class="flex items-center justify-between mb-4 pb-4 border-b border-gray-100">
                        <span class="text-gray-500 text-sm">Metode</span>
                        <img id="payment-logo-result" src="" class="h-6 object-contain">
                    </div>
                    
                    <!-- Dynamic Content based on Payment Method -->
                    <div id="payment-details-content">
                        <!-- Filled by JS -->
                    </div>
                </div>

                <!-- Instructions -->
                <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                    <h3 class="font-bold text-gray-900 mb-4">Langkah Pembayaran</h3>
                    <div id="instruction-steps">
                        <!-- Filled by JS -->
                    </div>
                </div>
                
                <!-- Confirmation Button -->
                <a id="wa-confirm-btn" href="#" target="_blank" class="block mt-8 w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-xl text-center shadow-lg shadow-green-200 transition-all">
                    <i class="fab fa-whatsapp text-lg mr-2"></i> Konfirmasi Pembayaran
                </a>
            </div>
        </div>
    </div>

    <!-- MODAL: Selection Interface -->
    <div id="add-item-modal" class="modal-overlay" onclick="closeAddItemModal()">
        <div class="absolute bottom-0 left-0 right-0 lg:top-1/2 lg:left-1/2 lg:bottom-auto lg:right-auto lg:-translate-x-1/2 lg:-translate-y-1/2 lg:w-[500px] bg-white rounded-t-2xl lg:rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]" onclick="event.stopPropagation()">
            
            <!-- Modal Header -->
            <div class="p-4 border-b border-slate-100 flex items-center justify-between">
                <h3 class="font-bold text-lg">Tambah Perangkat Ajar</h3>
                <button onclick="closeAddItemModal()" class="w-8 h-8 flex items-center justify-center rounded-full bg-slate-100 text-slate-500 hover:bg-slate-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Modal Body (Scrollable) -->
            <div class="p-4 overflow-y-auto space-y-4">
                
                <!-- 1. Select Jenjang -->
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Jenjang Pendidikan</label>
                    <div class="grid grid-cols-2 gap-2" id="jenjang-options">
                        <!-- Options injected via JS -->
                    </div>
                </div>
                
                <!-- 2. Select Jurusan (SMK Only) -->
                <div id="jurusan-container" class="hidden">
                    <label class="block text-sm font-medium text-slate-700 mb-2">Jurusan SMK</label>
                    <select id="jurusan-select" class="modern-select w-full p-2.5 rounded-xl text-sm">
                        <option value="">-- Pilih Jurusan --</option>
                    </select>
                </div>

                <!-- 3. Select Kelas -->
                <div id="kelas-container" class="opacity-50 pointer-events-none transition-opacity">
                    <label class="block text-sm font-medium text-slate-700 mb-2">Kelas</label>
                    <div class="grid grid-cols-3 gap-2" id="kelas-options">
                        <!-- Options injected via JS -->
                    </div>
                </div>

                <!-- 4. Select Mapel -->
                <div id="mapel-container" class="opacity-50 pointer-events-none transition-opacity">
                    <label class="block text-sm font-medium text-slate-700 mb-2">Mata Pelajaran</label>
                    <select id="mapel-select" class="modern-select w-full p-2.5 rounded-xl text-sm">
                        <option value="">-- Pilih Kelas Dulu --</option>
                    </select>
                </div>

                <!-- Price Preview inside Modal -->
                <div id="item-price-preview" class="hidden bg-blue-50 p-3 rounded-lg flex justify-between items-center text-blue-800">
                    <span class="text-sm font-medium">Harga Satuan:</span>
                    <span class="font-bold" id="modal-price-display">Rp0</span>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="p-4 border-t border-slate-100 bg-slate-50">
                <button id="confirm-add-item" disabled class="w-full bg-primary disabled:bg-slate-300 disabled:text-slate-500 text-white font-bold py-3 rounded-xl shadow-sm transition-all">
                    Simpan Pilihan
                </button>
            </div>
        </div>
    </div>

    <!-- Details Modal -->
    <div id="detailsModal" class="modal-overlay" onclick="closeModal('detailsModal')">
        <div class="modal-box text-left p-0" id="detailsModalContent" onclick="event.stopPropagation()">
            <!-- Content will be injected by JS -->
        </div>
    </div>

    <!-- Info Modal -->
    <div id="infoModal" class="modal-overlay">
        <div class="modal-box">
            <div class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">
                <i class="fas fa-info"></i>
            </div>
            <h3 class="text-xl font-bold mb-2" id="modalTitle">Judul</h3>
            <p class="text-gray-500 mb-6" id="modalMessage">Pesan</p>
            <button onclick="closeModal('infoModal')" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl">Mengerti</button>
        </div>
    </div>

    <!-- Features Modal -->
    <div id="featuresModal" class="modal-overlay">
        <div class="modal-box text-left">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">Detail Kelengkapan</h3>
                <button onclick="closeModal('featuresModal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="space-y-4 max-h-[60vh] overflow-y-auto pr-2" id="features-list-container">
                <!-- Features filled by JS -->
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal-overlay" onclick="closeModal('imageModal')">
        <div class="relative max-w-[90%] max-h-[90vh]">
             <img id="modalImageDisplay" src="" class="rounded-xl shadow-2xl max-h-[80vh] w-auto">
             <button class="absolute top-4 right-4 bg-black/50 text-white rounded-full w-8 h-8 flex items-center justify-center" onclick="closeModal('imageModal')">&times;</button>
        </div>
    </div>

    <script>
        // --- DATA & CONFIG ---
        const uniqueCode = Math.floor(Math.random() * (500 - 100 + 1)) + 100;
        let countdownInterval;
        let expiryTime;
        let currentOrderDetails = {};
        let cart = []; // Holds all the selected order items

        // === EXISTING DATA FROM KURMER.HTML ===
        const pricing = {
            "SD/MI": 50000,
            "SMP/MTS": 75000,
            "SMA/MAN": 100000,
            "SMK/MAK": { umum: 100000, kejuruan: 125000 }
        };

        const mapelSD = ["Bahasa Indonesia", "Bahasa Inggris", "Ilmu Pengetahuan Alam dan Sosial", "Koding dan Kecerdasan Artifisial", "Matematika", "Muatan Lokal", "Pendidikan Agama Buddha dan Budi Pekerti", "Pendidikan Agama Hindu dan Budi Pekerti", "Pendidikan Agama Islam dan Budi Pekerti", "Pendidikan Agama Katolik dan Budi Pekerti", "Pendidikan Agama Khonghucu dan Budi Pekerti", "Pendidikan Agama Kristen dan Budi Pekerti", "Pendidikan Jasmani Olahraga dan Kesehatan", "Pendidikan Pancasila", "Seni Musik", "Seni Rupa", "Seni Tari", "Seni Teater"];
        const mapelSMP = ["Bahasa Indonesia", "Bahasa Inggris", "Ilmu Pengetahuan Alam", "Ilmu Pengetahuan Sosial", "Informatika", "Koding dan Kecerdasan Artifisial", "Matematika", "Muatan Lokal", "Pendidikan Agama Buddha dan Budi Pekerti", "Pendidikan Agama Hindu dan Budi Pekerti", "Pendidikan Agama Islam dan Budi Pekerti", "Pendidikan Agama Katolik dan Budi Pekerti", "Pendidikan Agama Khonghucu dan Budi Pekerti", "Pendidikan Agama Kristen dan Budi Pekerti", "Pendidikan Jasmani Olahraga dan Kesehatan", "Pendidikan Pancasila", "Prakarya Budi Daya", "Prakarya Kerajinan", "Prakarya Pengolahan", "Prakarya Rekayasa", "Seni Musik", "Seni Rupa", "Seni Tari", "Seni Teater"];
        const mapelSMA = ["Antropologi", "Bahasa Indonesia", "Bahasa Indonesia Tingkat Lanjut", "Bahasa Inggris", "Bahasa Inggris Tingkat Lanjut", "Bahasa Jepang", "Bahasa Jerman", "Bahasa Korea", "Bahasa Mandarin", "Bahasa Prancis", "Biologi", "Ekonomi", "Fisika", "Geografi", "Informatika", "Kimia", "Koding dan Kecerdasan Artifisial", "Matematika", "Matematika Tingkat Lanjut", "Muatan Lokal", "Pendidikan Agama Buddha dan Budi Pekerti", "Pendidikan Agama Hindu dan Budi Pekerti", "Pendidikan Agama Islam dan Budi Pekerti", "Pendidikan Agama Katolik dan Budi Pekerti", "Pendidikan Agama Khonghucu dan Budi Pekerti", "Pendidikan Agama Kristen dan Budi Pekerti", "Pendidikan Jasmani Olahraga dan Kesehatan", "Pendidikan Pancasila", "Prakarya dan Kewirausahaan", "Sejarah", "Sejarah Tingkat Lanjut", "Seni Musik", "Seni Rupa", "Seni Tari", "Seni Teater", "Sosiologi"];
        const mapelSMKUmum = ["Bahasa Indonesia", "Bahasa Inggris", "Dasar-Dasar Program Keahlian", "Informatika", "Koding dan Kecerdasan Artifisial", "Konsentrasi Keahlian", "Kreativitas Inovasi dan Kewirausahaan", "Matematika", "Muatan Lokal", "Pendidikan Agama Buddha dan Budi Pekerti", "Pendidikan Agama Hindu dan Budi Pekerti", "Pendidikan Agama Islam dan Budi Pekerti", "Pendidikan Agama Katolik dan Budi Pekerti", "Pendidikan Agama Khonghucu dan Budi Pekerti", "Pendidikan Agama Kristen dan Budi Pekerti", "Pendidikan Jasmani Olahraga dan Kesehatan", "Pendidikan Pancasila", "Praktik Kerja Lapangan", "Projek Ilmu Pengetahuan Alam dan Sosial", "Sejarah", "Seni Musik", "Seni Rupa", "Seni Tari", "Seni Teater"];
        const mapelAgama = ["Akidah Akhlak", "Sejarah Kebudayaan Islam", "Al-Quran Hadis", "Bahasa Arab", "Fiqih"];

        const educationalData = {
            "SD/MI": { "Kelas 1": mapelSD, "Kelas 2": mapelSD, "Kelas 3": mapelSD, "Kelas 4": mapelSD, "Kelas 5": mapelSD, "Kelas 6": mapelSD },
            "SMP/MTS": { "Kelas 7": mapelSMP, "Kelas 8": mapelSMP, "Kelas 9": mapelSMP },
            "SMA/MAN": { "Kelas 10": mapelSMA, "Kelas 11": mapelSMA, "Kelas 12": mapelSMA },
            "SMK/MAK": {
                "Akuntansi dan Keuangan Lembaga (AKL)": { "Kelas 10": [...mapelSMKUmum, ...["Akuntansi Dasar", "Aplikasi Pengolah Angka/Spreadsheet", "Etika Profesi", "Perbankan Dasar"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Administrasi Pajak", "Akuntansi Keuangan", "Komputer Akuntansi", "Praktikum Akuntansi Lembaga/Instansi Pemerintah", "Praktikum Akuntansi Perusahaan Jasa, Dagang, Manufaktur"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Administrasi Pajak", "Akuntansi Keuangan", "Komputer Akuntansi", "Produk Kreatif dan Kewirausahaan"].sort()] },
                "Teknik Komputer dan Jaringan (TKJ)": { "Kelas 10": [...mapelSMKUmum, ...["Dasar Desain Grafis", "Komputer dan Jaringan Dasar", "Pemrograman Dasar", "Simulasi dan Komunikasi Digital", "Sistem Komputer"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Administrasi Infrastruktur Jaringan (AIJ)", "Administrasi Sistem Jaringan (ASJ)", "Teknologi Jaringan Berbasis Luas (WAN)", "Teknologi Layanan Jaringan (TLJ)"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Administrasi Infrastruktur Jaringan (AIJ)", "Administrasi Sistem Jaringan (ASJ)", "Keamanan Jaringan", "Produk Kreatif dan Kewirausahaan", "Teknologi Layanan Jaringan (TLJ)"].sort()] },
                "Farmasi Klinis, Komunitas & Industri": { "Kelas 10": [...mapelSMKUmum, ...["Dasar-dasar Farmakognosi", "Dasar-dasar Farmakologi", "Dasar-dasar Kefarmasian", "Dasar-dasar Kerja di Laboratorium", "Perundang-undangan Kesehatan"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Administrasi Farmasi", "Farmakognosi", "Farmakologi Dasar", "Ilmu Kesehatan Masyarakat", "Kimia Farmasi", "Teknik Farmasi & Peracikan Obat"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Manajemen Bahan", "Pelayanan Farmasi", "Pengujian dan Pengendalian Mutu Produk", "Perencanaan Produksi dan Persediaan", "Produk Kreatif dan Kewirausahaan", "Riset dan Pengembangan Farmasi", "Teknik Pembuatan Sediaan Obat", "Teknologi Pengemasan Obat"].sort()] },
                "Perhotelan": { "Kelas 10": [...mapelSMKUmum, ...["Kepariwisataan", "Sanitasi, Hygiene, dan Keselamatan Kerja", "Tata Hidang"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Manajemen Hotel", "Operasi Dapur dan Tata Boga", "Pelayanan Pelanggan", "Room Division (Front Office, Housekeeping, Laundry)"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Administrasi Hotel", "Manajemen Event/Acara", "Manajemen Restoran", "Produk Kreatif dan Kewirausahaan"].sort()] },
                "Teknik Mesin/Pemesinan": { "Kelas 10": [...mapelSMKUmum, ...["Dasar Perancangan Teknik Mesin", "Dasar-dasar Teknik Pemesinan", "Teknik Gambar Mesin (manual/CAD)", "Teknologi Mekanik"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Praktikum Pemesinan", "Teknik Pemesinan Bubut", "Teknik Pemesinan Frais", "Teknik Pemesinan Gerinda", "Teknik Pengelasan (OAW, SMAW, MIG/MAG)"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Gambar Teknik Manufaktur", "Kelistrikan Mesin (mesin industri)", "Produk Kreatif dan Kewirausahaan", "Teknik Pemesinan NC/CNC dan CAM"].sort()] },
                "Tata Boga/Kuliner": { "Kelas 10": [...mapelSMKUmum, ...["Boga Dasar", "Ilmu Gizi", "Pengetahuan Bahan Makanan", "Sanitasi, Hygiene dan Keselamatan Kerja"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Pengolahan dan Penyajian Makanan Indonesia dan Kontinental", "Tata Hidang"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Hidangan Kesempatan Khusus & Fusion Food", "Pengelolaan Usaha Boga", "Produk Kreatif dan Kewirausahaan"].sort()] },
                "Rekayasa Perangkat Lunak (RPL)": { "Kelas 10": [...mapelSMKUmum, ...["Dasar Desain Grafis", "Komputer dan Jaringan Dasar", "Pemrograman Dasar", "Sistem Komputer"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Basis Data", "Pemodelan Perangkat Lunak", "Pemrograman Berorientasi Objek"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Basis Data", "Pemrograman Web dan Perangkat Bergerak", "Produk Kreatif dan Kewirausahaan"].sort()] },
                "Multimedia": { "Kelas 10": [...mapelSMKUmum, ...["Desain Grafis Percetakan", "Desain Interaktif", "Desain Media Interaktif", "Komunikasi Visual"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Pengembangan Game", "Pengembangan Multimedia", "Teknik Animasi 2D dan 3D", "Teknik Pengolahan Audio dan Video"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Editing Audio", "Produk Kreatif dan Kewirausahaan", "Produksi Sinema dan Film"].sort()] },
                "Teknik Otomotif (TKR: Mobil, TSM: Motor)": { "Kelas 10": [...mapelSMKUmum, ...["Chassis dan Sistem Pemindah Tenaga", "Dasar-dasar Mesin Kendaraan", "Kelistrikan Otomotif"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Pemeliharaan dan Tune-up Mesin", "Teknologi Otomotif Terbaru (injeksi, ECU, scanner diagnostik)"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Pemeliharaan Kelistrikan/Mesin/Sasis Kendaraan Ringan", "Produk Kreatif dan Kewirausahaan"].sort()] },
                "Teknik Instalasi dan Tenaga Listrik": { "Kelas 10": [...mapelSMKUmum, ...["Dasar-dasar Kelistrikan & Elektronika", "Gambar Teknik Listrik", "Pekerjaan Dasar Elektromekanik"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Instalasi Motor Listrik", "Instalasi Tenaga Listrik (rumah, industri, gedung)", "Perbaikan Peralatan Listrik", "Sistem Kontrol Otomasi Industri"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Keselamatan Kerja Listrik", "Produk Kreatif dan Kewirausahaan", "Proteksi Jaringan Tenaga Listrik", "Teknik Pembangkit/Jaringan Tenaga Listrik"].sort()] },
                "Tata Busana": { "Kelas 10": [...mapelSMKUmum, ...["Dasar Desain", "Pembuatan Pola", "Pengetahuan Bahan Tekstil", "Teknologi Menjahit"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Desain Busana", "Pembuatan Busana Custom Made", "Pembuatan Hiasan Busana"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Pembuatan Busana Industri", "Produk Kreatif dan Kewirausahaan"].sort()] },
                "Animasi": { "Kelas 10": [...mapelSMKUmum, ...["Animasi Dasar", "Desain Karakter", "Estetika Animasi", "Storyboard", "Teknik Penggambaran"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Animasi 2D dan 3D", "Digital Processing", "Penggunaan perangkat lunak animasi", "Videografi Animasi"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Produk Kreatif dan Kewirausahaan", "Produksi Animasi (projek nyata)"].sort()] },
                "Otomatisasi dan Tata Kelola Perkantoran (OTKP)": { "Kelas 10": [...mapelSMKUmum, ...["Dasar-dasar Administrasi", "Dasar-dasar Akuntansi", "Ekonomi Bisnis", "Simulasi Digital", "Teknologi Perkantoran"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Kearsipan", "Korespondensi", "Otomatisasi Tata Kelola Kepegawaian", "Otomatisasi Tata Kelola Keuangan", "Pengelolaan Surat Masuk dan Keluar"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Komputer Administrasi Perkantoran", "Otomatisasi Tata Kelola Humas dan Keprotokolan", "Otomatisasi Tata Kelola Sarana dan Prasarana", "Pengelolaan Informasi", "Produk Kreatif dan Kewirausahaan"].sort()] },
                "Broadcasting dan Perfilman (Produksi dan Siaran Program Televisi)": { "Kelas 10": [...mapelSMKUmum, ...["Dasar Editing Video", "Dasar-dasar Fotografi, Tata Kamera, Tata Artistik, Tata Suara", "Dasar-dasar Produksi Siaran dan Film", "Pengantar Naskah dan Storyboard", "Pengoperasian Kamera Video dan DSLR", "Teknik Pengambilan Gambar dan Pencahayaan Dasar"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Dasar-dasar Jurnalistik dan Penyiaran", "Estetika Seni Audio Visual", "Komunikasi Visual dan Penyajian Pesan Audio-Visual", "Peralatan Audio Video", "Penulisan Skenario Film dan Televisi", "Produksi Film Pendek", "Produksi Program Televisi"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Media Digital", "Pengelolaan Produksi dan Post-produksi", "Penyutradaraan, Sinematografi, dan Tata Artistik", "Produk Kreatif dan Kewirausahaan", "Proyek Siaran Sekolah/TV Komunitas", "Teknik Editing Lanjut (Video, Audio, Color Grading)", "Teknik Penyiaran (Radio & TV Digital)"].sort()] },
                "Tata Graha (Housekeeping/Perawatan Kamar)": { "Kelas 10": [...mapelSMKUmum, ...["Pembersihan Area Umum Hotel"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Penataan Ruang Serbaguna", "Penyiapan Kamar Tamu"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Housekeeping (Manajemen Tata Graha)", "Praktik Housekeeping", "Produk Kreatif dan Kewirausahaan", "Tata Graha Kamar Hotel"].sort()] },
                "Asisten Keperawatan": { "Kelas 10": [...mapelSMKUmum, ...["Anatomi Fisiologi", "Ilmu Kesehatan Masyarakat", "Komunikasi Keperawatan", "Konsep Dasar Keperawatan"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Dasar Farmakologi", "Dokumentasi Keperawatan", "Keterampilan Dasar Tindakan Keperawatan", "Komunikasi Terapeutik", "Praktik Laboratorium"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Asuhan Keperawatan", "Dokumentasi Tindakan Keperawatan", "Kesehatan Reproduksi", "Pemeriksaan Laboratorium", "Produk Kreatif dan Kewirausahaan"].sort()] },
                "Teknik Konstruksi dan Perumahan/Bangunan": { "Kelas 10": [...mapelSMKUmum, ...["Gambar Teknik Bangunan", "Melaksanakan Pekerjaan Pondasi Dangkal", "Mekanika Teknik", "Simulasi Digital", "Ukur Tanah"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Konstruksi Bangunan", "Konstruksi Bangunan Gedung", "Melaksanakan Pekerjaan Beton", "Melaksanakan Pemasangan Bata dan Kusen", "Teknik Konstruksi Baja, Kayu, Batu dan Beton"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Estimasi Biaya Konstruksi, Sanitasi dan Perawatan Gedung", "Melaksanakan Pekerjaan Kuda-kuda", "Melaksanakan Pekerjaan Plester dan Acian", "Melaksanakan Pemasangan Rangka dan Penutup Atap", "Perawatan Gedung", "Produk Kreatif dan Kewirausahaan", "Sistem Utilitas Bangunan Gedung"].sort()] },
                "Desain Grafika (Graphic Design)": { "Kelas 10": [...mapelSMKUmum, ...["Dasar-Dasar Seni Rupa", "Gambar Sketsa", "Pengetahuan Bahan Grafika"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Desain Grafis Percetakan", "Komputer Grafis", "Software Desain (CorelDraw, Adobe Illustrator, Adobe Photoshop)", "Teknik Percetakan"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Desain Media Cetak", "Desain Publikasi", "Pengembangan Multimedia", "Produk Kreatif dan Kewirausahaan", "Videografi"].sort()] },
                "Manajemen Logistik/Teknik Logistik": { "Kelas 10": [...mapelSMKUmum, ...["Logistik dan Rantai Pasokan", "Regulasi Sektor Logistik dan Keselamatan Kerja"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Administrasi Pergudangan", "Manajemen Penanganan Bahan", "Penanganan Transportasi", "Sistem Manajemen Logistik"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Manajemen Distribusi dan Delivery", "Produk Kreatif dan Kewirausahaan", "Teknologi Logistik"].sort()] },
                "Pariwisata/Usaha Perjalanan Wisata (UPW/ULP)": { "Kelas 10": [...mapelSMKUmum, ...["Administrasi Pariwisata", "Komunikasi Pariwisata", "Pengetahuan Destinasi Wisata"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Pemandu Perjalanan Wisata", "Pemesanan Tempat & Ticket Penerbangan", "Penyusunan Itinerary", "Ticketing Penerbangan", "Tour Planning"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Budgeting Wisata", "Event Management/Manajemen Acara", "Pemasaran Pariwisata", "Perencanaan & Pengelolaan Perjalanan Wisata", "Praktik Kerja Lapangan di Industri Pariwisata", "Produk Kreatif dan Kewirausahaan"].sort()] },
                "Teknik Pengelasan dan Fabrikasi Logam": { "Kelas 10": [...mapelSMKUmum, ...["Dasar Perancangan Teknik Mesin", "Fabrikasi Logam Dasar", "Gambar Teknik Mesin", "Pekerjaan Dasar Teknik Mesin", "Teknik Gambar dan Simbol Las"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Teknik Pengelasan Busur Manual (SMAW)", "Teknik Pengelasan Gas Metal (MIG/MAG)", "Teknik Pengelasan Gas Tungsten (TIG)", "Teknik Pengelasan Oksi-Asetelin (OAW)"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Penanganan Material dan Keselamatan Kerja", "Produk Kreatif dan Kewirausahaan", "Teknik Pengelasan FCAW"].sort()] },
                "Kebidanan": { "Kelas 10": [...mapelSMKUmum, ...["Anatomi & Fisiologi", "Dasar-Dasar Obstetri & Ginekologi", "Ilmu Gizi", "Konsep dan Pelayanan Kebidanan"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Asuhan Kebidanan pada Anak", "Asuhan Kebidanan pada Ibu", "Farmakologi Dalam Kebidanan", "Komunikasi & Konseling", "Praktik Kebidanan"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Asuhan Kebidanan Persalinan dan Bayi Baru Lahir", "Dokumentasi Kebidanan", "Keluarga Berencana", "Kesehatan Perempuan dan Perencanaan Keluarga", "Penatalaksanaan Kegawatdaruratan", "Produk Kreatif dan Kewirausahaan"].sort()] },
                "Teknologi Laboratorium Medik (TLM/Analis Kesehatan)": { "Kelas 10": [...mapelSMKUmum, ...["Anatomo Fisiologi", "Biologi Sel dan Molekuler", "Dasar Manajemen Laboratorium dan Kesehatan Lingkungan", "Fisiologi", "Flebotomi", "Instrumentasi", "Patofisiologi", "Pengantar Laboratorium Medik"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Bakteriologi", "Hematologi", "Histologi", "Imunoserologi", "Kimia Klinik", "Laboratorium Kesehatan Dasar", "Mikrobiologi Kesehatan", "Sitohistoteknologi", "Urinalisa dan Cairan Tubuh"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Kontrol Kualitas Prosedur Laboratorium", "Penanganan Sampel dan Reagen Laboratorium", "Pengendalian Mutu Hasil Pertanian", "Pemeriksaan Laboratorium", "Produk Kreatif dan Kewirausahaan"].sort()] },
                "Desain Komunikasi Visual (DKV)": { "Kelas 10": [...mapelSMKUmum, ...["Dasar Desain", "Dasar-Dasar Seni Rupa", "Gambar Sketsa", "Komunikasi Visual"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Desain Grafis Percetakan", "Desain Media Interaktif", "Desain Publikasi", "Komputer Grafis", "Videografi"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Editing Audio", "Editing Video", "Pengembangan Game", "Pengembangan Multimedia", "Produk Kreatif dan Kewirausahaan", "Teknik Animasi 2D dan 3D", "Teknik Pengolahan Audio dan Video"].sort()] },
                "Dental Asisten (Kesehatan Gigi)": { "Kelas 10": [...mapelSMKUmum, ...["Anatomi dan Fisiologi Gigi dan Mulut", "Radiografi Gigi", "Sterilisasi dan Kebersihan"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Etika dan Hukum dalam Praktek Dental", "Instrumen Klinis", "Kesehatan Mulut Anak-Anak", "Prosedur Pencegahan Infeksi", "Prosedur Perawatan Gigi Dasar"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Aspek Bisnis dalam Praktek Dental", "Dokumentasi Pasien Dental", "Farmakologi Dental", "Pelayanan Pasien Dental", "Penggunaan Perangkat Medis", "Produk Kreatif dan Kewirausahaan", "Standar Praktik Dental"].sort()] },
                "Pekerjaan Sosial & Caregiver (Perawatan Sosial)": { "Kelas 10": [...mapelSMKUmum, ...["Dasar-dasar Keperawatan Sosial", "Kesehatan Mental", "Keterampilan Komunikasi"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Dukungan Sosial", "Kesehatan dan Kesejahteraan", "Pengembangan Keterampilan Pribadi", "Perawatan Dasar", "Perawatan Jangka Panjang"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Asuhan Sosial", "Dokumentasi Asuhan Sosial", "Komunikasi Terapeutik", "Manajemen Kesehatan Masyarakat", "Perawatan Lanjut Usia", "Praktik Keperawatan Sosial", "Produk Kreatif dan Kewirausahaan"].sort()] },
                "Agribisnis Pengolahan Hasil Pertanian": { "Kelas 10": [...mapelSMKUmum, ...["Dasar Penanganan Bahan Hasil Pertanian", "Dasar Pengendalian Mutu Hasil Pertanian", "Dasar Proses Pengolahan Hasil Pertanian", "Kesehatan dan Keselamatan Kerja (K3)"].sort()], "Kelas 11": [...mapelSMKUmum, ...["GMP (Good Manufacturing Practice)", "Pengemasan, Penyimpanan dan Penggudangan", "Produksi Pengolahan Hasil Hewani", "Produksi Pengolahan Hasil Nabati", "Produksi Pengolahan Komoditas Perkebunan dan Herbal", "SSOP (Sanitation Standard Operating Procedures)"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Analisa Usaha Pengolahan Hasil Pertanian", "HACCP (Hazard Analysis Critical Control Point)", "Penanganan Limbah Pengolahan Hasil Pertanian", "Produk Kreatif dan Kewirausahaan", "Sistem Manajemen Keamanan Pangan dan Kualitas Produk"].sort()] },
                "Agribisnis Perikanan Air Tawar": { "Kelas 10": [...mapelSMKUmum, ...["Dasar-dasar Budidaya Perikanan", "Kesehatan dan Keselamatan Kerja (K3)", "Pengelolaan Kualitas Air", "Pengendalian Hama dan Penyakit"].sort()], "Kelas 11": [...mapelSMKUmum, ...["Pengelolaan Wadah dan Media Pendederan", "Produksi Pakan Alami dan Pakan Buatan", "Seleksi Benih", "Teknik Pembesaran Komoditas Perikanan", "Teknik Pendederan Komoditas Perikanan"].sort()], "Kelas 12": [...mapelSMKUmum, ...["Analisis Kelayakan Usaha Perikanan", "Inovasi Teknologi Perikanan", "Pemanenan Hasil Produksi", "Pemasaran Hasil Produksi Komoditas Perikanan", "Pemantauan Laju Pertumbuhan", "Produk Kreatif dan Kewirausahaan"].sort()] }
            }
        };

        const paymentMethods = [
            { id: 'qris', name: 'QRIS', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Logo_QRIS.svg/163px-Logo_QRIS.svg.png', type: 'qr', number: '00020101021126610016ID.CO.SHOPEE.WWW01189360091800223157700208223157700303UMI51440014ID.CO.QRIS.WWW0215ID10254270621910303UMI5204481453033605802ID5904Epay6013JAKARTA PUSAT61051061062070703A0163042F15', holder: 'Epay' },
            { id: 'bca_va', name: 'BCA', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Bank_Central_Asia.svg/330px-Bank_Central_Asia.svg.png', type: 'bank', number: '39358089510639366', holder: 'Epayment' },
            { id: 'gopay', name: 'GoPay', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/86/Gopay_logo.svg/320px-Gopay_logo.svg.png', type: 'ewallet', number: '089510639366', holder: 'Gopay' },
            { id: 'dana', name: 'DANA', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Logo_dana_blue.svg/330px-Logo_dana_blue.svg.png', type: 'ewallet', number: '089510639366', holder: 'DNID' },
            { id: 'ovo', name: 'OVO', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/eb/Logo_ovo_purple.svg/330px-Logo_ovo_purple.svg.png', type: 'ewallet', number: '089510639366', holder: 'OVO' },
            { id: 'cimb', name: 'CIMB', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/CIMB_Niaga_logo.svg/330px-CIMB_Niaga_logo.svg.png', type: 'bank', number: '6289510639366', holder: 'Octo Pay' }
        ];

        const kelengkapanList = [
            "Modul Ajar Terintegrasi Deep Learning (2 Semester)",
            "Capaian Pembelajaran (CP)",
            "Alur Tujuan Pembelajaran (ATP)",
            "Lembar Kerja Peserta Didik (LKPD)",
            "Asesmen (Diagnostik, Formatif, Sumatif)",
            "Program Tahunan (PROTA)",
            "Program Semester (PROMES)",
            "Alokasi Waktu Pembelajaran",
            "Administrasi Wali Kelas Lengkap",
            "Daftar Nilai & Jurnal Harian",
            "Analisis Penilaian Kurikulum Nasional",
            "Bonus: Media Ajar & Materi Presentasi"
        ];
        
        const testimonialImages = [
            "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0008.jpg",
            "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0009.jpg",
            "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0010.jpg",
            "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0011.jpg",
            "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0012.jpg",
            "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0013.jpg",
            "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0014.jpg",
            "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0015.jpg",
            "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0016.jpg",
            "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0017.jpg",
            "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0018.jpg",
            "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0019.jpg",
            "https://cdn.allthepics.net/images/2025/09/11/IMG-20250827-WA0020.jpg"
        ];
        
        const faqList = [
            { q: "Apa itu Perangkat Ajar Deep Learning?", a: "Kumpulan lengkap dokumen administrasi mengajar siap pakai (Word/Docx) yang disusun berdasarkan Kurikulum Nasional terbaru." },
            { q: "Apakah sudah sesuai Kurikulum Nasional?", a: "Ya, 100%. Komponen CP, TP, ATP, hingga Asesmen sesuai panduan Kemendikbudristek." },
            { q: "Untuk jenjang apa saja?", a: "Tersedia untuk SD, SMP, SMA, dan SMK. Pilih jenjang dan mapel saat pemesanan." },
            { q: "Bagaimana cara pengirimannya?", a: "Link unduhan Google Drive dikirim otomatis ke WhatsApp & Email Anda setelah pembayaran." }
        ];

        const operatorPrefixes = {
            'Telkomsel': ['0811', '0812', '0813', '0821', '0822', '0823', '0851', '0852', '0853'], 'by.U': ['0851'], 'Indosat Ooredoo': ['0814', '0815', '0816', '0855', '0856', '0857', '0858'], 'Tri (3)': ['0895', '0896', '0897', '0898', '0899'], 'XL Axiata': ['0817', '0818', '0819', '0859', '0877', '0878', '0879'], 'Live.On': ['0859'], 'Axis': ['0831', '0832', '0833', '0838'], 'Smartfren': ['0881', '0882', '0883', '0884', '0885', '0886', '0887', '0888', '0889']
        };
        const blacklistedNumbers = ['081234567890'];
        const allowedEmailDomains = [
            'gmail.com', 'googlemail.com', 'outlook.com', 'hotmail.com',
            'hotmail.co.uk', 'live.com', 'msn.com', 'yahoo.com', 'yahoo.co.id',
            'yahoo.co.uk', 'ymail.com', 'rocketmail.com', 'icloud.com', 'me.com',
            'mac.com', 'aol.com', 'zoho.com', 'proton.me', 'protonmail.com',
            'tutanota.com', 'gmx.com', 'gmx.de', 'mail.com', 'yandex.ru',
            'yandex.com', 'fastmail.com', 'hey.com'
        ];

        // --- VALIDATION HELPER ---
        function isInvalidPattern(nomor) {
            if (blacklistedNumbers.includes(nomor)) return true;
            const numberPart = nomor.substring(2);
            if (/(\d)\1{4,}/.test(numberPart)) return true;
            for (let i = 0; i < numberPart.length - 4; i++) {
                const sub = numberPart.substring(i, i + 5);
                if ('0123456789'.includes(sub) || '9876543210'.includes(sub)) return true;
            }
            return new Set(numberPart.split('')).size < 4 || /(..)\1\1/.test(numberPart);
        }

        function getOperatorFromNumber(nomor) {
            const prefix = nomor.substring(0, 4);
            for (const operator in operatorPrefixes) { if (operatorPrefixes[operator].includes(prefix)) return operator; }
            return null;
        }

        function validatePhoneNumber(nomorHp) {
            const genericError = { isValid: false, message: 'Silahkan isi dengan nomor WhatsApp yang benar dan aktif.' };
            if (nomorHp.length < 10) return genericError;
            const operator = getOperatorFromNumber(nomorHp);
            if (!operator) return genericError;
            if (nomorHp.length > (operator === 'Tri (3)' ? 13 : 12)) return genericError;
            if (isInvalidPattern(nomorHp)) return genericError;
            return { isValid: true, message: 'Nomor valid.' };
        }

        function validateForm() {
            const nameInput = document.getElementById('nama');
            const name = nameInput.value.trim();
            const waInput = document.getElementById('whatsapp');
            const wa = waInput.value.trim();
            const emailInput = document.getElementById('email');
            const email = emailInput.value.trim();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if (!name) return { valid: false, msg: 'Nama wajib diisi', element: nameInput };
            
            const phoneValidationResult = validatePhoneNumber(wa);
            if (!phoneValidationResult.isValid) {
                return { valid: false, msg: phoneValidationResult.message, element: waInput };
            }

            if (!email || !emailRegex.test(email)) {
                return { valid: false, msg: 'Email tidak valid', element: emailInput };
            }

            const domain = email.split('@')[1];
            if (!allowedEmailDomains.includes(domain)) {
                return { valid: false, msg: 'Domain email tidak diizinkan. Harap gunakan email pribadi.', element: emailInput };
            }
            
            return { valid: true };
        }
        
        function formatCurrency(value) {
            return `Rp${value.toLocaleString('id-ID', { minimumFractionDigits: 0 })}`;
        }

        // --- DOM CONTENT LOADED ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            renderPaymentMethods();
            renderTestimonials();
            renderFAQ();
            initNotifications();
            renderJenjangOptions(); // Initialize Widget
            
            // Input formatting
            const whatsappInput = document.getElementById('whatsapp');
            whatsappInput.addEventListener('input', (e) => {
                e.target.value = e.target.value.replace(/[^0-9]/g, '');
            });

            // Widget Event Listeners
            document.getElementById('confirm-add-item').addEventListener('click', handleConfirmAddItem);
            document.getElementById('jurusan-select').addEventListener('change', handleJurusanChange);
            document.getElementById('mapel-select').addEventListener('change', handleMapelChange);
        });

        // --- RENDER FUNCTIONS ---
        function renderPaymentMethods() {
            const grid = document.getElementById('payment-grid');
            grid.innerHTML = paymentMethods.map((pm, idx) => `
                <div id="pay-opt-${pm.id}" class="payment-option ${idx === 0 ? 'selected' : ''}" onclick="selectPayment('${pm.id}')">
                    <img src="${pm.logo}" alt="${pm.name}">
                    <span>${pm.name}</span>
                </div>
            `).join('');
        }
        
        function selectPayment(paymentId) {
            document.getElementById('selectedPayment').value = paymentId;
            document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('selected'));
            document.getElementById(`pay-opt-${paymentId}`).classList.add('selected');
        }

        function renderTestimonials() {
            const container = document.getElementById('testimonial-container');
            const images = [...testimonialImages, ...testimonialImages]; // Duplicate for smooth loop
            container.innerHTML = `
                <div class="testimonial-track">
                    ${images.map(url => `
                        <div class="testimonial-item" onclick="openImageModal('${url}')">
                            <img src="${url}" alt="Testimoni" loading="lazy">
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function renderFAQ() {
            const container = document.getElementById('faq-container');
            container.innerHTML = faqList.map(item => `
                <details class="faq-item">
                    <summary>${item.q}</summary>
                    <div class="faq-content">${item.a}</div>
                </details>
            `).join('');
        }

        // --- NEW MODAL-BASED SELECTION LOGIC ---

        function openAddItemModal() {
            document.getElementById('add-item-modal').classList.add('active');
            resetModalSelection();
        }

        function closeAddItemModal() {
            document.getElementById('add-item-modal').classList.remove('active');
        }

        function resetModalSelection() {
            document.querySelectorAll('input[name="modal-jenjang"]').forEach(el => el.checked = false);
            
            const jurusanContainer = document.getElementById('jurusan-container');
            const kelasContainer = document.getElementById('kelas-container');
            const mapelContainer = document.getElementById('mapel-container');
            const pricePreview = document.getElementById('item-price-preview');
            const confirmBtn = document.getElementById('confirm-add-item');

            jurusanContainer.classList.add('hidden');
            kelasContainer.classList.add('opacity-50', 'pointer-events-none');
            mapelContainer.classList.add('opacity-50', 'pointer-events-none');
            pricePreview.classList.add('hidden');
            confirmBtn.disabled = true;

            document.getElementById('jurusan-select').innerHTML = '<option value="">-- Pilih Jurusan --</option>';
            document.getElementById('kelas-options').innerHTML = '';
            document.getElementById('mapel-select').innerHTML = '<option value="">-- Pilih Kelas Dulu --</option>';
        }

        // 1. Render Jenjang Buttons
        function renderJenjangOptions() {
            const container = document.getElementById('jenjang-options');
            let html = '';
            Object.keys(educationalData).forEach(jenjang => {
                html += `
                    <label class="cursor-pointer">
                        <input type="radio" name="modal-jenjang" value="${jenjang}" class="peer sr-only" onchange="handleJenjangSelect(this.value)">
                        <div class="p-3 text-center border border-slate-200 rounded-xl peer-checked:bg-blue-50 peer-checked:border-blue-500 peer-checked:text-blue-700 transition hover:bg-slate-50 text-sm font-medium">
                            ${jenjang}
                        </div>
                    </label>
                `;
            });
            container.innerHTML = html;
        }

        // 2. Handle Jenjang Selection
        function handleJenjangSelect(jenjang) {
            const jurusanContainer = document.getElementById('jurusan-container');
            const kelasContainer = document.getElementById('kelas-container');
            const kelasOptions = document.getElementById('kelas-options');
            
            // Reset downstream
            document.getElementById('jurusan-select').value = '';
            kelasOptions.innerHTML = '';
            document.getElementById('mapel-select').innerHTML = '<option value="">-- Pilih Kelas Dulu --</option>';
            document.getElementById('mapel-container').classList.add('opacity-50', 'pointer-events-none');
            document.getElementById('confirm-add-item').disabled = true;
            document.getElementById('item-price-preview').classList.add('hidden');

            if (jenjang === 'SMK/MAK') {
                // Show Jurusan Select
                jurusanContainer.classList.remove('hidden');
                const jurusanSelect = document.getElementById('jurusan-select');
                jurusanSelect.innerHTML = '<option value="">-- Pilih Jurusan --</option>';
                Object.keys(educationalData[jenjang]).forEach(j => {
                    const opt = document.createElement('option');
                    opt.value = j;
                    opt.textContent = j;
                    jurusanSelect.appendChild(opt);
                });
                kelasContainer.classList.add('opacity-50', 'pointer-events-none');
            } else {
                // Show Kelas Buttons directly
                jurusanContainer.classList.add('hidden');
                kelasContainer.classList.remove('opacity-50', 'pointer-events-none');
                
                Object.keys(educationalData[jenjang]).forEach(kelas => {
                    kelasOptions.innerHTML += `
                        <label class="cursor-pointer">
                            <input type="radio" name="modal-kelas" value="${kelas}" class="peer sr-only" onchange="handleKelasSelect(this.value)">
                            <div class="p-2 text-center border border-slate-200 rounded-lg peer-checked:bg-blue-50 peer-checked:border-blue-500 peer-checked:text-blue-700 transition text-xs font-medium">
                                ${kelas}
                            </div>
                        </label>
                    `;
                });
            }
        }

        // 3. Handle Jurusan Change (SMK Only)
        function handleJurusanChange(e) {
            const jurusan = e.target.value;
            const jenjang = document.querySelector('input[name="modal-jenjang"]:checked')?.value;
            const kelasContainer = document.getElementById('kelas-container');
            const kelasOptions = document.getElementById('kelas-options');
            
            kelasOptions.innerHTML = '';
            document.getElementById('mapel-select').innerHTML = '<option value="">-- Pilih Kelas Dulu --</option>';
            document.getElementById('mapel-container').classList.add('opacity-50', 'pointer-events-none');

            if (jurusan && jenjang === 'SMK/MAK') {
                kelasContainer.classList.remove('opacity-50', 'pointer-events-none');
                Object.keys(educationalData[jenjang][jurusan]).forEach(kelas => {
                    kelasOptions.innerHTML += `
                        <label class="cursor-pointer">
                            <input type="radio" name="modal-kelas" value="${kelas}" class="peer sr-only" onchange="handleKelasSelect(this.value)">
                            <div class="p-2 text-center border border-slate-200 rounded-lg peer-checked:bg-blue-50 peer-checked:border-blue-500 peer-checked:text-blue-700 transition text-xs font-medium">
                                ${kelas}
                            </div>
                        </label>
                    `;
                });
            }
        }

        // 4. Handle Kelas Selection
        function handleKelasSelect(kelas) {
            const jenjang = document.querySelector('input[name="modal-jenjang"]:checked').value;
            const jurusan = document.getElementById('jurusan-select').value;
            const mapelSelect = document.getElementById('mapel-select');
            const mapelContainer = document.getElementById('mapel-container');

            mapelContainer.classList.remove('opacity-50', 'pointer-events-none');
            mapelSelect.innerHTML = '<option value="">-- Pilih Mata Pelajaran --</option>';

            const addOption = (val, group) => {
                const opt = document.createElement('option');
                opt.value = val;
                opt.textContent = val;
                group.appendChild(opt);
            };

            // Populate Mapel
            if (jenjang === 'SMK/MAK') {
                const agamaGroup = document.createElement('optgroup'); agamaGroup.label = 'Mapel Agama Islam';
                mapelAgama.forEach(m => addOption(m, agamaGroup));
                mapelSelect.appendChild(agamaGroup);

                const umumGroup = document.createElement('optgroup'); umumGroup.label = 'Mapel Umum';
                const classSpecificMapels = educationalData[jenjang][jurusan][kelas] || [];
                mapelSMKUmum.forEach(m => { if(classSpecificMapels.includes(m)) addOption(m, umumGroup); });
                mapelSelect.appendChild(umumGroup);

                const kejuruanGroup = document.createElement('optgroup'); kejuruanGroup.label = 'Mapel Kejuruan';
                let allKejuruan = [];
                const classes = educationalData[jenjang][jurusan];
                for(let c in classes) { allKejuruan.push(...classes[c].filter(m => !mapelSMKUmum.includes(m))); }
                [...new Set(allKejuruan)].sort().forEach(m => addOption(m, kejuruanGroup));
                mapelSelect.appendChild(kejuruanGroup);

            } else {
                const agamaGroup = document.createElement('optgroup'); agamaGroup.label = 'Mapel Agama Islam';
                mapelAgama.forEach(m => addOption(m, agamaGroup));
                mapelSelect.appendChild(agamaGroup);

                const umumGroup = document.createElement('optgroup'); umumGroup.label = 'Mapel Umum';
                educationalData[jenjang][kelas].forEach(m => addOption(m, umumGroup));
                mapelSelect.appendChild(umumGroup);
            }
        }

        // 5. Handle Mapel Change & Pricing
        function handleMapelChange(e) {
            const mapel = e.target.value;
            const jenjang = document.querySelector('input[name="modal-jenjang"]:checked').value;
            const confirmBtn = document.getElementById('confirm-add-item');
            const pricePreview = document.getElementById('item-price-preview');
            const priceDisplay = document.getElementById('modal-price-display');

            if (mapel) {
                confirmBtn.disabled = false;
                let price = 0;
                if (jenjang === 'SMK/MAK') {
                    const isUmum = mapelSMKUmum.includes(mapel) || mapelAgama.includes(mapel);
                    price = isUmum ? pricing['SMK/MAK'].umum : pricing['SMK/MAK'].kejuruan;
                } else {
                    price = pricing[jenjang];
                }
                priceDisplay.textContent = formatCurrency(price);
                pricePreview.classList.remove('hidden');
            } else {
                confirmBtn.disabled = true;
                pricePreview.classList.add('hidden');
            }
        }

        // 6. Confirm Add Item
        function handleConfirmAddItem() {
            const jenjang = document.querySelector('input[name="modal-jenjang"]:checked').value;
            const jurusan = document.getElementById('jurusan-select').value;
            const kelas = document.querySelector('input[name="modal-kelas"]:checked').value;
            const mapel = document.getElementById('mapel-select').value;

            cart.push({
                id: Date.now(),
                jenjang,
                jurusan: jurusan || '',
                kelas,
                mapel
            });

            updateCartUI();
            closeAddItemModal();
            showModal('Berhasil', 'Perangkat ajar ditambahkan.');
        }

        // 7. Remove Item
        window.removeItem = function(id) {
            cart = cart.filter(item => item.id !== id);
            updateCartUI();
        }

        // 8. Update Cart UI & Total
        function updateCartUI() {
            const container = document.getElementById('cart-items-container');
            const emptyState = document.getElementById('empty-cart-state');
            const totalContainer = document.getElementById('total-container');
            const bottomBarTotal = document.getElementById('total-price-display');
            
            if (cart.length === 0) {
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
                totalContainer.classList.add('hidden');
                bottomBarTotal.textContent = formatCurrency(0);
            } else {
                container.classList.remove('hidden');
                emptyState.classList.add('hidden');
                totalContainer.classList.remove('hidden');
                
                let html = '';
                let subtotal = 0;

                cart.forEach(item => {
                    let price = 0;
                    if (item.jenjang === 'SMK/MAK') {
                        const isUmum = mapelSMKUmum.includes(item.mapel) || mapelAgama.includes(item.mapel);
                        price = isUmum ? pricing['SMK/MAK'].umum : pricing['SMK/MAK'].kejuruan;
                    } else {
                        price = pricing[item.jenjang];
                    }
                    subtotal += price;

                    html += `
                        <div class="flex items-start justify-between bg-slate-50 p-3 rounded-xl border border-slate-100 animate-[fadeIn_0.3s]">
                            <div>
                                <div class="text-sm font-bold text-slate-800">${item.mapel}</div>
                                <div class="text-xs text-slate-500">${item.jenjang} ${item.jurusan ? `(${item.jurusan})` : ''} â¢ ${item.kelas}</div>
                            </div>
                            <div class="flex flex-col items-end gap-1">
                                <div class="text-sm font-semibold text-primary">${formatCurrency(price)}</div>
                                <button type="button" onclick="removeItem(${item.id})" class="text-xs text-red-500 hover:text-red-700 font-medium">Hapus</button>
                            </div>
                        </div>
                    `;
                });
                container.innerHTML = html;
                
                const total = subtotal + uniqueCode;
                document.getElementById('widget-total-display').textContent = formatCurrency(total);
                bottomBarTotal.textContent = formatCurrency(total);
            }
        }

        // --- SUBMISSION ---
        async function handleFormSubmit() {
            const validation = validateForm();
            if (!validation.valid) {
                showModal('Data Belum Lengkap', validation.msg);
                if (validation.element) {
                    validation.element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    validation.element.focus();
                }
                return;
            }

            if (cart.length === 0) {
                showModal('Pesanan Kosong', 'Silakan pilih minimal satu perangkat ajar.');
                const emptyState = document.getElementById('empty-cart-state');
                if (emptyState) {
                    emptyState.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                return;
            }

            const formData = new FormData(document.getElementById('orderForm'));
            const nama = formData.get('nama').trim();
            const whatsapp = formData.get('whatsapp').trim();
            const email = formData.get('email').trim();
            const paymentMethodKey = formData.get('payment-method');

            const btn = document.getElementById('submit-btn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Memproses...';

            // Calculate Totals
            let subtotal = 0;
            cart.forEach(item => {
                let price = 0;
                if (item.jenjang === 'SMK/MAK') {
                    const isUmum = mapelSMKUmum.includes(item.mapel) || mapelAgama.includes(item.mapel);
                    price = isUmum ? pricing['SMK/MAK'].umum : pricing['SMK/MAK'].kejuruan;
                } else {
                    price = pricing[item.jenjang];
                }
                subtotal += price;
            });
            const totalPrice = subtotal + uniqueCode;
            
            const orderDetailsString = cart.map(item => `\n- ${item.jenjang} ${item.jurusan ? `(${item.jurusan})` : ''} - ${item.kelas} : ${item.mapel}`).join('');

            const paymentAccount = paymentMethods.find(p => p.id === paymentMethodKey);
            const now = new Date();

            const year = String(now.getFullYear()).slice(-2);
            const month = String(now.getMonth()+1).padStart(2,'0');
            const day = String(now.getDate()).padStart(2,'0');
            const randomChar = () => String.fromCharCode(65 + Math.floor(Math.random() * 26));
            const randomDigit = () => Math.floor(Math.random() * 10);

            const paymentId = `INV-PA-${year}${month}${day}-${randomChar()}${randomDigit()}${randomChar()}${randomDigit()}`;

            const dataToSend = {
                nama, whatsapp, email,
                paket: orderDetailsString,
                metodePembayaran: paymentAccount.name,
                totalTransfer: formatCurrency(totalPrice),
                idPembayaran: paymentId,
                nomorRekening: paymentAccount.number || '-',
                sheetName: formData.get('sheetName')
            };

            const scriptURL = 'https://script.google.com/macros/s/AKfycbySaAB2WT0D59UlLyZcXliWvNURCnHcRrqz5P8C2LCQbVdk0hn3Qkl1glGiLJSql_Wh/exec';

            try {
                await fetch(scriptURL, {
                    method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dataToSend)
                });
                
                showPaymentPage(dataToSend, paymentAccount, totalPrice);

            } catch (error) {
                console.error(error);
                showModal('Gagal', 'Terjadi kesalahan jaringan. Coba lagi.');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Pesan Sekarang <i class="fas fa-arrow-right"></i>';
            }
        }

        function showPaymentPage(data, paymentMethod, amount) {
            currentOrderDetails = {
                pkg: "Perangkat Ajar",
                totalPrice: amount,
                paymentId: data.idPembayaran,
                nama: data.nama,
                whatsapp: data.whatsapp,
                email: data.email,
                orderDetails: data.paket
            };

            document.getElementById('view-form').classList.add('hidden');
            document.getElementById('view-payment').classList.remove('hidden');
            window.scrollTo(0, 0);

            expiryTime = new Date().getTime() + (24 * 60 * 60 * 1000);
            startCountdown();

            document.getElementById('payment-amount').innerText = formatCurrency(amount);
            document.getElementById('payment-logo-result').src = paymentMethod.logo;
            
            // Raw amount for copy
            const rawAmountInputCheck = document.getElementById('payment-amount-raw');
            if (rawAmountInputCheck) {
                rawAmountInputCheck.value = amount;
            } else {
                const rawAmountInput = document.createElement('input');
                rawAmountInput.type = 'hidden';
                rawAmountInput.id = 'payment-amount-raw';
                rawAmountInput.value = amount;
                document.body.appendChild(rawAmountInput);
            }

            document.getElementById('invoice-details-summary').innerHTML = `
                <span>No. Invoice: <strong>${data.idPembayaran}</strong></span>
                <a href="#" onclick="showDetailsModal(event)" class="font-semibold text-blue-600">Lihat detail</a>
            `;
            
            // WA Link
            const waMsg = `Halo, saya sudah transfer untuk pesanan Perangkat Ajar:\n` +
                          `No Invoice: ${data.idPembayaran}\n` +
                          `Total: ${data.totalTransfer}\n\n` +
                          `Mohon segera diproses.`;
            document.getElementById('wa-confirm-btn').href = `https://wa.me/6285602152097?text=${encodeURIComponent(waMsg)}`;

            const detailsContainer = document.getElementById('payment-details-content');
            const instructionsContainer = document.getElementById('instruction-steps');

            if (paymentMethod.type === 'qr') {
                try {
                    const qrisStatic = paymentMethod.number;
                    const qrisDynamic = createDynamicQris(qrisStatic, amount);
                    
                    detailsContainer.innerHTML = `
                        <div class="flex flex-col items-center">
                            <div id="qrcode-canvas" class="p-2 border rounded-lg mb-4 bg-white"></div>
                            <button id="download-qris-btn" class="btn-checkout w-auto px-6 py-2 text-sm" style="box-shadow: none; background: var(--secondary); color: var(--text-main); font-weight: 500;">
                                <i class="fas fa-download mr-2"></i> Unduh QRIS
                            </button>
                            <p class="text-xs text-center text-gray-500 mt-4">Scan QR Code diatas dengan aplikasi pembayaran apa saja.</p>
                        </div>
                    `;
                    setTimeout(() => {
                        const qrContainer = document.getElementById('qrcode-canvas');
                        qrContainer.innerHTML = '';
                        const canvas = document.createElement('canvas');
                        QRCode.toCanvas(canvas, qrisDynamic, { width: 200, margin: 1 }, (err) => {
                            if (!err) {
                                qrContainer.appendChild(canvas);
                                document.getElementById('download-qris-btn').addEventListener('click', () => {
                                    const link = document.createElement('a');
                                    link.download = `QRIS-${data.idPembayaran}.png`;
                                    link.href = canvas.toDataURL('image/png');
                                    link.click();
                                });
                            }
                        });
                    }, 100);

                    instructionsContainer.innerHTML = `
                        <div class="instruction-step"><div class="step-number">1</div><p class="text-sm">Buka aplikasi e-wallet atau m-banking.</p></div>
                        <div class="instruction-step"><div class="step-number">2</div><p class="text-sm">Scan QRIS di atas.</p></div>
                        <div class="instruction-step"><div class="step-number">3</div><p class="text-sm">Cek nominal <strong>${formatCurrency(amount)}</strong>.</p></div>
                        <div class="instruction-step"><div class="step-number">4</div><p class="text-sm">Bayar dan simpan bukti.</p></div>
                    `;
                } catch (e) { detailsContainer.innerHTML = '<p class="text-red-500">QRIS Error</p>'; }
            } else {
                detailsContainer.innerHTML = `
                    <div class="bg-gray-50 p-4 rounded-lg flex items-center justify-between">
                        <div>
                            <p class="text-xs text-gray-500">Nomor Rekening / VA</p>
                            <p class="text-lg font-bold text-gray-800 tracking-wide">${paymentMethod.number}</p>
                            <p class="text-xs text-gray-500 mt-1">A.N ${paymentMethod.holder}</p>
                        </div>
                        <button class="copy-btn" onclick="copyText('${paymentMethod.number}')">
                            <i class="far fa-copy"></i> Salin
                        </button>
                    </div>
                `;
                instructionsContainer.innerHTML = `
                        <div class="instruction-step"><div class="step-number">1</div><p class="text-sm">Buka aplikasi bank Anda.</p></div>
                        <div class="instruction-step"><div class="step-number">2</div><p class="text-sm">Transfer ke <strong>${paymentMethod.name}</strong>.</p></div>
                        <div class="instruction-step"><div class="step-number">3</div><p class="text-sm">No. Rek: <strong>${paymentMethod.number}</strong></p></div>
                        <div class="instruction-step"><div class="step-number">4</div><p class="text-sm">Nominal: <strong>${formatCurrency(amount)}</strong> (Wajib Tepat).</p></div>
                `;
            }
        }

        function backToForm() {
            document.getElementById('view-payment').classList.add('hidden');
            document.getElementById('view-form').classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        // --- UTILS ---
        function startCountdown() {
            if (countdownInterval) clearInterval(countdownInterval);
            countdownInterval = setInterval(() => {
                const now = new Date().getTime();
                const distance = expiryTime - now;
                if (distance < 0) {
                    clearInterval(countdownInterval);
                    document.getElementById('countdown').innerHTML = "WAKTU HABIS";
                    return;
                }
                const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((distance % (1000 * 60)) / 1000);
                document.getElementById('countdown').innerHTML = 
                    `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            }, 1000);
        }

        function copyText(textOrId) {
            let text = textOrId;
            const element = document.getElementById(textOrId);
            if (element) text = element.value || element.innerText;
            navigator.clipboard.writeText(text).then(() => showModal('Disalin', 'Berhasil menyalin ke clipboard.'));
        }

        function showModal(title, msg) {
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalMessage').innerText = msg;
            document.getElementById('infoModal').classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function showFeaturesModal() {
            document.getElementById('features-list-container').innerHTML = `
                <ul class="space-y-3">
                    ${kelengkapanList.map(item => `<li class="flex items-start gap-3"><i class="fas fa-check-circle text-green-500 mt-1"></i><span class="text-sm text-gray-700">${item}</span></li>`).join('')}
                </ul>
            `;
            document.getElementById('featuresModal').classList.add('active');
        }

        function openImageModal(url) {
            document.getElementById('modalImageDisplay').src = url;
            document.getElementById('imageModal').classList.add('active');
        }
        
        // Notification
        function initNotifications() {
             const names = [ "Budi Santoso", "Ayu", "Rahmat", "Citra Dewi Kusuma", "Bayu Pratama", "Lina", "Wulan", "Adi", "Farhan Syahputra", "Hendra Wijaya", "Nana Puspita Dewi", "Joko", "Mega Sari", "Gilang Pramana Putra", "Sari", "Dedi", "Eka Suryani", "Teguh", "Putri Lestari Ayu", "Andi", "Bagus Wijaya", "Ilham Saputra Nugraha", "Rizal", "Mira Astuti", "Puspita", "Hari", "Tri Saputra", "Cahya Pratama", "Surya Darmawan Putra", "Wahyu Ramadhan", "Agus", "Indra Permana", "Linda", "Fajar Mahendra Saputra", "Yusuf", "Pramono Adi Nugroho", "Sinta Dewi", "Bima Pratama", "Dian", "Hasan Basri", "Nurul Aini", "Arif Budiman", "Feri", "Lukman Hakim", "Rangga", "Rini Anggraini Putri", "Tono", "Hadi Prasetyo", "Elisa Purnama", "Anisa Rahma", "Gunawan", "Melati", "Bagus Prasetyo Ramadhan", "Septi Amelia", "Cindy Amelia", "Windi Saputri", "Galih Pratama", "Evi", "Putra", "Slamet Riyadi", "Latif Hidayat", "Gita Puspita", "Darmawan", "Maya", "Erik Saputra Pratama", "Jani", "Jefri Maulana", "Bella Sari", "Maulana", "Novi Andriana Lestari", "Fajar Nugroho", "Taufik Hidayat", "Prasetyo", "Samsul", "Agung", "Endang", "Indah", "Hana Pertiwi", "Mirna", "Yulia", "Panca", "Niken", "Rio", "Adi Putra Ramadhan", "Ganda", "Wahida", "Robby Saputra", "Halim", "Firman Saputra", "Berlian Putra", "Ari", "Joko Setiawan", "Mustika", "Bahar", "Mega", "Erlangga", "Sofyan", "Doni", "Fatimah", "Dian Purnama Sari", "Rama", "Imam Saputra", "Johan", "Gusman", "Lintang", "Nabila", "Beni", "Purnama", "Murni", "Malik", "Nurlan", "Doni Saputra", "Lastri", "Berlinda", "Rasyid", "Tari", "Nia", "Tirta", "Juli Andriani", "Lutfi", "Suci", "Arman", "Yani", "Citra Ayu", "Harto", "Rangga Pratama", "Febrina", "Indra Gunawan Saputra", "Tomi", "Sutrisno", "Risma", "Jihan Ayu Pratiwi", "Lestari", "Dewi Kusuma", "Fahmi", "Rifki", "Wira", "Putra Wijaya", "Beni Setiawan", "Asep", "Gerry", "Prasetia", "Euis", "Latif", "Pajar", "Rahmat Hidayat", "Rudi", "Tika", "Danu", "Hesti", "Syahrul", "Anwar", "Miranti", "Nuraini", "Nurman", "Eman Kurnia", "Nirmala", "Hari Susanto", "Taufan", "Tono Prabowo", "Bayu Saputra Nugroho", "Darma", "Nurlaila", "Hafid", "Mustofa", "Elok", "Gunarto", "Novi", "Lasman", "Jamaludin", "Andi Wijaya Putra", "Herman", "Mila", "Wibowo", "Prayitno", "Adi Saputra", "Jamal", "Irfan", "Iskandar", "Yudha", "Lutris", "Samsul Hidayat", "Heru", "Bagus", "Rudianto", "Nanda Putri", "Laila Rahma", "Frans", "Hilda", "Cahya", "Rudi Pratama", "Setiawan", "Rangga Saputra", "Puspa", "Doni Prasetyo", "Nurul", "Febri", "Mega Sari Lestari", "Suyatno", "Tomiadi", "Fikri", "Lani", "Intan", "Johan Saputra", "Iwan", "Berliano", "Ilham", "Teddy", "Lani Puspita", "Eka Putri Andayani", "Hani", "Adi Wijaya", "Adit", "Dicky", "Gopal", "Pramono", "Gunadi", "Gilang", "Joko Prayitno Adi", "Mira", "Puspita Sari", "Maulana Hakim", "Putri Ayu Lestari", "Malik Prasetyo", "Toriq", "Joni", "Gilang Pratama", "Bagus Wijaya Putra", "Berlian", "Wandi", "Nurman Saputra", "Fajarudin", "Lutfi Pratama", "Citra", "Nanda", "Laras", "Tuti", "Yani Pratiwi", "Gusman Saputra", "Rangga Putra", "Prasetiawan", "Ismail", "Heri", "Adi Nugroho", "Putri", "Prasetyo Adi", "Dona", "Gani", "Jihan", "Puspita Dewi", "Rizal Maulana", "Mahendra", "Ayu Pratiwi", "Rangga Setiawan", "Lina Sari", "Fani", "Adi Wijaya Putra", "Sari Melati", "Andri", "Bima", "Teguh Santoso Adi", "Fajar", "Wulan Dewi", "Rama Pratama", "Nana", "Farhan", "Dion", "Melati Pertiwi", "Adi Putra", "Joko Santoso", "Doni Setiawan", "Lintang Pertiwi", "Septi", "Gopal Pramana", "Tomi Pratama", "Rio Nugraha", "Cindy", "Hafid Saputra", "Hendra", "Niken Lestari", "Rangga Nugroho", "Putri Ayu", "Sofyan Hidayat", "Robby", "Bima Saputra", "Indra", "Adi Kurniawan", "Nanda Saputra", "Gilang Saputra", "Wahyu", "Puspita Ayu", "Rudi Hartono", "Wulan Dewi Pertiwi", "Ayu Pratiwi Lestari", "Tono Adi", "Dedi Kurniawan", "Prasetyo Ramadhan", "Adi Setiawan", "Mira Lestari", "Farhan Syahputra Adi", "Nurul Hidayah", "Sari Anggraini", "Bayu", "Eman", "Putra Adi Nugroho", "Lestari Ayu", "Bambang", "Rangga Hidayat", "Mega Putri", "Adi Nugraha", "Anisa", "Siska", "Wandi Putra", "Fajar Saputra", "Gunawan Pratama", "Heri Setiawan", "Arif", "Ilham Nugroho", "Bagus Pratama", "Erlangga Putra", "Rian", "Pandu", "Tari Ayu", "Hendro", "Risma Ayu", "Adi Pratama", "Septi Ayu", "Bambang Santoso", "Lukman", "Gani Saputra", "Hasan", "Feri Kurniawan", "Tirta", "Bambang Prasetyo", "Pajar Saputra", "Arman Putra", "Murni Ayu", "Hafiz", "Euis Sari", "Bayu Nugroho", "Tomi Saputra", "Gerry Pratama", "Arif Prasetyo", "Johan Putra", "Hafid Nugraha", "Nabila Pertiwi", "Latif Saputra", "Ari Saputra", "Rio Saputra", "Tono Saputra", "Wandi Saputra", "Mahendra Putra", "Ilham Pratama", "Putri Dewi", "Adi Lestari", "Rangga Maulana", "Bayu Hidayat", "Fani Puspita", "Taufik", "Bagus Saputra", "Novi Puspita", "Rahmat Hidayatullah Putra", "Prayitno Saputra", "Adi Ramadhan", "Bayu Wijaya", "Gilang Nugraha", "Rangga Prasetyo", "Putra Purnama", "Wulan Pertiwi", "Adi Wijaya Ramadhan", "Budi", "Rian Pratama", "Samsul Nugroho", "Wahyu Saputra", "Teguh Prasetyo", "Fikri Nugraha", "Rizki Pratama" ];
             setInterval(() => {
                 const name = names[Math.floor(Math.random() * names.length)];
                 const toast = document.getElementById('toast');
                 document.getElementById('toast-title').innerText = name;
                 document.getElementById('toast-message').innerText = "Baru saja memesan perangkat ajar";
                 toast.classList.add('show');
                 setTimeout(() => toast.classList.remove('show'), 4000);
             }, 20000);
        }

        // Details Modal HTML
        function showDetailsModal(event) {
            event.preventDefault();
            const { pkg, totalPrice, paymentId, nama, whatsapp, email, orderDetails } = currentOrderDetails;
            const subtotal = totalPrice - uniqueCode;
            
            // Format order details for display
            // orderDetails is a string with newlines, let's parse or just display
            // Better to re-render from cart if available, but for simplicity:
            const itemsHtml = cart.map(item => {
                let price = 0;
                if (item.jenjang === 'SMK/MAK') {
                    const isUmum = mapelSMKUmum.includes(item.mapel) || mapelAgama.includes(item.mapel);
                    price = isUmum ? pricing['SMK/MAK'].umum : pricing['SMK/MAK'].kejuruan;
                } else {
                    price = pricing[item.jenjang];
                }

                return `
                <div class="flex justify-between text-sm py-1 border-b border-gray-50 last:border-0">
                    <div>
                        <span class="font-medium">${item.jenjang} - ${item.kelas}</span>
                        <div class="text-xs text-gray-500">${item.mapel}</div>
                    </div>
                    <span class="font-semibold">${formatCurrency(price)}</span>
                </div>
            `}).join('');

            document.getElementById('detailsModalContent').innerHTML = `
                <div class="details-modal-header p-4 flex items-center justify-between border-b border-gray-100">
                    <h3 class="text-lg font-bold">Ringkasan Pesanan</h3>
                    <button onclick="closeModal('detailsModal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times text-xl"></i></button>
                </div>
                <div class="details-modal-body p-4 max-h-[70vh] overflow-y-auto">
                    <p class="text-xs text-gray-500 mb-2">Invoice: <strong>${paymentId}</strong></p>
                    
                    <div class="bg-gray-50 rounded-xl p-4 mb-4">
                        <div class="space-y-2">
                            ${itemsHtml}
                        </div>
                        <div class="flex justify-between text-xs mt-3 pt-3 border-t border-gray-200">
                            <span>Kode Unik</span>
                            <span>${formatCurrency(uniqueCode)}</span>
                        </div>
                        <div class="flex justify-between font-bold text-lg mt-2 text-blue-600">
                            <span>Total</span>
                            <span>${formatCurrency(totalPrice)}</span>
                        </div>
                    </div>

                    <div class="space-y-2 text-sm">
                        <h4 class="font-semibold text-gray-900">Data Pemesan</h4>
                        <div class="grid grid-cols-3 gap-2 text-xs">
                            <span class="text-gray-500">Nama</span>
                            <span class="col-span-2 font-medium">${nama}</span>
                            
                            <span class="text-gray-500">WhatsApp</span>
                            <span class="col-span-2 font-medium">${whatsapp}</span>
                            
                            <span class="text-gray-500">Email</span>
                            <span class="col-span-2 font-medium">${email}</span>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('detailsModal').classList.add('active');
        }

        // QRIS Utils
        function createDynamicQris(qris, nominal) {
            let qrisModified = qris.slice(0, -4).replace("010211", "010212");
            const nominalStr = String(Math.round(nominal));
            const amountLength = nominalStr.length < 10 ? "0" + nominalStr.length : nominalStr.length.toString();
            const amountPart = "54" + amountLength + nominalStr;
            if (qrisModified.includes("5802ID")) {
                let parts = qrisModified.split("5802ID");
                qrisModified = parts[0] + amountPart + "5802ID" + parts[1];
            }
            return qrisModified + crc16ccitt(qrisModified);
        }
        function crc16ccitt(str) {
            let crc = 0xFFFF;
            for (let c = 0; c < str.length; c++) {
                crc ^= str.charCodeAt(c) << 8;
                for (let i = 0; i < 8; i++) {
                    if (crc & 0x8000) crc = (crc << 1) ^ 0x1021;
                    else crc = crc << 1;
                }
            }
            return (crc & 0xFFFF).toString(16).toUpperCase().padStart(4, "0");
        }

    </script>
</body>
</html>
